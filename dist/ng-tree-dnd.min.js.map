{"version":3,"sources":["ng-tree-dnd.js"],"names":["fnInitTreeDnD","$timeout","$http","$compile","$parse","$window","$document","$templateCache","$TreeDnDTemplate","$TreeDnDClass","$TreeDnDHelper","$TreeDnDPlugin","$TreeDnDViewport","fnController","$scope","$element","$attrs","timeLoadData","treeData","tmpTreeData","reload_data","timeReloadData","check_exist_attr","attrs","existAttr","isAnd","angular","isUndefinedOrNull","isUndefined","isArray","for_each_attrs","exist","i","len","length","passed","generateWatch","type","nameAttr","valDefault","nameScope","fnNotExist","fnAfter","fnBefore","isFunction","$watch","val","indexOf","$safeApply","fn","phase","this","$root","$$phase","$apply","getExpandOn","_len","_firstNode","_keys","Object","keys","_regex","RegExp","test","expandingProperty","getColDefs","_col_defs","push","field","colDefinitions","do_f","root","node","parent","parent_real","level","visible","index","_i","_icon","_index_real","_dept","_hashKey","__children__","__parent_real__","__parent__","__expanded__","expandLevel","__index__","__index_real__","__level__","__icon__","__icon_class__","$class","icon","__visible__","__uid__","Math","random","getHash","__hashKey__","primary_key","__dept__","oData","console","time","_data","_tree_nodes","isDefined","expandOn","columnDefs","orderBy","_fnInitOrderBy","filter","_fnInitFilter","filterOptions","_deptTotal","tree_nodes","timeEnd","indent","indent_plus","indent_unit","$tree_class","$type","$globals","copy","extend","1","iconExpand","0","iconCollapse","-1","iconLeaf","for_all_descendants","checkSibling","_nodes","getLastDescendant","last_child","n","tree","selected_node","getElementChilds","element","querySelector","onClick","on_click","setTimeout","onSelect","select_node","on_select","passedExpand","_clone","toggleExpand","fnCallback","$callbacks","expand","accept","dragInfo","moveTo","isChanged","dropEnabled","calsIndent","skipUnit","skipEdge","unit","edge","droppable","draggable","dragEnabled","beforeDrop","event","changeKey","_key","__selected__","replace","clone","_this","remove","delayReload","temp","splice","clearInfo","__inited__","add","pos","deleteScope","scope","_hash","setScope","getScope","enableDrag","enableDrop","placeElm","horizontal","dragDelay","enabledMove","statusMove","enabledHotkey","enabledCollapse","statusElm","dragging","beforeDrag","scopeDrag","dragStop","info","changed","drag","target","dropped","pass","_node","_nodeAdd","_move","move","_parent","_parentRemove","_parentAdd","isMove","dragStart","dragMove","setDragging","enableMove","enableStatus","enabledStatus","hideStatus","addClass","hidden","refreshStatus","statusElmOld","getMove","getCopy","attr","find","append","removeClass","setPositionStatus","e","css","left","pageX","top","pageY","z-index","status","targeting","getPrevSibling","_index","getNode","initPlace","dragElm","isTable","document","createElement","_len_down","empty","place","height","parentNode","insertBefore","hidePlace","showPlace","getScopeTree","_fnGetControl","w","_curW","_typeW","_nameW","_defaultW","_scopeW","_NotW","_AfterW","_BeforeW","_defaultFilterOption","showParent","showChild","beginAnd","_watches","isHotkey","templateCopy","_url","get","setCopy","templateMove","setMove","treeClass","trim","$tree","colDefs","filters","_passed","_iF","_keysF","_lenF","enabledFilter","option","primaryKey","indentUnit","optCallbacks","forEach","value","key","lenW","equals","updateLimit","$TreeLimit","fnCompile","tElement","$_Template","_element","html","_fnInitDrag","ready","checkTreeTable","template","attrInclude","elemNode","treeInclude","cache","success","data","tempDiv","innerHTML","setTemplate","templateNode","promiseCheck","then","templateUrl","getPath","restrict","controller","compile","fnInitTreeDnDViewport","$q","update","viewportRect","width","eWindow","prop","documentElement","clientWidth","clientHeight","body","scrollTop","scrollLeft","isUpdating","isRender","updateAgain","recursivePromise","item","number","items","renderTime","cancel","setViewport","viewport","getViewport","updateDelayed","updateTimeout","nodeTemplate","getItems","$initViewport","on","module","constant","nodes","handle","directive","link","new_val","compileReplace","replaceWith","fnLink","fnWatchNode","newVal","oldVal","fnHiddenChild","nodeScope","nodeOf","keyNode","first","parentReal","_childs","hashKey","childsElem","$node_class","enabledDnD","treeDndNode","log","getData","getScopeNode","objexpr","objprops","keyO","lenO","skipAttr","keepAttr","lenKeep","join","$on","$nodes_class","$inject","factory","_$initConvert","line2tree","parentKey","parentId","rootIds","_primary","treeObjs","tree2tree","access_child","containKey","_copy","_child","_tree","_$helper","nodrag","targetElm","eventObj","obj","undefined","targetTouches","originalEvent","drop","offset","boundingClientRect","getBoundingClientRect","pageYOffset","pageXOffset","positionStarted","offsetX","offsetY","startX","lastX","startY","lastY","nowX","nowY","distX","distY","dirAx","dirX","dirY","lastDirX","lastDirY","distAxX","distAxY","positionMoved","firstMoving","newAx","abs","moving","replaceIndent","children","$injector","_fnget","name","has","templatePath","copyPath","movePath","scopes","_$init","path","$id","$filter","options","fieldChild","parentPassed","_nodePassed","_childPassed","_fnCheck","callback","err","_fnProccess","condition","for_each_filter","_iO","_keysO","_lenO","_callback","conditions","_fnAfter","isNodePassed","isChildPassed","isParentPassed","__filtered__","__filtered_visible__","_fnBefore","_fnConvert","_filter","_state","isObject","fnInitFilter","keyChild","_fnOrderBy","fnOrderBy","_fnOrder","list","_fnMain","isString","_fnPlaceHolder","$params","_offset","_fnDragStart","hasTouch","button","which","uiTreeDragging","eventElm","eventScope","dragScope","eventElmTagName","toLowerCase","_$scope","preventDefault","offsetEdge","_tbody","_frag","_width","_scope","_needCollapse","_copied","createDocumentFragment","bind","dragEndEvent","dragMoveEvent","dragCancelEvent","document_height","max","scrollHeight","offsetHeight","document_width","scrollWidth","offsetWidth","_fnDragMove","dragStarted","dragDelaying","getSelection","removeAllRanges","selection","leftElmPos","topElmPos","top_scroll","window","bottom_scroll","innerHeight","scrollBy","targetScope","targetBefore","targetOffset","isEmpty","isSwapped","_target","fnSwapTree","targetX","targetY","isVeritcal","_info","_drag","_drop","treeScope","isHolder","elementFromPoint","_height","_prev","dragBorder","after","prepend","_fnDragEnd","clearData","$$apply","_status","_fnBindDrag","unbind","_fnDragStartEvent","dragTimer","_fnKeydownHandler","keyCode","shiftKey","_fnKeyupHandler","bindDrag","dragEnd","keydownHandler","keyupHandler","fnSetCollapse","fnSetExpand","expand_all_parents","deselect_node","get_parent","for_all_ancestors","child","collapse_all_parents","add_node","new_node","add_node_root","expand_all","collapse_all","remove_node","lastElement","expand_node","collapse_node","get_selected_node","get_first_node","get_children","get_siblings","get_next_sibling","get_prev_sibling","get_first_child","get_closest_ancestor_next_sibling","get_next_node","get_prev_node","get_last_descendant","select_parent_node","select_first_node","firstNode","select_next_sibling","select_prev_sibling","select_next_node","select_prev_node","run","put"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CA+BA,WACI,YA0SJ,SAASA,GAAcC,EAAUC,EAAOC,EAAUC,EAAQC,EAASC,EAAWC,EACvDC,EAAkBC,EAAeC,EAAgBC,EAAgBC,GAUpF,QAASC,GAAaC,EAAQC,EAAUC,GA4pBpC,QAASC,KACLH,EAAOI,SAAWC,EAClBC,IACAC,EAAkB,KAUtB,QAASC,GAAiBC,EAAOC,EAAWC,GACxC,MAAIC,SAAQC,kBAAkBH,IACnB,EAGO,MAAdA,GAAsBE,QAAQE,YAAYL,EAAMC,IAIhDE,QAAQG,QAAQL,GACTM,EAAeP,EAAOC,EAAWC,GAD5C,QAHW,EAQf,QAASK,GAAeP,EAAOQ,EAAON,GAClC,GAAIO,GAAGC,EAAMF,EAAMG,OAAQC,GAAS,CAEpC,IAAY,IAARF,EACA,MAAO,KAEX,KAAKD,EAAI,EAAOC,EAAJD,EAASA,IACjB,GAAIV,EAAiBC,EAAOQ,EAAMC,IAAKP,IAEnC,GADAU,GAAS,GACJV,EACD,OAAO,MAGX,IAAIA,EACA,OAAO,CAKnB,OAAOU,GAGX,QAASC,GAAcC,EAAMC,EAAUC,EAAYC,EAAWC,EAAYC,EACnDC,GAGnB,GADAH,EAAYA,GAAaF,EACL,gBAATD,IAAqBX,QAAQG,QAAQQ,GAAO,CACnD,GAAIX,QAAQkB,WAAWD,IAAaA,IAChC,MAE4B,iBAArB3B,GAAOsB,GACdxB,EAAO+B,OACH7B,EAAOsB,GAAW,SAAUQ,GACJ,gBAATT,UAA4BS,KAAQT,GAC3CX,QAAQG,QAAQQ,IAASA,EAAKU,cAAeD,IAAO,GAEpDhC,EAAO0B,GAAaM,EAEhBpB,QAAQkB,WAAWL,GACnBzB,EAAO0B,GAAaD,EAAWO,GAE/BhC,EAAO0B,GAAaD,EAIxBb,QAAQkB,WAAWF,IACnBA,EAAQ5B,EAAO0B,GAAY1B,KAEhC,GAIHY,QAAQkB,WAAWH,GACnB3B,EAAO0B,GAAaC,IACZf,QAAQE,YAAYa,KAC5B3B,EAAO0B,GAAaC,IAMpC,QAASO,GAAWC,GAChB,GAAIC,GAAQC,KAAKC,MAAMC,OACT,YAAVH,GAAgC,YAAVA,EAClBD,GAAoB,kBAAPA,IACbA,IAGJE,KAAKG,OAAOL,GAIpB,QAASM,KACL,GAAIzC,EAAOI,UAAYJ,EAAOI,SAASgB,OAAQ,CAC3C,GAEIsB,GACAxB,EAHAyB,EAAa3C,EAAOI,SAAS,GAAIwC,EAAQC,OAAOC,KAAKH,GACrDI,EAAa,GAAIC,QAAO,yBAI5B,KAAK9B,EAAI,EAAGwB,EAAOE,EAAMxB,OAAYsB,EAAJxB,EAAUA,IACvC,GAAoC,gBAAzByB,GAAWC,EAAM1B,MAAqB6B,EAAOE,KAAKL,EAAM1B,IAE/D,YADAlB,EAAOkD,kBAAoBN,EAAM1B,GAMrCN,SAAQC,kBAAkBb,EAAOkD,qBACjClD,EAAOkD,kBAAoBN,EAAM,KAM7C,QAASO,KAEL,GAAInD,EAAOI,SAASgB,OAAQ,CACxB,GAGIF,GAAGwB,EAHHU,KAAgBT,EAAa3C,EAAOI,SAAS,GAC7C2C,EAAY,GAAIC,QAAO,4BAA+BhD,EAAOkD,kBAAoB,MACjFN,EAAYC,OAAOC,KAAKH,EAG5B,KAAKzB,EAAI,EAAGwB,EAAOE,EAAMxB,OAAYsB,EAAJxB,EAAUA,IACH,gBAAzByB,GAAWC,EAAM1B,KAAqB6B,EAAOE,KAAKL,EAAM1B,KAC/DkC,EAAUC,MAEFC,MAAOV,EAAM1B,IAK7BlB,GAAOuD,eAAiBH,GAIhC,QAASI,GAAKC,EAAMC,EAAMC,EAAQC,EAAaC,EAAOC,EAASC,GAC3D,GAAIC,GAAItB,EAAMuB,EAAOC,EAAaC,EAAOC,CA8CzC,IA7CKxD,QAAQG,QAAQ2C,EAAKW,gBACtBX,EAAKW,iBAGTX,EAAKY,gBAAkBV,EACvBF,EAAKa,WAAkBZ,EACvBjB,EAAuBgB,EAAKW,aAAajD,OAErCR,QAAQC,kBAAkB6C,EAAKc,eAAiB9B,EAAO,IACvDgB,EAAKc,aAAeX,EAAQ7D,EAAOyE,aAInCR,EADS,IAATvB,EACQ,GAEJgB,EAAKc,aACG,EAEA,EAKhBN,EAAsBT,EAAKrC,OAC3BsC,EAAKgB,UAAiBX,EACtBL,EAAKiB,eAAiBT,EACtBR,EAAKkB,UAAiBf,EACtBH,EAAKmB,SAAiBZ,EACtBP,EAAKoB,eAAiB9E,EAAO+E,OAAOC,KAAKf,GACzCP,EAAKuB,cAAmBnB,EAEpBlD,QAAQC,kBAAkB6C,EAAKwB,WAC/BxB,EAAKwB,QAAU,GAAKC,KAAKC,UAG7BhB,EAAWpE,EAAOqF,QAAQ3B,IAEtB9C,QAAQC,kBAAkB6C,EAAK4B,cAAgB5B,EAAK4B,cAAgBlB,KACpEV,EAAK4B,YAAclB,GAGvBX,EAAKJ,KAAKK,GAGVS,EAAQ,EACJzB,EAAO,EACP,IAAKsB,EAAK,EAAQtB,EAALsB,EAAWA,IACpBG,GAASX,EACLC,EACAC,EAAKW,aAAaL,GAClBN,EAAK1D,EAAOuF,aACZrB,EACAL,EAAQ,EACRC,GAAWJ,EAAKc,aAChBR,EAOZ,OAFAN,GAAK8B,SAAWrB,EAETA,EAGX,QAAS7D,GAAYmF,GACjBC,QAAQC,KAAK,cAEb,IAAIC,GACAlD,EACAmD,IACJ,IAAIjF,QAAQkF,UAAUL,GAAQ,CAC1B,IAAK7E,QAAQG,QAAQ0E,IAA2B,IAAjBA,EAAMrE,OACjC,QAEAwE,GAAQH,MAET,CAAA,IAAK7E,QAAQG,QAAQf,EAAOI,WAAwC,IAA3BJ,EAAOI,SAASgB,OAC5D,QAEAwE,GAAQ5F,EAAOI,SAgCnB,GA7BKF,EAAO6F,UACRtD,IAGCvC,EAAO8F,YACR7C,IAGAvC,QAAQkF,UAAU9F,EAAOiG,WACpBrF,QAAQkB,WAAWoE,KACpBA,EAAiBrG,EAAe,oBAGhCe,QAAQkB,WAAWoE,KACnBN,EAAQM,EAAeN,EAAO5F,EAAOiG,WAIzCrF,QAAQkF,UAAU9F,EAAOmG,UACpBvF,QAAQkB,WAAWsE,KACpBA,EAAgBvG,EAAe,mBAG/Be,QAAQkB,WAAWsE,KACnBR,EAAQQ,EAAcR,EAAO5F,EAAOmG,OAAQnG,EAAOqG,iBAI3D3D,EAAOkD,EAAMxE,OACTsB,EAAO,EAAG,CACV,GAAIsB,GACAsC,EAAa,CAEjB,KAAKtC,EAAK,EAAQtB,EAALsB,EAAWA,IACpBsC,GAAc9C,EAAKqC,EAAaD,EAAM5B,GAAK,KAAM,KAAM,GAAG,EAAMA,GAaxE,MAPIpD,SAAQkF,UAAU9F,EAAOuG,mBAClBvG,GAAOuG,WAGlBvG,EAAOuG,WAAaV,EAEpBH,QAAQc,QAAQ,eACTX,EA56BX7F,EAAOyG,OAAc,GACrBzG,EAAO0G,YAAc,GACrB1G,EAAO2G,YAAc,KACrB3G,EAAO4G,YAAc,QACrB5G,EAAOuF,YAAc,UAErBvF,EAAO6G,MAAQ,UAEf7G,EAAOuD,kBACPvD,EAAO8G,YACP9G,EAAO+E,UAEP/E,EAAOI,YACPJ,EAAOuG,cAEPvG,EAAO+E,OAASnE,QAAQmG,KAAKpH,GAC7BiB,QAAQoG,OACJhH,EAAO+E,OAAOC,MACViC,EAAM/G,EAAOgH,YAAc,4BAC3BC,EAAMjH,EAAOkH,cAAgB,2BAC7BC,KAAMnH,EAAOoH,UAAY,6BAIjCtH,EAAOuH,oBAAsB,SAAU7D,EAAMvB,EAAIwB,EAAQ6D,GACrD,GAAI5G,QAAQkB,WAAWK,GAAK,CACxB,GAAI6B,GAAItB,EAAM+E,CAEd,IAAItF,EAAGuB,EAAMC,GAET,OAAO,CAIX,KAFA8D,EAAS/D,EAAKW,aACd3B,EAAS+E,EAAOrG,OACX4C,EAAK,EAAQtB,EAALsB,EAAWA,IACpB,IAAKhE,EAAOuH,oBAAoBE,EAAOzD,GAAK7B,EAAIuB,KAAU8D,EAEtD,OAAO,EAKnB,OAAO,GAGXxH,EAAO0H,kBAAoB,SAAUhE,GACjC,GAAIiE,GAAYC,CAIhB,OAHKlE,KACDA,EAAO1D,EAAO6H,KAAO7H,EAAO6H,KAAKC,eAAgB,GAEjDpE,KAAS,GACF,GAEXkE,EAAIlE,EAAKW,aAAajD,OACZ,IAANwG,EACOlE,GAEPiE,EAAajE,EAAKW,aAAauD,EAAI,GAC5B5H,EAAO0H,kBAAkBC,MAIxC3H,EAAO+H,iBAAmB,WACtB,MAAOnH,SAAQoH,QAAQ/H,EAAS,GAAGgI,cAAc,sBAGrDjI,EAAOkI,QAAU,SAAUxE,GACnB9C,QAAQkF,UAAU9F,EAAO6H,OAASjH,QAAQkB,WAAW9B,EAAO6H,KAAKM,WAGjEC,WACI,WACIpI,EAAO6H,KAAKM,SAASzE,IACtB,IAKf1D,EAAOqI,SAAW,SAAU3E,GACpB9C,QAAQkF,UAAU9F,EAAO6H,QACrBnE,IAAS1D,EAAO6H,KAAKC,eACrB9H,EAAO6H,KAAKS,YAAY5E,GAGxB9C,QAAQkB,WAAW9B,EAAO6H,KAAKU,YAC/BH,WACI,WACIpI,EAAO6H,KAAKU,UAAU7E,IACvB,IAMnB,IAAI8E,GAAcC,CAClBzI,GAAO0I,aAAe,SAAUhF,EAAMiF,GAClCH,GAAe,EACX5H,QAAQkB,WAAW6G,KAAgBA,EAAWjF,GAC9C8E,GAAe,EACR5H,QAAQkB,WAAW9B,EAAO4I,WAAWC,UAAY7I,EAAO4I,WAAWC,OAAOnF,KACjF8E,GAAe,GAGfA,GACI9E,EAAKW,aAAajD,OAAS,IAC3BsC,EAAKc,cAAgBd,EAAKc,eAKtCxE,EAAOqF,QAAU,SAAU3B,GACvB,MAAO,IAAMA,EAAKa,WAAa,IAAMb,EAAK1D,EAAOuF,cAGrDvF,EAAO4I,YACHrB,oBAAqBvH,EAAOuH,oBAI5BuB,OAAqB,SAAUC,EAAUC,EAAQC,GAC7C,MAAOjJ,GAAOkJ,eAAgB,GAElCC,WAAqB,SAAUtF,EAAOuF,EAAUC,GAC5C,GAAIC,GAAO,EACPC,EAAOF,EAAW,EAAIrJ,EAAO0G,WAKjC,OAJK0C,KACDE,EAAOtJ,EAAO2G,YAAc3G,EAAO2G,YAAc,MAGrC,EAAZ9C,EAAQ,EACD0F,EAAOD,EAEPtJ,EAAOyG,QAAU5C,EAAQ,GAAK0F,EAAOD,GAGpDE,UAAqB,WACjB,MAAOxJ,GAAOkJ,eAAgB,GAElCO,UAAqB,WACjB,MAAOzJ,GAAO0J,eAAgB,GAElCC,WAAqB,SAAUC,GAC3B,OAAO,GAEXC,UAAqB,SAAUnG,GAC3B,GAAIoG,GAAWpG,EAAKwB,OACpBxB,GAAKwB,QAAUC,KAAKC,SAChB1B,EAAKqG,oBACErG,GAAKqG,aAGW,YAAvB/J,EAAOuF,cACPuE,EAAO,GAAKpG,EAAK1D,EAAOuF,aACxBuE,EAAOA,EAAKE,QAAQ,SAAU,IAAM,KAAOtG,EAAKwB,QAEhDxB,EAAK1D,EAAOuF,aAAeuE,IAInCG,MAAqB,SAAUvG,EAAMwG,GAGjC,MAFAzB,GAAS7H,QAAQmG,KAAKrD,GACtBrB,KAAKkF,oBAAoBkB,EAAQpG,KAAKwH,WAC/BpB,GAEX0B,OAAqB,SAAUzG,EAAMC,EAAQuG,EAAOE,GAChD,GAAIC,GAAO1G,EAAO2G,OAAO5G,EAAKgB,UAAW,GAAG,EAI5C,OAHK0F,IACDpK,EAAOM,cAEJ+J,GAEXE,UAA0B,SAAU7G,SACzBA,GAAK8G,iBACL9G,GAAKuB,aAKhBwF,IAAqB,SAAU/G,EAAMgH,EAAK/G,EAAQuG,GAE9C7H,KAAKkF,oBAAoB7D,EAAMrB,KAAKkI,WAChC5G,IACIA,EAAOvC,OAAS,IACZsJ,EAAM,GACN/G,EAAO2G,OAAOI,EAAK,EAAGhH,GAM1BC,EAAON,KAAKK,MAM5B1D,EAAO2K,YAAc,SAAUC,EAAOlH,GAClC,GAAImH,GAAQnH,EAAK4B,WACbtF,GAAO8G,SAAS+D,IAAU7K,EAAO8G,SAAS+D,KAAWD,SAC9C5K,GAAO8G,SAAS+D,IAI/B7K,EAAO8K,SAAW,SAAUF,EAAOlH,GAC/B,GAAImH,GAAQnH,EAAK4B,WACbtF,GAAO8G,SAAS+D,KAAWD,IAC3B5K,EAAO8G,SAAS+D,GAASD,IAIjC5K,EAAO+K,SAAW,SAAUrH,GACxB,GAAIA,EAAM,CACN,GAAImH,GAAQnH,EAAK4B,WAEjB,OAAOtF,GAAO8G,SAAS+D,GAE3B,MAAO7K,KAGPE,EAAO8K,YAAc9K,EAAO+K,cAC5BjL,EAAOkL,SAAW,KAElBlL,EAAO0J,YAAc,KACrB1J,EAAOkJ,YAAc,KACrBlJ,EAAOmL,WAAc,KAEjBjL,EAAO8K,aAEPhL,EAAOoL,UAAkB,EACzBpL,EAAOqL,aAAkB,EACzBrL,EAAOsL,YAAkB,EACzBtL,EAAOuL,eAAkB,EACzBvL,EAAOwL,gBAAkB,KACzBxL,EAAOyL,UAAkB,KACzBzL,EAAO0L,SAAkB,KAEzB9K,QAAQoG,OACJhH,EAAO4I,YACH+C,WAAY,SAAUC,GAClB,OAAO,GAEXC,SAAY,SAAUC,EAAMzK,GACxB,OAAKyK,IAASA,EAAKC,SAAWD,EAAKE,KAAKX,cAAgBhK,EAC7C,MAGXyK,EAAKG,OAAO3L,mBAERwL,EAAKG,SAAWH,EAAKE,MAAQF,EAAKE,KAAKX,aACvCS,EAAKE,KAAK1L,iBAGlB4L,QAAY,SAAUJ,EAAMK,GACxB,IAAKL,EACD,MAAO,KAGX,IAAIM,GAAgBN,EAAKpI,KACrB2I,EAAgB,KAChBC,EAAgBR,EAAKS,KACrBC,EAAgB,KAChBC,EAAgBX,EAAKnI,QAAUmI,EAAKE,KAAK5L,SACzCsM,EAAgBJ,EAAM3I,QAAUmI,EAAKG,OAAO7L,SAC5CuM,EAAgBb,EAAKE,KAAKX,WAE9B,QAAKS,EAAKC,SAAWY,GACV,EAGPb,EAAKG,OAAOrD,WAAWE,OAAOgD,EAAMA,EAAKS,KAAMT,EAAKC,UAChDY,GACAH,EAAUC,EACN7L,QAAQkF,UAAU0G,EAAQnI,gBAC1BmI,EAAUA,EAAQnI,cAGtBgI,EAAWP,EAAKE,KAAKpD,WAAWuB,OAC5BiC,EACAI,EACAV,EAAKE,KAAKpD,YACV,IAGJyD,EAAWP,EAAKE,KAAKpD,WAAWqB,MAAMmC,EAAON,EAAKE,KAAKpD,YAKvD+D,GACAb,EAAKE,OAASF,EAAKG,QACnBQ,IAAkBC,GAClBJ,EAAM5B,KAAOoB,EAAKpI,KAAKgB,WACvB4H,EAAM5B,MAGV8B,EAAUE,EACNF,EAAQnI,eACRmI,EAAUA,EAAQnI,cAGtByH,EAAKG,OAAOrD,WAAW6B,IACnB4B,EACAC,EAAM5B,IACN8B,EACAV,EAAKE,KAAKpD,aAGP,IAGJ,GAEXgE,UAAY,SAAUhD,KAEtBiD,SAAY,SAAUjD,OAK9B5J,EAAO8M,YAAc,SAAU/D,GAC3B/I,EAAO0L,SAAW3C,GAGtB/I,EAAO+M,WAAa,SAAU/K,GACP,iBAARA,GACPhC,EAAOqL,YAAcrJ,EAErBhC,EAAOqL,aAAc,GAIzBnL,EAAO8M,eACPhN,EAAOiN,eAAgB,EAEvBjN,EAAOkN,WAAa,WACZlN,EAAOyL,WACPzL,EAAOyL,UAAU0B,SAASnN,EAAO+E,OAAOqI,SAIhDpN,EAAOqN,cAAgB,WACnB,GAAKrN,EAAO0L,UAIR1L,EAAOiN,cAAe,CACtB,GAAIK,GAAetN,EAAOyL,SACtBzL,GAAOqL,YACPrL,EAAOyL,UAAY7K,QAAQoH,QAAQtI,EAAiB6N,QAAQvN,IAE5DA,EAAOyL,UAAY7K,QAAQoH,QAAQtI,EAAiB8N,QAAQxN,IAG5DsN,IAAiBtN,EAAOyL,YACpB6B,IACAtN,EAAOyL,UAAUgC,KAAK,QAASH,EAAaG,KAAK,UACjDzN,EAAOyL,UAAUgC,KAAK,QAASH,EAAaG,KAAK,UACjDH,EAAanD,UAEjB3K,EAAUkO,KAAK,QAAQC,OAAO3N,EAAOyL,YAIzCzL,EAAOyL,UAAUmC,YAAY5N,EAAO+E,OAAOqI,UAInDpN,EAAO6N,kBAAoB,SAAUC,GAC7B9N,EAAOyL,YACPzL,EAAOyL,UAAUsC,KAETC,KAAWF,EAAEG,MAAQ,GAAK,KAC1BC,IAAWJ,EAAEK,MAAQ,GAAK,KAC1BC,UAAW,OAGnBpO,EAAOyL,UAAU0B,SAASnN,EAAO+E,OAAOsJ,YAMxDrO,EAAOsO,WAAY,EAEnBtO,EAAOuO,eAAiB,SAAU7K,GAC9B,GAAIA,GAAQA,EAAKgB,UAAY,EAAG,CAC5B,GAAI8H,GAASgC,EAAS9K,EAAKgB,UAAY,CAEvC,OAAI9D,SAAQkF,UAAUpC,EAAKY,kBACvBkI,EAAUxM,EAAOuG,WAAW7C,EAAKY,iBAC1BkI,EAAQnI,aAAamK,IAEzBxO,EAAOI,SAASoO,GAG3B,MAAO,OAGXxO,EAAOyO,QAAU,SAAU1K,GACvB,MAAInD,SAAQC,kBAAkBkD,GACnB,KAEJ/D,EAAOuG,WAAWxC,IAG7B/D,EAAO0O,UAAY,SAAU1G,EAAS2G,GAElC,IAAK3O,EAAOkL,SACR,GAAIlL,EAAO4O,QAAS,CAChB5O,EAAOkL,SAAWtK,QAAQoH,QAAQzI,EAAQsP,SAASC,cAAc,MACjE,IAAIC,GAAc/O,EAAOuD,eAAenC,MAOxC,KANApB,EAAOkL,SAASyC,OACZ/M,QAAQoH,QAAQzI,EAAQsP,SAASC,cAAc,OAC1C3B,SAASnN,EAAO+E,OAAOiK,OACvB7B,SAAS,YACTA,SAASnN,EAAO+E,OAAOkK,QAEzBF,IAAc,GACjB/O,EAAOkL,SAASyC,OACZ/M,QAAQoH,QAAQzI,EAAQsP,SAASC,cAAc,OAC1C3B,SAASnN,EAAO+E,OAAOiK,OACvB7B,SAASnN,EAAO+E,OAAOkK,YAIpCjP,GAAOkL,SAAWtK,QAAQoH,QAAQzI,EAAQsP,SAASC,cAAc,OAC5D3B,SAASnN,EAAO+E,OAAOiK,OACvB7B,SAASnN,EAAO+E,OAAOkK,MAepC,OAVIN,IACA3O,EAAOkL,SAAS6C,IAAI,SAAUnO,EAAesP,OAAOP,GAAW,MAG/D3G,EACAA,EAAQ,GAAGmH,WAAWC,aAAapP,EAAOkL,SAAS,GAAIlD,EAAQ,IAE/DhI,EAAO+H,mBAAmB4F,OAAO3N,EAAOkL,UAGrClL,EAAOkL,UAGlBlL,EAAOqP,UAAY,WACXrP,EAAOkL,UACPlL,EAAOkL,SAASiC,SAASnN,EAAO+E,OAAOqI,SAI/CpN,EAAOsP,UAAY,WACXtP,EAAOkL,UACPlL,EAAOkL,SAAS0C,YAAY5N,EAAO+E,OAAOqI,SAIlDpN,EAAOuP,aAAe,WAClB,MAAOvP,KAKfA,EAAOkC,WAAaA,CAEpB,IAAIkE,GACAF,EACAsJ,EAMA3H,EAyJA4H,EACAvO,EAAGC,EACHuO,EACAC,EAAQC,EAAQC,EAAWC,EAASC,EAAOC,EAASC,EAGpD1P,EAAgBF,EApKhB6P,GACIC,YAAY,EACZC,WAAY,EACZC,UAAY,GAGhBC,IAEQ,eACC,UAAW,eAAgB,KAAM,kBACjC,UAAW,aAAc,KAAM,gBAC/B,SAAU,YAAa,EAAG,KAAM,IAChC,UAAW,iBAAkB,KAAM,oBAEhC,UAAW,eAAgB,KAAM,gBAAiB,KAAM,SAAUC,GAC9DA,EACAvQ,EAAOqL,aAAc,EAErBrL,EAAOqL,YAAcrL,EAAOsL,iBAKnC,aAAc,kBAEX,SAAU,eAAgBpL,EAAOsQ,aAAc,eAAgB,KAC/D,SAAUC,GACFA,GAAQhR,EAAeiR,IAAID,IAC3B/Q,EAAiBiR,QAAQF,EAAMzQ,MAIvC,SAAU,eAAgBE,EAAO0Q,aAAc,eAAgB,KAC/D,SAAUH,GACFA,GAAQhR,EAAeiR,IAAID,IAC3B/Q,EAAiBmR,QAAQJ,EAAMzQ,UAKzC,aAAc,iBACf,SAAU,aAAc,GAAI,aAAc,OAG3C,MACC,UAAW,aAAa,EAAM,YAAa,OAC3C,UAAW,eAER,WAAY,YAAa,SAAUgC,GACnC,aAAeA,IACX,IAAK,SACDhC,EAAO4G,YAAc5E,CACrB,MACJ,KAAK,SACDpB,QAAQoG,OAAOhH,EAAO+E,OAAQ/C,GAC9BhC,EAAO4G,YAAc5G,EAAO+E,OAAO8C,IACnC,MACJ,SACI7H,EAAO4G,YAAc1G,EAAO4Q,YAGrC,YAAa,WACZ9Q,EAAO4G,YAAc5G,EAAO+E,OAAO8C,KAAO,UAC3C,KAAM,WACL,MAAI,sBAAsB5E,KAAK,IAAM/C,EAAO4Q,YACxC9Q,EAAO4G,YAAc1G,EAAO4Q,UAAUC,QAC/B,GAFX,WAMC,SAAU,UAAW,WAAYtO,EAAa,oBAAqBA,EACpE,SAAUsD,GACFnF,QAAQC,kBAAkBkF,KAC1B/F,EAAOkD,kBAAoBhD,EAAO6F,aAI1C,SAAU,cAAenF,QAAQkF,UAAU9F,EAAO6H,MAAQ7H,EAAO6H,QACjE,OAAQ,KAAM,SAAUmJ,GAEnBpQ,QAAQkB,WAAW0N,KACpBA,EAAgB3P,EAAe,oBAG/Be,QAAQkB,WAAW0N,KACnB3H,EAAOjH,QAAQoG,OACXgK,EACAxB,EAAcxP,SAKrB,QAAS,UAAW,aAAcmD,EAAY,iBAAkBA,EACjE,SAAU8N,IACFrQ,QAAQC,kBAAkBoQ,KAAarQ,QAAQG,QAAQkQ,MACvDjR,EAAOuD,eAAiBJ,SAGlC,SAAU,SAAU,QAAS,YAAa,UAAWjD,EAAO+F,WAEzD,SAAU,SAAU,SAAU,KAAM,SAAU,KAAM,SAAUiL,GAC/D,GAAIC,IAAU,CACd,IAAIvQ,QAAQkF,UAAUoL,KAAatQ,QAAQG,QAAQmQ,GAAU,CACzD,GAC4BE,GADxBC,EAASxO,OAAOC,KAAKoO,GACrBI,EAASD,EAAOjQ,MAEpB,IAAIkQ,EAAQ,EACR,IAAKF,EAAM,EAASE,EAANF,EAAaA,IAEvB,GAAoC,gBAAzBF,GAAQG,EAAOD,KACU,IAAhCF,EAAQG,EAAOD,IAAMhQ,OADzB,CAIA+P,GAAU,CACV,QAKZnR,EAAOuR,cAAgBJ,EACvB7Q,OAGA,SAAU,gBAAiB4P,EAAsB,gBACjDA,EAAsB,SAAUsB,GACV,gBAAXA,KACPxR,EAAOqG,cAAgBzF,QAAQoG,OAAOkJ,EAAsBsB,OAGnE,SAAU,aAActR,EAAOuR,WAAY,cAAe,YAC1D,SAAU,aAAcvR,EAAOwR,WAAY,gBAC3C,SAAU,SAAU,GAAI,KAAM,KAC9B,SAAU,aAAc,GAAI,KAAM,KAE/B,OAAQ,YACR,SAAUC,GAUN,MATA/Q,SAAQgR,QACJD,EAAc,SAAUE,EAAOC,GACN,kBAAVD,IACH7R,EAAO4I,WAAWkJ,KAClB9R,EAAO4I,WAAWkJ,GAAOD,KAKlC7R,EAAO4I,YAElB,eAGA,SAAU,cAAe,EAAG,cAAe,EAAG,WAC9CtI,OAEH,SAAU,YAAa,IAAK,aAAc,MAC1C,UAAW,aAAc,KAAM,gBAC/B,UAAW,aAAc,KAAM,kBAGrCyR,EAAoBzB,EAASlP,MAQpC,KAAKqO,EAAI,EAAOsC,EAAJtC,EAAUA,IAElB,GAAKjP,EAAiBN,EAAQoQ,EAASb,GAAG,IAAI,GAI9C,IADAC,EAAQY,EAASb,GAAG,GACfvO,EAAI,EAAGC,EAAMuO,EAAMtO,OAAYD,EAAJD,EAASA,IACrCyO,EAAYD,EAAMxO,GAAG,GACrB0O,EAAYF,EAAMxO,GAAG,GACrB2O,EAAYH,EAAMxO,GAAG,GACrB4O,EAAYJ,EAAMxO,GAAG,GACrB6O,EAAYL,EAAMxO,GAAG,GACrB8O,EAAYN,EAAMxO,GAAG,GACrB+O,EAAYP,EAAMxO,GAAG,GACrBI,EAAcqO,EAAQC,EAAQC,EAAWC,EAASC,EAAOC,EAASC,EAItE/P,GAAOE,UACPJ,EAAO+B,OACH7B,EAAOE,SAAU,SAAU4B,GACnBpB,QAAQoR,OAAOhQ,EAAKhC,EAAOI,YAI/BC,EAAc2B,EACVpB,QAAQC,kBAAkBN,KAC1BA,EAAiBpB,EAASgB,EAAc,SAE7C,GAUXH,EAAOiS,YAAc,WAEjBjS,EAAOkS,YAAc,IAGzBlS,EAAOM,YAAcA,EA0QzB,QAAS6R,GAAUC,GAEf,GAAIC,GAAa,GACbC,EAAaF,EAASG,OAAOxB,MAOjC,OALIuB,GAASlR,OAAS,IAClBiR,EAAaC,EACbF,EAASG,KAAK,KAGX,SAAgB3H,EAAO5C,EAASvH,GAEnC,GAAIA,EAAMuK,WAAY,CAClB,GAAIwH,GAAc3S,EAAe,eAC7Be,SAAQkB,WAAW0Q,IACnBA,EAAY5H,EAAO5C,EAASzI,EAASC,GAK7CwI,EAAQyK,MAAM,WAEV,QAASC,GAAeC,EAAU/H,GAC9B,GACIgI,GADAC,EAAWF,EAAS,GAAG1K,cAAc,kBAIzC,IADA2C,EAAMgE,QAAU,KACZiE,EAAJ,CAOA,GANIA,EAAcjS,QAAQoH,QAAQ6K,GAC9BD,EAAcC,EAASpF,KAAK,cAKf,CACb,GAAIqF,GAAcxT,EAAOsT,GAAahI,IAAUgI,CAChD,IAA2B,gBAAhBE,GACP,MAAO1T,GAAMsR,IACToC,GACCC,MAAOtT,IACVuT,QACE,SAAUC,GACNA,EAAOA,EAAKlC,MAEZ,IAAImC,GAAgBrE,SAASC,cAAc,MAC3CoE,GAAQC,UAAYF,EACpBC,EAAoBtS,QAAQoH,QAAQkL,GACpCtI,EAAMgE,SAAesE,EAAQ,GAAGjL,cAAc,0BAK1D2C,GAAMgE,SAAWiE,EAAS,GAAG5K,cAAc,mBAG/CnI,GAAiBsT,YAAYxI,EAAOA,EAAMyI,eAyD9C,GAAIC,EACAjB,GAAWjR,OAAS,GACpBkS,EAAeZ,EAAe9R,QAAQoH,QAAQqK,EAAWtB,QAASnG,GACtC,gBAAjB0I,GACPA,EAAaC,KAAK,WACdvL,EAAQ2F,OAAOtO,EAASgT,GAAYzH,MAGxC5C,EAAQ2F,OAAOtO,EAASgT,GAAYzH,KAGxCxL,EAAMsR,IACFjQ,EAAM+S,aAAe9T,EAAiB+T,WACrCV,MAAOtT,IACVuT,QACE,SAAUC,GACNA,EAAerS,QAAQoH,QAAQiL,EAAKlC,QACpCuC,EAAeZ,EAAeO,EAAMrI,GACR,gBAAjB0I,GACPA,EAAaC,KAAK,WACdvL,EAAQ2F,OAAOtO,EAAS4T,GAAMrI,MAGlC5C,EAAQ2F,OAAOtO,EAAS4T,GAAMrI,SAhkC1D,OACI8I,SAAY,IACZ9I,OAAY,EACZZ,SAAY,EACZ2J,YAAa,SAAU,WAAY,SAAU5T,GAC7C6T,QAAYzB,GAkzCpB,QAAS0B,GAAsBtU,EAASC,EAAWL,EAAU2U,EAAIzU,GAyB7D,QAAS0U,KASL,MAPAC,IACIC,MAAQC,EAAQC,KAAK,gBAAkBtF,SAASuF,gBAAgBC,YAChEnF,OAAQgF,EAAQC,KAAK,iBAAmBtF,SAASuF,gBAAgBE,aACjEpG,IAAQ1O,EAAU,GAAG+U,KAAKC,WAAahV,EAAU,GAAG4U,gBAAgBI,UACpExG,KAAQxO,EAAU,GAAG+U,KAAKE,YAAcjV,EAAU,GAAG4U,gBAAgBK,YAGrEC,GAAcC,OACdC,GAAc,IAGlBF,GAAa,MAEbG,MAGJ,QAASA,KACL,IAAIF,EAAJ,CAIA,GAAiDG,GAA7CC,EAASA,EAAS,EAAIA,EAASC,EAAM5T,MAErC2T,GAAS,GACTD,EAAOE,EAAM,GAEbL,GAAa,EACbM,EAAa9V,EAAS,WAIlB6V,EAAM1K,OAAO,EAAG,GAChBqK,GAAW,EACXI,IACA5V,EAAS+V,OAAOD,GAChBJ,KACD,KAGHH,GAAa,EACTE,IACAA,GAAc,EACdb,OAyBZ,QAASoB,GAAYnN,GACjBoN,EAAWpN,EAOf,QAASqN,KACL,MAAOD,GAMX,QAASE,KACLnW,EAAS+V,OAAOK,GAChBA,EAAgBpW,EAAS,WACrB4U,KACD,KAQP,QAAStJ,GAAIG,EAAO5C,GAEhBsN,IACAN,EAAM3R,MACF2E,QAASA,EACT4C,MAASA,IAIjB,QAASwI,GAAYxI,EAAO+H,GACxB6C,EAAe7C,EAOnB,QAAS8C,KACL,MAAOT,GAzIX,GAIIhB,GAEAwB,EACAD,EACAN,EARAG,EAAgB,KAChBV,GAAgB,EAChBC,GAAgB,EAChBC,GAAgB,EAEhBI,KAIAU,GACIP,YAAeA,EACfE,YAAeA,EACf5K,IAAeA,EACf2I,YAAeA,EACfqC,SAAeA,EACfH,cAAeA,GAEnBpB,EAAgBtT,QAAQoH,QAAQzI,EAIpC,OAFA2U,GAAQyB,GAAG,qBAAsBL,GAE1BI,EA4nDP,QAAS7U,GAAkBmB,GACvB,MAAOpB,SAAQE,YAAYkB,IAAgB,OAARA,EAGvC,QAAS8D,GAAU9D,GACf,QAASpB,QAAQE,YAAYkB,IAAgB,OAARA,GA3vGzCpB,QAAQC,kBAAoBA,EAE5BD,QAAQkF,UAAYA,EAEpBlF,QAAQgV,OAAO,eAAgB,kCAC1BC,SACD,iBACIhO,KAAQ,WACRmH,MAAQ,iBACR5B,OAAQ,kBACR1J,KAAQ,gBACRoS,MAAQ,iBACRC,OAAQ,kBACR9G,MAAQ,uBACRjD,KAAQ,gBACRqC,OAAQ,kBACRrJ,MACIiC,EAAM,4BACNE,EAAM,2BACNE,KAAM,8BAGhBzG,QAAQgV,OAAO,eAChBI,UACD,WACI,WAAY,SAAU3W,GAClB,OACIqU,SAAU,IACVuC,KAAU,SAAUrL,EAAO5C,EAASvH,GAChCmK,EAAM7I,OACFtB,EAAMmT,QAAS,SAAUsC,GACjBA,IACItV,QAAQkB,WAAWkG,EAAQgH,OAC3BhH,EAAQgH,QAERhH,EAAQuK,KAAK,IAGjBvK,EAAQ2F,OAAOtO,EAAS6W,GAAStL,YAQ5DoL,UACD,kBACI,WAAY,SAAU3W,GAClB,OACIqU,SAAU,IACVuC,KAAU,SAAUrL,EAAO5C,EAASvH,GAChCmK,EAAM7I,OACFtB,EAAM0V,eAAgB,SAAUD,GACxBA,GACAlO,EAAQoO,YAAY/W,EAAS6W,GAAStL,WAStEhK,QAAQgV,OAAO,eACVI,UACD,oBAAqB,WACjB,OACItC,SAAU,IACV9I,OAAU,EACVqL,KAAU,SAAUrL,EAAO5C,EAASvH,GAChCmK,EAAM/D,MAAQ,oBACV+D,EAAM7F,OAAOgR,QACb/N,EAAQmF,SAASvC,EAAM7F,OAAOgR,YAOlDnV,QAAQgV,OAAO,eACVI,UACD,eAAgB,mBAAoB,WAAY,SAAUlW,EAAkBX,GAMxE,QAASkX,GAAOzL,EAAO5C,EAASvH,GAiF5B,QAAS6V,GAAYC,EAAQC,EAAQ5L,GAwEjC,QAAS6L,GAAc/S,EAAMC,GACzB,GAAI+S,GAAY9L,EAAMG,SAASrH,EAmB/B,OAlBIgT,GACI/S,GAAUA,EAAOa,cAAiBb,EAAOsB,aACzCyR,EAAUzW,SAAS2N,YAAYhD,EAAM7F,OAAOqI,QAC5C1J,EAAKuB,aAAc,IAEnByR,EAAUzW,SAASkN,SAASvC,EAAM7F,OAAOqI,QACzC1J,EAAKuB,aAAc,GAInBtB,GAAUA,EAAOa,cAAiBb,EAAOsB,YACzCvB,EAAKuB,aAAc,EAEnBvB,EAAKuB,aAAc,EAKpBvB,EAAKc,gBAAiB,EA1FjCkB,QAAQC,KAAK,eACb,IACI1B,GADA0S,EAAS/L,EAAMgM,EAGnB,IAAIC,EACA5S,EAAwB0S,EAAO9R,SAC/B8R,EAAO7R,eAAiB8F,EAAM7F,OAAOC,KAAKf,OACvC,CAEH,GAIID,GAJA8S,EAAaH,EAAOrS,gBACpB6K,EAAavE,EAAMrE,WAAWuQ,IAAe,KAC7CC,EAAaJ,EAAOtS,aACpB3B,EAAaqU,EAAQ3V,MAqCzB,IAlCKuV,EAAOnM,aACRmM,EAAOnM,YAAa,GAGpBmM,EAAOrR,cAAgB0R,IAEvBpM,EAAMD,YAAYC,EAAO+L,GAGzB/L,EAAME,SAASF,EAAO+L,GACtBK,EAAUL,EAAOrR,cAGjB6J,GAAgBA,EAAW3K,cAAiB2K,EAAWlK,aAIvD+C,EAAQ4F,YAAYhD,EAAM7F,OAAOqI,QACjCuJ,EAAO1R,aAAc,IAJrB+C,EAAQmF,SAASvC,EAAM7F,OAAOqI,QAC9BuJ,EAAO1R,aAAc,GAOrBhB,EADS,IAATvB,EACQ,GAEJiU,EAAOnS,aACC,EAEA,EAIhBmS,EAAO9R,SAAiBZ,EACxB0S,EAAO7R,eAAiB8F,EAAM7F,OAAOC,KAAKf,GAEtC2G,EAAMgE,QACN,IAAK5K,EAAK,EAAQtB,EAALsB,EAAWA,IACpB4G,EAAMrD,oBAAoBwP,EAAQ/S,GAAKyS,EAAeE,GAAQ,OAG7DM,KACDA,EAAarM,EAAM7C,oBAGnB4O,EAAOnS,aACPyS,EAAWrJ,YAAYhD,EAAM7F,OAAOqI,QAEpC6J,EAAW9J,SAASvC,EAAM7F,OAAOqI,QAM7C1H,QAAQc,QAAQ,gBAChBqQ,GAAa,EArJjBjM,EAAMsM,YAAc,GAEhBtM,EAAM7F,OAAOrB,OACbsE,EAAQmF,SAASvC,EAAM7F,OAAOrB,MAC9BkH,EAAMsM,YAActM,EAAM7F,OAAOrB,KAErC,IAGIuT,GAHAE,EAA0C,iBAAtBvM,GAAMlB,aAA0D,iBAAtBkB,GAAM1B,YACpE0N,EAAanW,EAAM2W,YACnBP,GAAa,CAGjBnR,SAAQ2R,IAAI,gBACZvX,EAAiB2K,IAAIG,EAAO5C,GAExBmP,IACAvM,EAAM/D,MAAQ,cAEd+D,EAAM0M,QAAU,WACZ,MAAO1M,GAAMgM,KAIrBhM,EAAM3K,SAAsB+H,EAC5B4C,EAAMgM,GAASpM,YAAa,EAE5BI,EAAM7C,iBAAmB,WACrB,MAAOnH,SAAQoH,QAAQA,EAAQ,GAAGC,cAAc,sBAGpD2C,EAAME,SAASF,EAAOA,EAAMgM,IAE5BhM,EAAM2M,aAAe,WACjB,MAAO3M,GAGX,IACI4M,GACAtW,EAFAuW,KAEGC,EAAQ7U,OAAOC,KAAK8H,EAAMgM,IAC7Be,EAAWD,EAAKtW,OAChB4V,EAAWpM,EAAMgM,GAAStR,YAC1BsS,GACI,cACA,eACA,YACA,YACA,iBAEA,aACA,kBACA,WACA,WACA,kBAEJC,GACI,gBAEJC,EAAWD,EAASzW,MAGxB,KAAKF,EAAI,EAAOyW,EAAOG,EAAX5W,EAAoBA,IACpByW,EAAJzW,EACkC,KAA9B0W,EAAS3V,QAAQyV,EAAKxW,KACtBuW,EAASpU,KAAKuT,EAAU,IAAMc,EAAKxW,IAGE,KAArCwW,EAAKzV,QAAQ4V,EAAS3W,EAAIyW,KAC1BF,EAASpU,KAAKuT,EAAU,IAAMiB,EAAS3W,EAAIyW,GAKvDH,GAAU,IAAMC,EAASM,KAAK,KAAO,IAErCnN,EAAM7I,OAAOyV,EAASlB,GAAa,GAEnC1L,EAAMoN,IAAI,WAAY,WAClBpN,EAAMD,YAAYC,EAAOA,EAAMgM,MAnFvC,OACIlD,SAAU,IACV1J,SAAU,EACViM,KAAUI,MAsLtBzV,QAAQgV,OAAO,eACVI,UACD,eAAgB,WACZ,OACItC,SAAU,IACV1J,SAAU,EACViM,KAAU,SAAUrL,EAAO5C,GACvB4C,EAAM/D,MAAQ,eAEV+D,EAAM7F,OAAO+Q,OACb9N,EAAQmF,SAASvC,EAAM7F,OAAO+Q,OAC9BlL,EAAMqN,aAAerN,EAAM7F,OAAO+Q,OAElClL,EAAMqN,aAAe,OAOzCrX,QAAQgV,OAAO,eACVI,UACD,UAAW9W,GAEfA,EAAcgZ,SACV,WAAY,QAAS,WAAY,SAAU,UAAW,YAAa,iBACnE,mBAAoB,gBAAiB,iBAAkB,iBAAkB,oBAilC7EtX,QAAQgV,OAAO,eACVuC,QACD,kBAAmB,WACf,GAAIC,IACAC,UAAW,SAAUpF,EAAMxB,EAAY6G,GACnC,IAAKrF,GAAwB,IAAhBA,EAAK7R,SAAiBqQ,IAAe6G,EAC9C,QAUJ,KARA,GAKIC,GAAU5U,EALVkE,KACA2Q,KACA1D,EAAO7B,EAAK,GACZwF,EAAW3D,EAAKrD,GAChBiH,KAEAvX,EAAM8R,EAAK7R,OACXF,EAAI,EACGC,EAAJD,GACH4T,EAAO7B,EAAK/R,KACZuX,EAAW3D,EAAKrD,GAChBiH,EAASD,GAAY3D,EACrByD,EAAWzD,EAAKwD,GACZC,GACA5U,EAAS+U,EAASH,GACd5U,EAAOU,aACPV,EAAOU,aAAahB,KAAKyR,GAEzBnR,EAAOU,cAAgByQ,IAG3B0D,EAAQnV,KAAKoV,EAIrB,KADAtX,EAAMqX,EAAQpX,OACTF,EAAI,EAAOC,EAAJD,EAASA,IACjB2G,EAAKxE,KAAKqV,EAASF,EAAQtX,IAE/B,OAAO2G,IAEX8Q,UAAW,QAASC,GAAa3F,EAAM4F,GACnC,GACI7U,GAEA8U,EAAOC,EAHPC,KAEAtW,EAAOuQ,EAAOA,EAAK7R,OAAS,CAEhC,KAAK4C,EAAK,EAAQtB,EAALsB,EAAWA,IACpB8U,EAAQlY,QAAQmG,KAAKkM,EAAKjP,IACtBpD,QAAQG,QAAQ+X,EAAMD,KAAgBC,EAAMD,GAAYzX,OAAS,IACjE2X,EAASH,EAAaE,EAAMD,GAAaA,SAC9BC,GAAMD,GACjBC,EAAMzU,aAAe0U,GAEzBC,EAAM3V,KAAKyV,EAEf,OAAOE,IAIf,OAAOZ,KAIfxX,QAAQgV,OAAO,eACVuC,QACD,kBACI,YAAa,UAAW,SAAU3Y,EAAWD,GACzC,GAAI0Z,IACAC,OAAiB,SAAUC,GACvB,MAAgD,mBAAlCA,GAAU1L,KAAK,gBAEjC2L,SAAiB,SAAUtL,GACvB,GAAIuL,GAAMvL,CAMV,OALwBwL,UAApBxL,EAAEyL,cACFF,EAAMvL,EAAEyL,cAAczE,KAAK,GACAwE,SAApBxL,EAAE0L,eAAiEF,SAAlCxL,EAAE0L,cAAcD,gBACxDF,EAAMvL,EAAE0L,cAAcD,cAAczE,KAAK,IAEtCuE,GAEXtQ,SAAiB,SAAU6B,GACvB,GAAIwB,GAAQxB,EAAM0M,UACd0B,EAAQpO,EAAM2E,eACd/C,EAAU5B,EAAM6D,QAAQrC,EAAM9H,gBAClC,QACIZ,KAAS0I,EACTzI,OAAS6I,EACTD,MACI5I,OAAQ6I,EACR9B,IAAQ0B,EAAM1H,WAElBkG,MAASA,EACTqB,OAAS+M,EACThN,KAASgN,EACTS,KAAS7O,EAAM2D,eAAenC,GAC9BL,SAAS,IAGjBmD,OAAiB,SAAUlH,GACvB,MAAOA,GAAQmM,KAAK,iBAExBF,MAAiB,SAAUjM,GACvB,MAAOA,GAAQmM,KAAK,gBAExBuF,OAAiB,SAAU1R,GACvB,GAAI2R,GAAqB3R,EAAQ,GAAG4R,uBACpC,QACI3F,MAAQjM,EAAQmM,KAAK,eACrBjF,OAAQlH,EAAQmM,KAAK,gBACrBjG,IAAQyL,EAAmBzL,KAAO3O,EAAQsa,aAAera,EAAU,GAAG+U,KAAKC,WAAahV,EAAU,GAAG4U,gBAAgBI,WACrHxG,KAAQ2L,EAAmB3L,MAAQzO,EAAQua,aAAeta,EAAU,GAAG+U,KAAKE,YAAcjV,EAAU,GAAG4U,gBAAgBK,cAG/HsF,gBAAiB,SAAUjM,EAAG7B,GAC1B,GAAIvB,KAOJ,OANAA,GAAIsP,QAAUlM,EAAEG,MAAQ5L,KAAKqX,OAAOzN,GAAQ+B,KAC5CtD,EAAIuP,QAAUnM,EAAEK,MAAQ9L,KAAKqX,OAAOzN,GAAQiC,IAC5CxD,EAAIwP,OAASxP,EAAIyP,MAAQrM,EAAEG,MAC3BvD,EAAI0P,OAAS1P,EAAI2P,MAAQvM,EAAEK,MAC3BzD,EAAI4P,KAAO5P,EAAI6P,KAAO7P,EAAI8P,MAAQ9P,EAAI+P,MAAQ/P,EAAIgQ,MAAQ,EAC1DhQ,EAAIiQ,KAAOjQ,EAAIkQ,KAAOlQ,EAAImQ,SAAWnQ,EAAIoQ,SAAWpQ,EAAIqQ,QAAUrQ,EAAIsQ,QAAU,EACzEtQ,GAEXuQ,cAAiB,SAAUnN,EAAGpD,EAAKwQ,GAE/BxQ,EAAIyP,MAAQzP,EAAI4P,KAChB5P,EAAI2P,MAAQ3P,EAAI6P,KAEhB7P,EAAI4P,KAAOxM,EAAEG,MACbvD,EAAI6P,KAAOzM,EAAEK,MAEbzD,EAAI8P,MAAQ9P,EAAI4P,KAAO5P,EAAIyP,MAC3BzP,EAAI+P,MAAQ/P,EAAI6P,KAAO7P,EAAI2P,MAE3B3P,EAAImQ,SAAWnQ,EAAIiQ,KACnBjQ,EAAIoQ,SAAWpQ,EAAIkQ,KAEnBlQ,EAAIiQ,KAAqB,IAAdjQ,EAAI8P,MAAc,EAAI9P,EAAI8P,MAAQ,EAAI,EAAI,GACrD9P,EAAIkQ,KAAqB,IAAdlQ,EAAI+P,MAAc,EAAI/P,EAAI+P,MAAQ,EAAI,EAAI,EAErD,IAAIU,GAAQhW,KAAKiW,IAAI1Q,EAAI8P,OAASrV,KAAKiW,IAAI1Q,EAAI+P,OAAS,EAAI,CAE5D,OAAIS,IACAxQ,EAAIgQ,MAAQS,OACZzQ,EAAI2Q,QAAS,KAIb3Q,EAAIgQ,QAAUS,GACdzQ,EAAIqQ,QAAU,EACdrQ,EAAIsQ,QAAU,IAEdtQ,EAAIqQ,SAAW5V,KAAKiW,IAAI1Q,EAAI8P,OACX,IAAb9P,EAAIiQ,MAAcjQ,EAAIiQ,OAASjQ,EAAImQ,WACnCnQ,EAAIqQ,QAAU,GAElBrQ,EAAIsQ,SAAW7V,KAAKiW,IAAI1Q,EAAI+P,OACX,IAAb/P,EAAIkQ,MAAclQ,EAAIkQ,OAASlQ,EAAIoQ,WACnCpQ,EAAIsQ,QAAU,SAGtBtQ,EAAIgQ,MAAQS,KAEhBG,cAAiB,SAAU1Q,EAAO5C,EAASvB,EAAQgH,GAC/CA,EAAQA,GAAQ,OAChB7M,QAAQoH,QAAQA,EAAQuT,WAAW,IAAIxN,IAAIN,EAAM7C,EAAMhC,WAAWO,WAAW1C,KAGrF,OAAOwS,MAInBrY,QAAQgV,OAAO,eACVuC,QACD,kBAAkB,YAAa,SAAUqD,GACrC,GAAIC,GAAS,SAAUC,GACf,MAAI9a,SAAQkF,UAAU0V,IAAcA,EAAUG,IAAID,GACvCF,EAAU9K,IAAIgL,GAElB,KAEf,OAAOD,MAIf7a,QAAQgV,OAAO,eACVuC,QACD,oBACI,iBAAkB,SAAU1Y,GACxB,GAII4K,GAJAuR,EAAe,gCACfC,EAAW,0CACXC,EAAW,0CACXC,KAEAC,GACInL,QAAS,SAAUoL,EAAMrR,GAChBmR,EAAOnR,EAAMsR,OACdH,EAAOnR,EAAMsR,SAEjBH,EAAOnR,EAAMsR,KAAKJ,SAAWG,GAEjCtL,QAAS,SAAUsL,EAAMrR,GAChBmR,EAAOnR,EAAMsR,OACdH,EAAOnR,EAAMsR,SAEjBH,EAAOnR,EAAMsR,KAAKL,SAAWI,GAEjCxI,QAAS,WACL,MAAOmI,IAEXpO,QAAS,SAAU5C,GACf,MAAImR,GAAOnR,EAAMsR,MAAQH,EAAOnR,EAAMsR,KAAKL,WACvCxR,EAAO5K,EAAeiR,IAAIqL,EAAOnR,EAAMsR,KAAKL,WAEjCxR,EAGR5K,EAAeiR,IAAImL,IAE9BtO,QAAS,SAAU3C,GACf,MAAImR,GAAOnR,EAAMsR,MAAQH,EAAOnR,EAAMsR,KAAKJ,WACvCzR,EAAO5K,EAAeiR,IAAIqL,EAAOnR,EAAMsR,KAAKJ,WAEjCzR,EAGR5K,EAAeiR,IAAIoL,IAItC,OAAOE,MAInBpb,QAAQgV,OAAO,eACVuC,QAAQ,mBAAoBtE,GAEjCA,EAAsBqE,SAAW,UAAW,YAAa,WAAY,KAAM,YAiJ3EtX,QAAQgV,OAAO,eACVuC,QACD,kBACI,UAAW,SAAUgE,GAGjB,QAAS5U,GAAoB6U,EAAS1Y,EAAM2Y,EAAYxa,EAAUD,EAAS0a,GACvE,IAAK1b,QAAQkB,WAAWD,GACpB,MAAO,KAGX,IAAImC,GAAItB,EAAM+E,EACV8U,EAAe1a,EAASua,EAAS1Y,GACjC8Y,GAAe,CAEnB,IAAI5b,QAAQkF,UAAUpC,EAAK2Y,IAGvB,IAFA5U,EAAS/D,EAAK2Y,GACd3Z,EAAS+E,EAAOrG,OACX4C,EAAK,EAAQtB,EAALsB,EAAWA,IACpBwY,EAAejV,EACP6U,EACA3U,EAAOzD,GACPqY,EACAxa,EACAD,EACO2a,GAAeD,IACrBE,CAQjB,OAJI5b,SAAQkB,WAAWF,IACnBA,EAAQwa,EAAS1Y,EAAM6Y,KAAgB,EAAMC,KAAiB,EAAMF,KAAiB,GAGlFC,GAAeC,EAU1B,QAASC,GAASC,EAAUzJ,GACxB,GAAIrS,QAAQC,kBAAkBoS,IAASrS,QAAQG,QAAQkS,GACnD,MAAO,KAGX,IAAIrS,QAAQkB,WAAW4a,GACnB,MAAOA,GAASzJ,EAAMkJ,EAEtB,IAAwB,iBAAbO,GAEP,MADAzJ,KAASA,EACFA,IAASyJ,CACb,KAAI9b,QAAQkF,UAAU4W,GAazB,MAAO,KAZP,KACI,GAAI3Z,GAAS,GAAIC,QAAO0Z,EACxB,OAAO3Z,GAAOE,KAAKgQ,GAEvB,MAAO0J,GACH,MAAoB,gBAAT1J,GACAA,EAAKhR,QAAQya,GAAY,GAEzB,MAmB3B,QAASE,GAAYlZ,EAAMmZ,EAAWlc,GAClC,GAAIC,QAAQG,QAAQ8b,GAChB,MAAOC,GAAgBpZ,EAAMmZ,EAAWlc,EAExC,IAEIoc,GAAKC,EAAQC,EAFbnT,EAAY+S,EAAUvZ,MACtB4Z,EAAYL,EAAUH,QAG1B,IAAa,OAAT5S,GAGA,IAFAkT,EAASna,OAAOC,KAAKY,GACrBuZ,EAASD,EAAO5b,OACX2b,EAAM,EAASE,EAANF,EAAaA,IACvB,GAAIN,EAASS,EAAWxZ,EAAKsZ,EAAOD,KAChC,OAAO,MAGZ,IAAInc,QAAQkF,UAAUpC,EAAKoG,IAC9B,MAAO2S,GAASS,EAAWxZ,EAAKoG,GAGxC,OAAO,MAUX,QAASgT,GAAgBpZ,EAAMyZ,EAAYxc,GACvC,GAAIO,GAAGC,EAAMgc,EAAW/b,QAAU,EAAGC,GAAS,CAC9C,IAAY,IAARF,EACA,MAAO,KAGX,KAAKD,EAAI,EAAOC,EAAJD,EAASA,IACjB,GAAI0b,EAAYlZ,EAAMyZ,EAAWjc,IAAKP,IAGlC,GAFAU,GAAS,GAEJV,EACD,OAAO,MAKX,IAAIA,EACA,OAAO,CAKnB,OAAOU,GAYX,QAAS+b,GAAShB,EAAS1Y,EAAM2Z,EAAcC,EAAeC,GAC1D,MAAIF,MAAiB,GACjB3Z,EAAK8Z,cAAuB,OAC5B9Z,EAAK+Z,sBAAuB,IAErBH,KAAkB,GAAQlB,EAAQjM,cAAe,GAC9CoN,KAAmB,GAAQnB,EAAQhM,aAAc,GAC3D1M,EAAK8Z,cAAuB,OAC5B9Z,EAAK+Z,sBAAuB,WAKzB/Z,GAAK8Z,wBACL9Z,GAAK+Z,sBAYhB,QAASC,GAAUtB,EAAS1Y,GACxB,MAA8B,KAA1B0Y,EAAQjW,OAAO/E,QACR,EAEAwb,EAAYlZ,EAAM0Y,EAAQjW,OAAQiW,EAAQ/L,WAAY,GAWrE,QAASsN,GAAWzM,GAChB,GAAIE,GAAKE,EAAOD,EACZuM,EACAC,CAEJ,IAAIjd,QAAQkd,SAAS5M,KAAatQ,QAAQG,QAAQmQ,GAAU,CAKxD,GAJAG,EAAUxO,OAAOC,KAAKoO,GACtBI,EAAUD,EAAOjQ,OACjBwc,KAEItM,EAAQ,EACR,IAAKF,EAAM,EAASE,EAANF,EAAaA,KAEa,gBAAzBF,GAAQG,EAAOD,KAAsD,IAAhCF,EAAQG,EAAOD,IAAMhQ,UAGjEyc,EADOjd,QAAQG,QAAQmQ,EAAQG,EAAOD,KAC7BF,EAAQG,EAAOD,IACjBxQ,QAAQkd,SAAS5M,EAAQG,EAAOD,KAC9BuM,EAAWzM,EAAQG,EAAOD,MAG/B9N,MAAU+N,EAAOD,GACjBsL,SAAUxL,EAAQG,EAAOD,KAGjCwM,EAAQva,KAAKwa,GAIrB,OADAA,GAAS,KACFD,EAGP,MAAO1M,GAcf,QAAS6M,GAAa3d,EAAU8Q,EAASkL,EAAS4B,GAC9C,IAAKpd,QAAQG,QAAQX,IACM,IAApBA,EAASgB,SACPR,QAAQG,QAAQmQ,KAAYtQ,QAAQkd,SAAS5M,IAC5B,IAAnBA,EAAQ9P,OACX,MAAOhB,EAGX,IAAI4D,GAAItB,EACJkb,CAGJ,IADAA,EAAUD,EAAWzM,IACftQ,QAAQG,QAAQ6c,KAAYhd,QAAQkd,SAASF,IACzB,IAAnBA,EAAQxc,OACX,MAAOhB,EAGX,KADAgc,EAAQjW,OAASyX,EACZ5Z,EAAK,EAAGtB,EAAOtC,EAASgB,OAAasB,EAALsB,EAAWA,IAC5CuD,EACI6U,EACAhc,EAAS4D,GACTga,GAAY,eACZN,EAAWN,EAInB,OAAOhd,GAhQX,MAAO2d,MAsQnBnd,QAAQgV,OAAO,eACVuC,QACD,mBACI,UAAW,SAAUgE,GACjB,GAAI8B,GAAa9B,EAAQ,WACrB5U,EAAsB,QAASA,GAAoB6U,EAAS1Y,EAAMgY,EAAMwC,GACpE,GAAIla,GAAItB,EAAM+E,CAEd,IAAI7G,QAAQkF,UAAUpC,EAAKgY,IAAQ,CAI/B,IAHAjU,EAAS/D,EAAKgY,GACdhZ,EAAO+E,EAAOrG,OAET4C,EAAK,EAAQtB,EAALsB,EAAWA,IACpByD,EAAOzD,GAAMuD,EAAoB6U,EAAS3U,EAAOzD,GAAK0X,EAAMwC,EAGhExa,GAAKgY,GAAQwC,EAAUxa,EAAKgY,GAAOU,GAEvC,MAAO1Y,IAEXya,EAAW,SAAkBC,EAAMnY,GAC/B,MAAOgY,GAAWG,EAAMnY,IAE5BoY,EAAU,SAAiBje,EAAU6F,GACjC,IAAKrF,QAAQG,QAAQX,IACM,IAApBA,EAASgB,UACPR,QAAQG,QAAQkF,IAAYrF,QAAQkd,SAAS7X,IAAYrF,QAAQ0d,SAASrY,IAAYrF,QAAQkB,WAAWmE,KACxF,IAAnBA,EAAQ7E,SAAiBR,QAAQkB,WAAWmE,GAC/C,MAAO7F,EAGX,IAAI4D,GAAItB,CAER,KAAKsB,EAAK,EAAGtB,EAAOtC,EAASgB,OAAasB,EAALsB,EAAWA,IAC5C5D,EAAS4D,GAAMuD,EACXtB,EACA7F,EAAS4D,GACT,eACAma,EAIR,OAAOA,GAAS/d,EAAU6F,GAGlC,OAAOoY,MAInBzd,QAAQgV,OAAO,eACVuC,QACD,gBACI,WAAY,iBACZ,SAAUhZ,EAAUS,GAChB,QAAS2e,GAAezQ,EAAG0Q,GACvB,GAAIA,EAAQtT,SAAU,CAClB,GAAIuT,GAAU7e,EAAe8Z,OAAO8E,EAAQtT,SAC5C,IAAIuT,EAAQvQ,KAAOJ,EAAEK,OAASL,EAAEK,OAASsQ,EAAQvQ,IAAMuQ,EAAQvP,QAC3DuP,EAAQzQ,MAAQF,EAAEG,OAASH,EAAEG,OAASwQ,EAAQzQ,KAAOyQ,EAAQxK,MAE7D,OAAO,EAGf,OAAO,EAGX,QAASyK,GAAa5Q,EAAG0Q,GACrB,IAAKA,EAAQG,UAA0B,IAAb7Q,EAAE8Q,QAA4B,IAAZ9Q,EAAE+Q,UAI1C/Q,EAAEgR,gBAAkBhR,EAAE0L,eAAiB1L,EAAE0L,cAAcsF,gBAA3D,CAIA,GAAIC,GAAane,QAAQoH,QAAQ8F,EAAE7B,QAC/B+S,EAAaD,EAASnU,OAC1B,IAAKoU,GAAeA,EAAWnY,OAON,sBAArBmY,EAAWnY,MAAf,CAIA,GACIoY,GADAC,EAAkBH,EAAS5K,KAAK,WAAWgL,cAE3CC,EAAkBZ,EAAQxe,MAC9B,IAAwB,UAApBkf,GACuB,aAApBA,GACoB,WAApBA,GACoB,WAApBA,EAHP,CAOA,KAAOH,GAAYA,EAAS,IAAMA,EAAS,KAAOP,EAAQxW,SAAS,CAC/D,GAAIpI,EAAesZ,OAAO6F,GACtB,MAEJA,GAAWA,EAASpb,SAaxB,GAVAmK,EAAEgR,gBAAiB,EACfhR,EAAE0L,gBACF1L,EAAE0L,cAAcsF,gBAAiB,GAErChR,EAAEuR,iBAEFJ,EAAYD,EAAWzH,eAEvBiH,EAAQzV,SAAWnJ,EAAemJ,SAASkW,GAEtCG,EAAQxW,WAAW+C,WAAWsT,EAAWT,EAAQzV,UAAtD,CAIAyV,EAAQtD,aAAc,EACtBkE,EAAQtS,YAAY0R,EAAQzV,SAE5B,IAAIqQ,GAAWxZ,EAAewZ,SAAStL,EACvC0Q,GAAQ9T,IAAO9K,EAAema,gBAAgBX,EAAU6F,EAAUhf,UAE9Dgf,EAAUrQ,QACV4P,EAAQ7P,QAAU/N,QAAQoH,QAAQwW,EAAQjf,QAAQsP,SAASC,cAAc,UACpE3B,SAASiS,EAAQra,OAAO8C,MACxBsF,SAASiS,EAAQra,OAAOiH,MACxBmB,SAASiS,EAAQxY,aAEtB4X,EAAQ7P,QAAU/N,QAAQoH,QAAQwW,EAAQjf,QAAQsP,SAASC,cAAc,OACpE3B,SAASiS,EAAQra,OAAOiH,MACxBmB,SAAS,kBACTA,SAASiS,EAAQxY,aAG1B4X,EAAQ7P,QAAQZ,KAERkG,MAAWrU,EAAeqU,MAAMgL,EAAUhf,UAAY,KACtDmO,UAAW,OAInBoQ,EAAQc,WAAa,CACrB,IAGI7W,GAGA8W,EACAC,EAPAC,EAAiB7f,EAAeqU,MAAMgL,EAAUhf,UAChDyf,EAAiBT,EACjB3M,EAAiBoN,EAAOzf,SAExB0f,IAAmBP,EAAQ5T,gBAC3BoU,GAAiB,CAIjBF,GAAO9Q,SACP4P,EAAQc,WAAad,EAAQzV,SAASrF,KAAKkB,UAAY,EACvD2a,EAAqB3e,QAAQoH,QAAQ6G,SAASC,cAAc,UAC5D0Q,EAAqB5e,QAAQoH,QAAQ6G,SAASgR,0BAE9CT,EAAQ7X,oBACJiX,EAAQzV,SAASrF,KAAM,SAAU0I,EAAOI,GA6BpC,MA5BAkT,GAAWN,EAAQrU,SAASqB,GAC5BkG,EAAWoN,GAAUA,EAAOzf,SACxByf,GAAUpN,IACLsN,IACDnX,EAAS6J,EAASrI,QAElBrK,EAAe0b,cACX8D,EACA3W,EACA2D,EAAMxH,UAAY4Z,EAAQc,WAC1B,gBAGJE,EAAM7R,OAAOlF,GAGTkX,IACAC,GAAU,GAIVR,EAAQ/T,aAAe+T,EAAQra,OAAOqI,UACpCZ,GAAWJ,EAAMnH,aAAeuH,EAAQvH,aAAeuH,EAAQhI,eACjE8N,EAASnF,SAASiS,EAAQra,OAAOqI,UAKtCwS,GAAWxT,EAAMnH,eAAgB,GAASmH,EAAM5H,gBAAiB,GAEzE,MAAOmb,GAEdJ,EAAO5R,OAAO6R,GACdhB,EAAQ7P,QAAQhB,OAAO4R,KAGvB9W,EAAS6J,EAASrI,QACd0V,GACAlX,EAAO,GAAGR,cAAc,oBAAoBkC,SAIhDqU,EAAQ7P,QAAQhB,OAAOlF,GACnB2W,EAAQ/T,aAAe+T,EAAQra,OAAOqI,QACtCkF,EAASnF,SAASiS,EAAQra,OAAOqI,SAIzCoR,EAAQ7P,QAAQZ,KAERC,KAAQoL,EAASnL,MAAQuQ,EAAQ9T,IAAIsP,QAAUoF,EAAQxW,WAAWO,WAC1DqV,EAAQc,WAAa,GACrB,GACA,GACJ,KACJpR,IAAQkL,EAASjL,MAAQqQ,EAAQ9T,IAAIuP,QAAU,OAIvDuE,EAAQhf,UAAUkO,KAAK,QAAQC,OAAO6Q,EAAQ7P,SAC1CyQ,EAAQxW,WAAWY,cACnBgV,EAAQtT,SAAWkU,EAAQ1Q,UAAUuQ,EAAUhf,SAAUue,EAAQ7P,SAE7DsQ,EAAUrQ,SACVhP,EAAe0b,cAAc8D,EAASZ,EAAQtT,SAAUsT,EAAQzV,SAASrF,KAAKkB,WAGlF4Z,EAAQtT,SAAS6C,IAAI,QAAS0R,IAGlCL,EAAQ9P,YACR8P,EAAQ9Q,WAAa,EAEjB8Q,EAAQnS,gBACRmS,EAAQ/R,gBACR+R,EAAQvR,kBAAkBC,IAG9BlN,QAAQoH,QAAQwW,EAAQhf,WAAWsgB,KAAK,WAAYtB,EAAQuB,cAC5Dnf,QAAQoH,QAAQwW,EAAQhf,WAAWsgB,KAAK,cAAetB,EAAQuB,cAC/Dnf,QAAQoH,QAAQwW,EAAQhf,WAAWsgB,KAAK,YAAatB,EAAQwB,eAC7Dpf,QAAQoH,QAAQwW,EAAQhf,WAAWsgB,KAAK,UAAWtB,EAAQuB,cAC3Dnf,QAAQoH,QAAQwW,EAAQhf,WAAWsgB,KAAK,YAAatB,EAAQwB,eAC7Dpf,QAAQoH,QAAQwW,EAAQhf,WAAWsgB,KAAK,aAActB,EAAQyB,iBAE9DzB,EAAQ0B,gBAAkB/a,KAAKgb,IAC3B3B,EAAQjK,KAAK6L,aACb5B,EAAQjK,KAAK8L,aACb7B,EAAQjM,KAAK+B,aACbkK,EAAQjM,KAAK6N,aACb5B,EAAQjM,KAAK8N,cAGjB7B,EAAQ8B,eAAiBnb,KAAKgb,IAC1B3B,EAAQjK,KAAKgM,YACb/B,EAAQjK,KAAKiM,YACbhC,EAAQjM,KAAK8B,YACbmK,EAAQjM,KAAKgO,YACb/B,EAAQjM,KAAKiO,iBAIrB,QAASC,GAAY3S,EAAG0Q,GACpB,GAAIY,GAAUZ,EAAQxe,MACtB,KAAKwe,EAAQkC,YAST,YARKlC,EAAQmC,eACTnC,EAAQkC,aAAc,EACtBtB,EAAQld,WACJ,WACIkd,EAAQxW,WAAWgE,UAAU4R,EAAQzV,aAOrD,IAAIyV,EAAQ7P,QAAS,CACjBb,EAAEuR,iBACEb,EAAQjf,QAAQqhB,aAChBpC,EAAQjf,QAAQqhB,eAAeC,kBACxBrC,EAAQjf,QAAQsP,SAASiS,WAChCtC,EAAQjf,QAAQsP,SAASiS,UAAU9R,OAGvC,IAAIoK,GAAaxZ,EAAewZ,SAAStL,GACrCiT,EAAa3H,EAASnL,MAAQuQ,EAAQ9T,IAAIsP,QAC1CgH,EAAa5H,EAASjL,MAAQqQ,EAAQ9T,IAAIuP,OAG7B,GAAb8G,IACAA,EAAa,GAID,EAAZC,IACAA,EAAY,GAIZA,EAAY,GAAKxC,EAAQ0B,kBACzBc,EAAYxC,EAAQ0B,gBAAkB,IAItCa,EAAa,GAAKvC,EAAQ8B,iBAC1BS,EAAavC,EAAQ8B,eAAiB,IAG1C9B,EAAQ7P,QAAQZ,KAERC,KAAQ+S,EAAa3B,EAAQxW,WAAWO,WAChCqV,EAAQc,WAAa,GACrB,GACA,GACJ,KACJpR,IAAQ8S,EAAY,OAIxB5B,EAAQnS,eACRmS,EAAQvR,kBAAkBC,EAG9B,IAAImT,GAAgBC,OAAOrH,aAAe2E,EAAQjf,QAAQsP,SAASuF,gBAAgBI,UAC/E2M,EAAgBF,GAAcC,OAAOE,aAAe5C,EAAQjf,QAAQsP,SAASyF,cAAgBkK,EAAQjf,QAAQsP,SAASyF,aAY1H,IAVI6M,EAAgB/H,EAASjL,OAASgT,GAAiB3C,EAAQ0B,iBAC3DgB,OAAOG,SAAS,EAAG,IAGnBJ,EAAa7H,EAASjL,OACtB+S,OAAOG,SAAS,EAAG,KAGvBzhB,EAAeqb,cAAcnN,EAAG0Q,EAAQ9T,IAAK8T,EAAQtD,aAEjDsD,EAAQtD,YAER,YADAsD,EAAQtD,aAAc,EAK1B,IAGI/B,GACAmI,EACAC,EACAC,EAGAC,EACAC,EACAhC,EACAiC,EACAnV,EAMAoV,EAnBAC,EAAazI,EAASnL,MAAQuQ,EAAQjf,QAAQsP,SAAS0F,KAAKE,WAC5DqN,EAAa1I,EAASjL,OAAS+S,OAAOrH,aAAe2E,EAAQjf,QAAQsP,SAASuF,gBAAgBI,WAM9FvL,GAAa,EACb8Y,GAAa,EAMbC,EAAaxD,EAAQzV,SACrBuD,EAAa0V,EAAMzV,KACnB0V,EAAaD,EAAMte,KACnBwe,EAAaF,EAAMvI,KACnB0I,EAAaH,EAAM/V,OAEnBmW,EAAa7D,EAAezQ,EAAG0Q,EAEnC,KAAK4D,EAAU,CAaX,GARAjJ,EAAYvY,QAAQoH,QAChBwW,EAAQjf,QAAQsP,SAASwT,iBACrBR,EACAC,IAIRR,EAAcnI,EAAUvO,SACnB0W,IAAgBA,EAAY1Y,aAAe0Y,EAAY1Y,WAAWY,YAEnE,MAsBJ,IAnBAoY,EAAa,WAgBT,MAfAO,GAAYb,EAAY/R,eACxBoS,EAAYK,EAAM/V,OAEd+V,EAAM/V,SAAWkW,IAEjBR,EAAQtS,YACRsS,EAAQrT,WAAc,EACtB6T,EAAU7T,WAAY,EAEtB0T,EAAM/V,OAAakW,EACnB3D,EAAQtT,SAAWiX,EAAUzT,UAAU4S,EAAYrhB,SAAUue,EAAQ7P,SAErEgT,EAAY,KACZD,GAAY,IAET,GAGP9gB,QAAQkB,WAAWwf,EAAY/J,eAE/B,GADA+J,EAAcA,EAAY/J,gBACrBqK,IACD,WAED,CACH,GAA0B,iBAAtBN,EAAYza,OAAkD,YAAtBya,EAAYza,MAapD,MAZA,KAAIya,EAAY/a,WASZ,MARA,IAAsC,IAAlC+a,EAAY/a,WAAWnF,OAAc,CACrC,IAAKwgB,IACD,MAGJH,IAAU,IAgB9B,IALIjD,EAAQ9T,IAAIgQ,QAAUgH,GAAaU,KACnCL,GAAc,EACdT,EAAcU,EAAMpX,QAGnB0W,EAAYrhB,WAAaqhB,EAC1B,MAGJ,IAAIG,EACAnV,EAAM3I,OAAS,KACf2I,EAAM5B,IAAS,EAEfwX,EAAQ,SAGR,IAAIH,EAAY,CAEZ,GADA5I,EAAYmI,EAAYrhB,SACpBW,QAAQC,kBAAkBsY,GAC1B,MAIJ,IAFAqI,EAAe5hB,EAAe8Z,OAAOP,GAEjCmI,EAAYnW,aAAemW,EAAY1S,QACvC2S,EAAenI,EAASnL,MAAQuT,EAAaxT,KAAOpO,EAAeqU,MAAMkF,GAAa,MAEtF,IAAImI,EAAY1S,QACZ2S,EAAenI,EAASjL,MAAQqT,EAAatT,IAAMtO,EAAesP,OAAOiK,GAAa,MACnF,CACH,GAAImJ,GAAU1iB,EAAesP,OAAOiK,EAMpC,IAJImI,EAAYvZ,qBACZua,IAAY1iB,EAAesP,OAAOoS,EAAYvZ,qBAG9CqR,EAASjL,MAAQqT,EAAatT,IAAMoU,EACpC,MAGJf,GAAenI,EAASjL,MAAQqT,EAAatT,IAAMoU,EAAU,EAIrE,IAAK1hB,QAAQkB,WAAWwf,EAAYhK,SAChC,MAMJ,IAHAqK,EAAUL,EAAYhK,UACtB9K,EAAU8U,EAAY7S,QAAQkT,EAAQrd,iBAElCid,EAAc,CACd,GAAIgB,GAAQjB,EAAY/S,eAAeoT,EAEvCrV,GAAM3I,OAAS6I,EACfF,EAAM5B,IAAS9J,QAAQkF,UAAUyc,GAASA,EAAM7d,UAAY,EAAI,EAEhEwd,EAAQK,OAEJZ,EAAQnd,cAAkD,IAAhCmd,EAAQtd,aAAajD,QAAgBugB,EAAQhd,iBAAmBsd,EAAM3d,iBAMhGgI,EAAM3I,OAAS6I,EACfF,EAAM5B,IAASiX,EAAQjd,UAAY,EAEnCwd,EAAQP,IARRrV,EAAM3I,OAASge,EACfrV,EAAM5B,IAAS,EAEfwX,EAAQ,UAQb,CAEH,KAAI1D,EAAQ9T,IAAIgQ,OAAS8D,EAAQ9T,IAAIqQ,SAAWoH,EAAUK,YAwDtD,MArDA,IAFAhE,EAAQ9T,IAAIqQ,QAAU,EAElByD,EAAQ9T,IAAI8P,MAAQ,EAAG,CAEvB,GADAhO,EAAU0V,GACL1V,EAAS,CACV,KAAIF,EAAM5B,IAAM,GAAK,GAGjB,MAFA8B,GAAUF,EAAM3I,OAAOU,aAAaiI,EAAM5B,IAAM,GAUxD,GAJIsX,EAAMhW,OAASgW,EAAM/V,QAAUO,IAAYyV,GAAS7C,EAAQ/T,cAC5DmB,EAAU2V,EAAU5T,eAAe/B,KAGnCA,IAAWA,EAAQvH,YAanB,MAZA,IAAIvC,GAAO8J,EAAQnI,aAAajD,MAEhCkL,GAAM3I,OAAS6I,EACfF,EAAM5B,IAAShI,EAGXwf,EADAxf,EAAO,EACC8J,EAAQnI,aAAa3B,EAAO,GAE5B,SAMb,CAAA,KAAI8b,EAAQ9T,IAAI8P,MAAQ,GAoB3B,MAlBA,IADAmH,EAAUrV,EAAM3I,QACZge,KACiC,IAAhCA,EAAQtd,aAAajD,QACrBugB,EAAQtd,aAAajD,OAAS,EAAIkL,EAAM5B,KACxCsX,EAAMhW,OAASgW,EAAM/V,QACrB0V,EAAQhd,iBAAmBsd,EAAM3d,iBACjCqd,EAAQtd,aAAajD,OAAS,IAAM6gB,EAAMvd,WAAa0a,EAAQ/T,aAUhE,MARAmB,GAAU2V,EAAU1T,QAAQkT,EAAQrd,iBAEpCgI,EAAM3I,OAAS6I,EACfF,EAAM5B,IAASiX,EAAQjd,UAAY,EAEnCwd,EAAQP,GAexBK,EAAMhW,OAASgW,EAAM/V,QACrBK,EAAM3I,QACNse,EAAM3d,kBAAoBgI,EAAM3I,OAAOgB,gBACvCsd,EAAMvd,YAAc4H,EAAM5B,MAE1BzB,GAAY,GAGZkZ,EAAUvZ,WAAWE,OAAOkZ,EAAO1V,EAAOrD,KAC1C+Y,EAAMzV,KAAUD,EAChB0V,EAAMvI,KAAUyI,EAChBF,EAAMjW,QAAU9C,EAChB+Y,EAAMpX,MAAU0W,EAEZA,EAAY1S,SACZhP,EAAe0b,cACX6G,EACA3D,EAAQtT,SACRtK,QAAQC,kBAAkByL,EAAM3I,QAAU,EAAI2I,EAAM3I,OAAOiB,UAAY,GAGvEsd,GACA1V,GAAWF,EAAM3I,OAAS2I,EAAM3I,OAAOU,aAAe,OAAU2d,EAAM/V,OAAO7L,SAEzE8hB,EAAMxd,UAAY8H,EAAQpL,OAAS,GAEnC8gB,EAAS1V,EAAQ0V,EAAMxd,UAAY,GACnCgb,EAASsC,EAAM/V,OAAOlB,SAASmX,GAC/BxC,EAAOzf,SAAS,GAAGkP,WAAWC,aAC1BoP,EAAQtT,SAAS,GACjBwU,EAAOzf,SAAS,MAGpB0hB,EAAUK,EAAM/V,OAAOvE,kBAAkBwa,GACzCxC,EAAUsC,EAAM/V,OAAOlB,SAAS4W,GAChCjC,EAAOzf,SAASwiB,MAAMjE,EAAQtT,aAGlCwU,EAASsC,EAAM/V,OAAOlB,SAASuB,EAAM3I,QACjC+b,IACIpT,EAAM3I,OACN+b,EAAOzf,SAASwiB,MAAMjE,EAAQtT,UAG9BwU,EAAO3X,mBAAmB2a,QAAQlE,EAAQtT,cAKtDwU,EAASsC,EAAM/V,OAAOlB,SAASmX,GAAS5V,EAAM3I,QAC1Cue,EACAxC,EAAOzf,SAASwiB,MAAMjE,EAAQtT,UAE9BwU,EAAO3X,mBAAmB2a,QAAQlE,EAAQtT,WAIlDiX,EAAU7S,YAEV8P,EAAQld,WACJ,WACIkd,EAAQxW,WAAWiE,SAASmV,OAQhD,QAASW,GAAW7U,EAAG0Q,GAiEnB,QAASoE,KACLpE,EAAQzV,SAASkD,OAAOoD,YACxBmP,EAAQzV,SAASkD,OAAOqC,WAAY,EAEpCkQ,EAAQzV,SAAW,KACnBqW,EAAQyD,SAAW,EACnBzD,EAAQtS,YAAY,MArExB,GADAgB,EAAEuR,iBACEb,EAAQ7P,QAAS,CACjB,GAAIwC,IAAc,EACdiO,EAAcZ,EAAQxe,OACtB0f,EAAcN,EAAQrU,SAASyT,EAAQzV,SAASrF,MAChD4O,EAAcoN,EAAOzf,QAEzBmf,GAAQld,WACJ,WACIiP,EAAUiO,EAAQxW,WAAWe,WAAW6U,EAAQzV,YAKpD2W,EAAO9Q,QACPwQ,EAAQ7X,oBACJiX,EAAQzV,SAASrF,KAAM,SAAU0I,EAAOI,GAQpC,MAPAkT,GAAWN,EAAQrU,SAASqB,GAC5BkG,EAAWoN,GAAUA,EAAOzf,SACxByf,GAAUpN,KAAc9F,GAAWJ,EAAMnH,aAAeuH,EAAQhI,eAC5D4a,EAAQra,OAAOqI,QACfkF,EAAS1E,YAAYwR,EAAQra,OAAOqI,QAGrChB,EAAMnH,eAAgB,GAASmH,EAAM5H,gBAAiB,GAC9D,MAAM,GAGT4a,EAAQra,OAAOqI,QACfkF,EAAS1E,YAAYwR,EAAQra,OAAOqI,QAI5CoR,EAAQ7P,QAAQxE,SAChBqU,EAAQ7P,QAAU,KAEdyQ,EAAQnS,eACRmS,EAAQlS,aAGRkS,EAAQyD,QACRzD,EAAQld,WACJ,WACI,GAAI4gB,GAAU1D,EAAQxW,WAAWsD,QAC7BsS,EAAQzV,SACRoI,EAGJiO,GAAQxW,WAAWiD,SAAS2S,EAAQzV,SAAU+Z,GAC9CF,OAIRG,EAAYvE,GACZY,EAAQld,WACJ,WACIkd,EAAQxW,WAAWiD,SAAS2S,EAAQzV,UAAU,GAC9C6Z,OAgBhBhiB,QAAQoH,QAAQwW,EAAQhf,WAAWwjB,OAAO,WAAYxE,EAAQuB,cAC9Dnf,QAAQoH,QAAQwW,EAAQhf,WAAWwjB,OAAO,cAAexE,EAAQuB,cACjEnf,QAAQoH,QAAQwW,EAAQhf,WAAWwjB,OAAO,YAAaxE,EAAQwB,eAC/Dpf,QAAQoH,QAAQwW,EAAQhf,WAAWwjB,OAAO,UAAWxE,EAAQuB,cAC7Dnf,QAAQoH,QAAQwW,EAAQhf,WAAWwjB,OAAO,YAAaxE,EAAQwB,eAC/Dpf,QAAQoH,QAAQwW,EAAQjf,QAAQsP,SAAS0F,MAAMyO,OAAO,aAAcxE,EAAQyB,iBAGhF,QAASgD,GAAkBnV,EAAG0Q,GACtBA,EAAQxe,OAAO4I,WAAWa,aAC1BiV,EAAa5Q,EAAG0Q,GAIxB,QAASuE,GAAYvE,GACjBA,EAAQxW,QAAQ8X,KACZ,uBAAwB,SAAUhS,GAC9B0Q,EAAQmC,cAAe,EACvBnC,EAAQkC,aAAe,EACvBuC,EAAkBnV,EAAG0Q,GACrBA,EAAQ0E,UAAe/jB,EACnB,WACIqf,EAAQmC,cAAe,GACxBnC,EAAQxe,OAAOoL,aAK9BoT,EAAQxW,QAAQ8X,KACZ,+BAAgC,WAC5B3gB,EAAS+V,OAAOsJ,EAAQ0E,aAKpC,QAASC,GAAkBrV,EAAG0Q,GAC1B,GAAIY,GAAUZ,EAAQxe,MACtB,IAAkB,KAAd8N,EAAEsV,QACEhE,EAAQnS,eACRmS,EAAQlS,aAGZkS,EAAQyD,SAAU,EAClBF,EAAW7U,EAAG0Q,OAEd,IAAIY,EAAQ7T,eAAiBuC,EAAEuV,SAAU,CAMrC,GALAjE,EAAQrS,YAAW,GACfqS,EAAQnS,eACRmS,EAAQ/R,iBAGPmR,EAAQzV,SACT,MAGJ,IAAI2W,GAAWN,EAAQrU,SAASyT,EAAQzV,SAASrF,MAC7C4O,EAAWoN,EAAOzf,QAElByf,GAAO9Q,QACPwQ,EAAQ7X,oBACJiX,EAAQzV,SAASrF,KAAM,SAAU0I,EAAOI,GAQpC,MAPAkT,GAAWN,EAAQrU,SAASqB,GAC5BkG,EAAWoN,GAAUA,EAAOzf,SACxByf,GAAUpN,KAAc9F,GAAWJ,EAAMnH,aAAeuH,EAAQhI,eAC5D4a,EAAQra,OAAOqI,QACfkF,EAASnF,SAASiS,EAAQra,OAAOqI,QAGlChB,EAAMnH,eAAgB,GAASmH,EAAM5H,gBAAiB,GAE9D,MAAM,GAGT4a,EAAQra,OAAOqI,QACfkF,EAASnF,SAASiS,EAAQra,OAAOqI,SAOrD,QAASkW,GAAgBxV,EAAG0Q,GACxB,GAAIY,GAAUZ,EAAQxe,MACtB,IAAIof,EAAQ7T,gBAAkBuC,EAAEuV,SAAU,CAOtC,GANAjE,EAAQrS,YAAW,GAEfqS,EAAQnS,eACRmS,EAAQ/R;CAGPmR,EAAQzV,SACT,MAGJ,IAAI2W,GAAWN,EAAQrU,SAASyT,EAAQzV,SAASrF,MAC7C4O,EAAWoN,EAAOzf,QAElByf,GAAO9Q,QACPwQ,EAAQ7X,oBACJiX,EAAQzV,SAASrF,KAAM,SAAU0I,EAAOI,GAQpC,MAPAkT,GAAWN,EAAQrU,SAASqB,GAC5BkG,EAAWoN,GAAUA,EAAOzf,SACxByf,GAAUpN,KAAc9F,GAAWJ,EAAMnH,aAAeuH,EAAQhI,eAC5D4a,EAAQra,OAAOqI,QACfkF,EAAS1E,YAAYwR,EAAQra,OAAOqI,QAGrChB,EAAMnH,eAAgB,GAASmH,EAAM5H,gBAAiB,GAC9D,MAAM,GAGT4a,EAAQra,OAAOqI,QACfkF,EAAS1E,YAAYwR,EAAQra,OAAOqI,SAMpD,QAAS4O,GAAOpR,EAAO5C,EAASzI,EAASC,GACrC,GAAIgf,IACIG,SAAiB,gBAAkBuC,QACnChG,YAAiB,KACjBnS,SAAiB,KACjB2B,IAAiB,KACjBQ,SAAiB,KACjByD,QAAiB,KACjBgS,cAAiB,EACjBD,aAAiB,EACjBwC,UAAiB,KACjB3O,KAAiB1F,SAAS0F,KAC1BhC,KAAiB1D,SAASuF,gBAC1B8L,gBAAiB,KACjBI,eAAiB,KACjBhB,WAAiB,KACjBtf,OAAiB4K,EACjBrL,QAAiBA,EACjBC,UAAiBA,EACjBwI,QAAiBA,EACjBub,SAAiB,WACbR,EAAYvE,IAEhBgF,QAAiB,SAAU1V,GACvB6U,EAAW7U,EAAG0Q,IAElBwB,cAAiB,SAAUlS,GACvB2S,EAAY3S,EAAG0Q,IAEnBuB,aAAiB,SAAUjS,GACvBlD,EAAMiY,SAAU,EAChBF,EAAW7U,EAAG0Q,IAElByB,gBAAiB,SAAUnS,GACvB6U,EAAW7U,EAAG0Q,KAGtBiF,EAAiB,SAAU3V,GACvB,MAAOqV,GAAkBrV,EAAG0Q,IAEhCkF,EAAiB,SAAU5V,GACvB,MAAOwV,GAAgBxV,EAAG0Q,GAGlC5T,GAAM4Y,QAAU,SAAU1V,GACtB0Q,EAAQgF,QAAQ1V,IAGpB0Q,EAAQ+E,WAER3iB,QAAQoH,QAAQzI,EAAQsP,SAAS0F,MAAMuL,KAAK,UAAW2D,GACvD7iB,QAAQoH,QAAQzI,EAAQsP,SAAS0F,MAAMuL,KAAK,QAAS4D,GAErD9Y,EAAMoN,IACF,WAAY,WACRpX,QAAQoH,QAAQzI,EAAQsP,SAAS0F,MAAMyO,OAAO,UAAWS,GACzD7iB,QAAQoH,QAAQzI,EAAQsP,SAAS0F,MAAMyO,OAAO,QAASU,GACnD9Y,EAAMa,WACNb,EAAMa,UAAUtB,SAGhBS,EAAMM,UACNN,EAAMM,SAASf,WAM/B,MAAO6R,MAKnBpb,QAAQgV,OAAO,eACVuC,QACD,kBAAmB,WAIf,QAASwL,GAAcjgB,GACnBA,EAAKc,cAAe,EAGxB,QAASof,GAAYlgB,GACjBA,EAAKc,cAAe,EAGxB,QAASwX,GAAOpR,GACZ,GAAIhD,GAAGC,GACHC,cAAqB,KACrBP,oBAAqBqD,EAAMrD,oBAC3Be,YAAqB,SAAU5E,GAC3B,MAAKA,IAQDA,IAASmE,EAAKC,gBACVD,EAAKC,qBACED,GAAKC,cAAciC,aAE9BrG,EAAKqG,cAAgB,EACrBlC,EAAKC,cAAgBpE,EACrBmE,EAAKgc,mBAAmBngB,GACpB9C,QAAQkB,WAAW+F,EAAKU,YACxBV,EAAKU,UAAU7E,IAGhBA,IAlBCmE,EAAKC,qBACED,GAAKC,cAAciC,aAE9BlC,EAAKC,cAAgB,KACd,OAgBfgc,cAAqB,WAOjB,MANAnC,GAAU,KACN9Z,EAAKC,sBACED,GAAKC,cAAciC,aAC1B4X,EAAqB9Z,EAAKC,cAC1BD,EAAKC,cAAgB,MAElB6Z,GAEXoC,WAAqB,SAAUrgB,GAC3B,MAAIA,IAAiC,OAAzBA,EAAKY,gBACNsG,EAAMrE,WAAW7C,EAAKY,iBAE1B,MAEX0f,kBAAqB,SAAUC,EAAO9hB,GAElC,MADAqK,GAAU3E,EAAKkc,WAAWE,GACtBzX,EACIrK,EAAGqK,IACI,EAGJ3E,EAAKmc,kBAAkBxX,EAASrK,IAEpC,GAEX0hB,mBAAqB,SAAUI,GAC3BA,EAAQA,GAASpc,EAAKC,cACD,gBAAVmc,IACPpc,EAAKmc,kBACDC,EAAOL,IAInBM,qBAAoC,SAAUD,GAC1CA,EAAQA,GAASpc,EAAKC,cACD,gBAAVmc,IACPpc,EAAKmc,kBACDC,EAAON,IAKnBrjB,YAAmC,WAC/B,MAAOsK,GAAMtK,eAEjB6jB,SAAmC,SAAUxgB,EAAQygB,EAAUrgB,GAgB3D,MAfqB,gBAAVA,GACHJ,GACAA,EAAOU,aAAahB,KAAK+gB,GACzBzgB,EAAOa,cAAe,GAEtBoG,EAAMxK,SAASiD,KAAK+gB,GAGpBzgB,GACAA,EAAOU,aAAaiG,OAAOvG,EAAO,EAAGqgB,GACrCzgB,EAAOa,cAAe,GAEtBoG,EAAMxK,SAASkK,OAAOvG,EAAO,EAAGqgB,GAGjCA,GAEXC,cAAmC,SAAUD,GAEzC,MADAvc,GAAKsc,SAAS,KAAMC,GACbA,GAEXE,WAAmC,WAE/B,IADAnjB,EAAMyJ,EAAMxK,SAASgB,OAChBF,EAAI,EAAOC,EAAJD,EAASA,IACjB2G,EAAKN,oBACDqD,EAAMxK,SAASc,GAAI0iB,IAI/BW,aAAmC,WAE/B,IADApjB,EAAMyJ,EAAMxK,SAASgB,OAChBF,EAAI,EAAOC,EAAJD,EAASA,IACjB2G,EAAKN,oBACDqD,EAAMxK,SAASc,GAAIyiB,IAI/Ba,YAAmC,SAAU9gB,GAiBzC,GAAI+gB,IAAc,CAClB/gB,GAAOA,GAAQmE,EAAKC,cAChBpE,IAC6B,OAAzBA,EAAKY,gBACLkI,EAAU3E,EAAKkc,WAAWrgB,GAAMW,cAEhCmI,EAAU5B,EAAMxK,SACa,IAA1BwK,EAAMxK,SAASgB,SACdqjB,GAAc,IAItBjY,EAAQlC,OAAO5G,EAAKgB,UAAW,GAC5B+f,IAEC7Z,EAAMrE,eAGNsB,EAAKC,gBAAkBpE,IACvBmE,EAAKC,cAAgB,QAIjC4c,YAAmC,SAAUhhB,GAEzC,MADAA,GAAOA,GAAQmE,EAAKC,cACA,gBAATpE,IAAqBA,EAAKc,cACjCd,EAAKc,cAAe,EACbd,GAFX,QAKJihB,cAAmC,SAAUjhB,GAEzC,MADAA,GAAOA,GAAQmE,EAAKC,cACA,gBAATpE,IACPA,EAAKc,cAAe,EACbd,GAFX,QAKJkhB,kBAAmC,WAC/B,MAAO/c,GAAKC,eAEhB+c,eAAmC,WAE/B,MADA1jB,GAAMyJ,EAAMxK,SAASgB,OACjBD,EAAM,EACCyJ,EAAMxK,SAAS,GAEnB,MAEX0kB,aAAmC,SAAUphB,GACzC,MAAOA,GAAKW,cAEhB0gB,aAAmC,SAAUrhB,GAEzC,MADAA,GAAOA,GAAQmE,EAAKC,cACA,gBAATpE,IACP8I,EAAU3E,EAAKkc,WAAWrgB,GAEtBie,EADAnV,EACUA,EAAQnI,aAERuG,EAAMxK,UALxB,QAUJ4kB,iBAAmC,SAAUthB,GAEzC,MADAA,GAAOA,GAAQmE,EAAKC,cACA,gBAATpE,KACPie,EAAU9Z,EAAKkd,aAAarhB,GAC5BkE,EAAU+Z,EAAQvgB,OACdsC,EAAKgB,UAAYkD,GACV+Z,EAAQje,EAAKgB,UAAY,GAJxC,QAQJugB,iBAAmC,SAAUvhB,GAGzC,MAFAA,GAAUA,GAAQmE,EAAKC,cACvB6Z,EAAU9Z,EAAKkd,aAAarhB,GACxBA,EAAKgB,UAAY,EACVid,EAAQje,EAAKgB,UAAY,GADpC,QAIJwgB,gBAAmC,SAAUxhB,GAEzC,MADAA,GAAOA,GAAQmE,EAAKC,cACA,gBAATpE,KACPie,EAAUje,EAAKW,aACXsd,GAAWA,EAAQvgB,OAAS,GACrBsC,EAAKW,aAAa,GAG1B,MAEX8gB,kCAAmC,SAAUzhB,GAGzC,MAFAA,GAAUA,GAAQmE,EAAKC,eACvB6Z,EAAU9Z,EAAKmd,iBAAiBthB,IAErBie,GAGXnV,EAAU3E,EAAKkc,WAAWrgB,GACnBmE,EAAKsd,kCAAkC3Y,KAElD4Y,cAAmC,SAAU1hB,GAGzC,MAFAA,GAAOA,GAAQmE,EAAKC,cAEA,gBAATpE,IACPie,EAAU9Z,EAAKqd,gBAAgBxhB,GAC3Bie,EACOA,EAEA9Z,EAAKsd,kCAAkCzhB,IALtD,QASJ2hB,cAAmC,SAAU3hB,GAGzC,MAFAA,GAAOA,GAAQmE,EAAKC,cAEA,gBAATpE,IACPie,EAAU9Z,EAAKod,iBAAiBvhB,IAErBmE,EAAKyd,oBAAoB3D,GAGpCnV,EAAU3E,EAAKkc,WAAWrgB,GAN9B,QAUJ4hB,oBAAmC1a,EAAMlD,kBACzC6d,mBAAmC,SAAU7hB,GAGzC,MAFAA,GAAOA,GAAQmE,EAAKC,cAEA,gBAATpE,KACP8I,EAAU3E,EAAKkc,WAAWrgB,IAEfmE,EAAKS,YAAYkE,GAHhC,QAOJgZ,kBAAmC,WAC/B,GAAIC,GAAY5d,EAAKgd,gBACrB,OAAOhd,GAAKS,YAAYmd,IAE5BC,oBAAmC,SAAUhiB,GAGzC,MAFAA,GAAOA,GAAQmE,EAAKC,cAEA,gBAATpE,KACPie,EAAU9Z,EAAKmd,iBAAiBthB,IAErBmE,EAAKS,YAAYqZ,GAHhC,QAOJgE,oBAAmC,SAAUjiB,GAGzC,MAFAA,GAAOA,GAAQmE,EAAKC,cAEA,gBAATpE,KACPie,EAAU9Z,EAAKod,iBAAiBvhB,IAErBmE,EAAKS,YAAYqZ,GAHhC,QAOJiE,iBAAmC,SAAUliB,GAGzC,MAFAA,GAAOA,GAAQmE,EAAKC,cAEA,gBAATpE,KACPie,EAAU9Z,EAAKud,cAAc1hB,IAElBmE,EAAKS,YAAYqZ,GAHhC,QAOJkE,iBAAmC,SAAUniB,GAGzC,MAFAA,GAAOA,GAAQmE,EAAKC,cAEA,gBAATpE,KACPie,EAAU9Z,EAAKwd,cAAc3hB,IAElBmE,EAAKS,YAAYqZ,GAHhC,QASR,OADA/gB,SAAQoG,OAAO4D,EAAM/C,KAAMA,GACpB+C,EAAM/C,KA/TjB,GAAI8Z,GAASnV,EACTtL,EAAGC,CAiUP,OAAO6a,KAIfpb,QAAQgV,OAAO,oCAAqCkQ,KAE5C,iBAAkB,SAAUrmB,GAC5BA,EAAesmB,IACX,iCACC,iCACA,cACA,SACA,4FACA,6FACA,gBACA,qGACA,4CACA,aACA,YACA,eACA,0BACA,uFACA,uDACA,oCACA,0DACA,mCACA,6IACA,mDACA,sDACA,gCACA,oFACA,8CACA,qBACA,4EACA,gBACA,kGACA,0CACA,kCACA,gBACA,YACA,eACA,YAAYhO,KAAK,OAGtBtY,EAAesmB,IACX,0CACA,iEAGJtmB,EAAesmB,IACX,0CACA","file":"ng-tree-dnd.min.js","sourcesContent":["/**\n * The MIT License (MIT)\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to\n * deal in the Software without restriction, including without limitation the\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\n * sell copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\n * IN THE SOFTWARE.\n * @preserve\n */\n\n/**\n * Implementing TreeDnD & Event DrapnDrop (allow drag multi tree-table include all type: table, ol, ul)\n * Demo: http://thienhung1989.github.io/angular-tree-dnd\n * Github: https://github.com/thienhung1989/angular-tree-dnd\n * @version 3.0.4\n * @preserve\n * (c) 2015 Nguyun Thin Hng - <nguyenthienhung1989@gmail.com>\n */\n(function () {\n    'use strict';\n    angular.isUndefinedOrNull = isUndefinedOrNull;\n\n    angular.isDefined = isDefined;\n\n    angular.module('ntt.TreeDnD', ['template/TreeDnD/TreeDnD.html'])\n        .constant(\n        '$TreeDnDClass', {\n            tree:   'tree-dnd',\n            empty:  'tree-dnd-empty',\n            hidden: 'tree-dnd-hidden',\n            node:   'tree-dnd-node',\n            nodes:  'tree-dnd-nodes',\n            handle: 'tree-dnd-handle',\n            place:  'tree-dnd-placeholder',\n            drag:   'tree-dnd-drag',\n            status: 'tree-dnd-status',\n            icon:   {\n                '1':  'glyphicon glyphicon-minus',\n                '0':  'glyphicon glyphicon-plus',\n                '-1': 'glyphicon glyphicon-file'\n            }\n        }\n    );angular.module('ntt.TreeDnD')\n    .directive(\n    'compile', [\n        '$compile', function ($compile) {\n            return {\n                restrict: 'A',\n                link:     function (scope, element, attrs) {\n                    scope.$watch(\n                        attrs.compile, function (new_val) {\n                            if (new_val) {\n                                if (angular.isFunction(element.empty)) {\n                                    element.empty();\n                                } else {\n                                    element.html('');\n                                }\n\n                                element.append($compile(new_val)(scope));\n                            }\n                        }\n                    );\n                }\n            };\n        }]\n)\n    .directive(\n    'compileReplace', [\n        '$compile', function ($compile) {\n            return {\n                restrict: 'A',\n                link:     function (scope, element, attrs) {\n                    scope.$watch(\n                        attrs.compileReplace, function (new_val) {\n                            if (new_val) {\n                                element.replaceWith($compile(new_val)(scope));\n                            }\n                        }\n                    );\n                }\n            };\n        }]\n);\n\nangular.module('ntt.TreeDnD')\r    .directive(\r    'treeDndNodeHandle', function () {\r        return {\r            restrict: 'A',\r            scope:    true,\r            link:     function (scope, element, attrs) {\r                scope.$type = 'TreeDnDNodeHandle';\r                if (scope.$class.handle) {\r                    element.addClass(scope.$class.handle);\r                }\r            }\r        };\r    }\r);\n\nangular.module('ntt.TreeDnD')\n    .directive(\n    'treeDndNode', ['$TreeDnDViewport', '$timeout', function ($TreeDnDViewport, $timeout) {\n        return {\n            restrict: 'A',\n            replace:  true,\n            link:     fnLink\n        };\n        function fnLink(scope, element, attrs) {\n\n            scope.$node_class = '';\n\n            if (scope.$class.node) {\n                element.addClass(scope.$class.node);\n                scope.$node_class = scope.$class.node;\n            }\n            var enabledDnD = typeof scope.dragEnabled === 'boolean' || typeof scope.dropEnabled === 'boolean',\n                keyNode    = attrs.treeDndNode,\n                first      = true,\n                childsElem;\n\n            console.log('Created Node');\n            $TreeDnDViewport.add(scope, element);\n\n            if (enabledDnD) {\n                scope.$type = 'TreeDnDNode';\n\n                scope.getData = function () {\n                    return scope[keyNode];\n                };\n            }\n\n            scope.$element            = element;\n            scope[keyNode].__inited__ = true;\n\n            scope.getElementChilds = function () {\n                return angular.element(element[0].querySelector('[tree-dnd-nodes]'));\n            };\n\n            scope.setScope(scope, scope[keyNode]);\n\n            scope.getScopeNode = function () {\n                return scope;\n            };\n\n            var objprops = [],\n                objexpr,\n                i, keyO  = Object.keys(scope[keyNode]),\n                lenO     = keyO.length,\n                hashKey  = scope[keyNode].__hashKey__,\n                skipAttr = [\n                    '__visible__',\n                    '__children__',\n                    '__level__',\n                    '__index__',\n                    '__index_real__',\n\n                    '__parent__',\n                    '__parent_real__',\n                    '__dept__',\n                    '__icon__',\n                    '__icon_class__'\n                ],\n                keepAttr = [\n                    '__expanded__'\n                ],\n                lenKeep  = keepAttr.length;\n\n            // skip __visible__\n            for (i = 0; i < lenO + lenKeep; i++) {\n                if (i < lenO) {\n                    if (skipAttr.indexOf(keyO[i]) === -1) {\n                        objprops.push(keyNode + '.' + keyO[i]);\n                    }\n                } else {\n                    if (keyO.indexOf(keepAttr[i - lenO]) === -1) {\n                        objprops.push(keyNode + '.' + keepAttr[i - lenO]);\n                    }\n                }\n            }\n\n            objexpr = '[' + objprops.join(',') + ']';\n\n            scope.$watch(objexpr, fnWatchNode, true);\n\n            scope.$on('$destroy', function () {\n                scope.deleteScope(scope, scope[keyNode]);\n            });\n\n            function fnWatchNode(newVal, oldVal, scope) {\n\n                console.time('Node_Changed');\n                var nodeOf = scope[keyNode],\n                    _icon;\n\n                if (first) {\n                    _icon                 = nodeOf.__icon__;\n                    nodeOf.__icon_class__ = scope.$class.icon[_icon];\n                } else {\n\n                    var parentReal = nodeOf.__parent_real__,\n                        parentNode = scope.tree_nodes[parentReal] || null,\n                        _childs    = nodeOf.__children__,\n                        _len       = _childs.length,\n                        _i;\n\n                    if (!nodeOf.__inited__) {\n                        nodeOf.__inited__ = true;\n                    }\n\n                    if (nodeOf.__hashKey__ !== hashKey) {\n                        // clear scope in $globals\n                        scope.deleteScope(scope, nodeOf);\n\n                        // add new scope into $globals\n                        scope.setScope(scope, nodeOf);\n                        hashKey = nodeOf.__hashKey__;\n                    }\n\n                    if (parentNode && (!parentNode.__expanded__ || !parentNode.__visible__)) {\n                        element.addClass(scope.$class.hidden);\n                        nodeOf.__visible__ = false;\n                    } else {\n                        element.removeClass(scope.$class.hidden);\n                        nodeOf.__visible__ = true;\n                    }\n\n                    if (_len === 0) {\n                        _icon = -1;\n                    } else {\n                        if (nodeOf.__expanded__) {\n                            _icon = 1;\n                        } else {\n                            _icon = 0;\n                        }\n                    }\n\n                    nodeOf.__icon__       = _icon;\n                    nodeOf.__icon_class__ = scope.$class.icon[_icon];\n\n                    if (scope.isTable) {\n                        for (_i = 0; _i < _len; _i++) {\n                            scope.for_all_descendants(_childs[_i], fnHiddenChild, nodeOf, true);\n                        }\n                    } else {\n                        if (!childsElem) {\n                            childsElem = scope.getElementChilds();\n                        }\n\n                        if (nodeOf.__expanded__) {\n                            childsElem.removeClass(scope.$class.hidden);\n                        } else {\n                            childsElem.addClass(scope.$class.hidden);\n                        }\n                    }\n\n                }\n\n                console.timeEnd('Node_Changed');\n                first      = false;\n\n                function fnHiddenChild(node, parent) {\n                    var nodeScope = scope.getScope(node);\n                    if (nodeScope) {\n                        if (parent && parent.__expanded__  && parent.__visible__) {\n                            nodeScope.$element.removeClass(scope.$class.hidden);\n                            node.__visible__ = true;\n                        } else {\n                            nodeScope.$element.addClass(scope.$class.hidden);\n                            node.__visible__ = false;\n                        }\n                    } else {\n                        // show node & init scope\n                        if (parent && parent.__expanded__  && parent.__visible__) {\n                            node.__visible__ = true;\n                        }else{\n                            node.__visible__ = false;\n                        }\n                    }\n\n                    // skip all child hiding... if not expaned\n                    return node.__expanded__ === false;\n                }\n            }\n        }\n    }]\n);\n\nangular.module('ntt.TreeDnD')\n    .directive(\n    'treeDndNodes', function () {\n        return {\n            restrict: 'A',\n            replace:  true,\n            link:     function (scope, element/*, attrs*/) {\n                scope.$type = 'TreeDnDNodes';\n\n                if (scope.$class.nodes) {\n                    element.addClass(scope.$class.nodes);\n                    scope.$nodes_class = scope.$class.nodes;\n                } else {\n                    scope.$nodes_class = '';\n                }\n            }\n        };\n    }\n);\n\nangular.module('ntt.TreeDnD')\n    .directive(\n    'treeDnd', fnInitTreeDnD);\n\nfnInitTreeDnD.$inject = [\n    '$timeout', '$http', '$compile', '$parse', '$window', '$document', '$templateCache',\n    '$TreeDnDTemplate', '$TreeDnDClass', '$TreeDnDHelper', '$TreeDnDPlugin', '$TreeDnDViewport'\n];\n\nfunction fnInitTreeDnD($timeout, $http, $compile, $parse, $window, $document, $templateCache,\n                       $TreeDnDTemplate, $TreeDnDClass, $TreeDnDHelper, $TreeDnDPlugin, $TreeDnDViewport\n) {\n    return {\n        restrict:   'E',\n        scope:      true,\n        replace:    true,\n        controller: ['$scope', '$element', '$attrs', fnController],\n        compile:    fnCompile\n    };\n\n    function fnController($scope, $element, $attrs) {\n        $scope.indent      = 20;\n        $scope.indent_plus = 15;\n        $scope.indent_unit = 'px';\n        $scope.$tree_class = 'table';\n        $scope.primary_key = '__uid__';\n\n        $scope.$type = 'TreeDnD';\n        // $scope.enabledFilter = null;\n        $scope.colDefinitions = [];\n        $scope.$globals       = {};\n        $scope.$class         = {};\n\n        $scope.treeData   = [];\n        $scope.tree_nodes = [];\n\n        $scope.$class = angular.copy($TreeDnDClass);\n        angular.extend(\n            $scope.$class.icon, {\n                '1':  $attrs.iconExpand || 'glyphicon glyphicon-minus',\n                '0':  $attrs.iconCollapse || 'glyphicon glyphicon-plus',\n                '-1': $attrs.iconLeaf || 'glyphicon glyphicon-file'\n            }\n        );\n\n        $scope.for_all_descendants = function (node, fn, parent, checkSibling) {\n            if (angular.isFunction(fn)) {\n                var _i, _len, _nodes;\n\n                if (fn(node, parent)) {\n                    // have error or need ignore children\n                    return false;\n                }\n                _nodes = node.__children__;\n                _len   = _nodes.length;\n                for (_i = 0; _i < _len; _i++) {\n                    if (!$scope.for_all_descendants(_nodes[_i], fn, node) && !checkSibling) {\n                        // skip sibling of node checking\n                        return false;\n                    }\n                }\n            }\n            // succeed then continue\n            return true;\n        };\n\n        $scope.getLastDescendant = function (node) {\n            var last_child, n;\n            if (!node) {\n                node = $scope.tree ? $scope.tree.selected_node : false;\n            }\n            if (node === false) {\n                return false;\n            }\n            n = node.__children__.length;\n            if (n === 0) {\n                return node;\n            } else {\n                last_child = node.__children__[n - 1];\n                return $scope.getLastDescendant(last_child);\n            }\n        };\n\n        $scope.getElementChilds = function () {\n            return angular.element($element[0].querySelector('[tree-dnd-nodes]'));\n        };\n\n        $scope.onClick = function (node) {\n            if (angular.isDefined($scope.tree) && angular.isFunction($scope.tree.on_click)) {\n                // We want to detach from Angular's digest cycle so we can\n                // independently measure the time for one cycle.\n                setTimeout(\n                    function () {\n                        $scope.tree.on_click(node);\n                    }, 0\n                );\n            }\n        };\n\n        $scope.onSelect = function (node) {\n            if (angular.isDefined($scope.tree)) {\n                if (node !== $scope.tree.selected_node) {\n                    $scope.tree.select_node(node);\n                }\n\n                if (angular.isFunction($scope.tree.on_select)) {\n                    setTimeout(\n                        function () {\n                            $scope.tree.on_select(node);\n                        }, 0\n                    );\n                }\n            }\n        };\n\n        var passedExpand, _clone;\n        $scope.toggleExpand = function (node, fnCallback) {\n            passedExpand = true;\n            if (angular.isFunction(fnCallback) && !fnCallback(node)) {\n                passedExpand = false;\n            } else if (angular.isFunction($scope.$callbacks.expand) && !$scope.$callbacks.expand(node)) {\n                passedExpand = false;\n            }\n\n            if (passedExpand) {\n                if (node.__children__.length > 0) {\n                    node.__expanded__ = !node.__expanded__;\n                }\n            }\n        };\n\n        $scope.getHash = function (node) {\n            return '#' + node.__parent__ + '#' + node[$scope.primary_key];\n        };\n\n        $scope.$callbacks = {\n            for_all_descendants: $scope.for_all_descendants,\n            /*expand:              function (node) {\n             return true;\n             },*/\n            accept:              function (dragInfo, moveTo, isChanged) {\n                return $scope.dropEnabled === true;\n            },\n            calsIndent:          function (level, skipUnit, skipEdge) {\n                var unit = 0,\n                    edge = skipEdge ? 0 : $scope.indent_plus;\n                if (!skipUnit) {\n                    unit = $scope.indent_unit ? $scope.indent_unit : 'px';\n                }\n\n                if (level - 1 < 1) {\n                    return edge + unit;\n                } else {\n                    return $scope.indent * (level - 1) + edge + unit;\n                }\n            },\n            droppable:           function () {\n                return $scope.dropEnabled === true;\n            },\n            draggable:           function () {\n                return $scope.dragEnabled === true;\n            },\n            beforeDrop:          function (event) {\n                return true;\n            },\n            changeKey:           function (node) {\n                var _key     = node.__uid__;\n                node.__uid__ = Math.random();\n                if (node.__selected__) {\n                    delete node.__selected__;\n                }\n\n                if ($scope.primary_key !== '__uid__') {\n                    _key = '' + node[$scope.primary_key];\n                    _key = _key.replace(/_#.+$/g, '') + '_#' + node.__uid__;\n\n                    node[$scope.primary_key] = _key;\n                }\n                // delete(node.__hashKey__);\n            },\n            clone:               function (node, _this) {\n                _clone = angular.copy(node);\n                this.for_all_descendants(_clone, this.changeKey);\n                return _clone;\n            },\n            remove:              function (node, parent, _this, delayReload) {\n                var temp = parent.splice(node.__index__, 1)[0];\n                if (!delayReload) {\n                    $scope.reload_data();\n                }\n                return temp;\n            },\n            clearInfo:                function (node) {\n                delete node.__inited__;\n                delete node.__visible__;\n\n                // always changed after call reload_data\n                //delete node.__hashKey__;\n            },\n            add:                 function (node, pos, parent, _this) {\n                // clearInfo\n                this.for_all_descendants(node, this.clearInfo);\n                if (parent) {\n                    if (parent.length > -1) {\n                        if (pos > -1) {\n                            parent.splice(pos, 0, node);\n                        } else {\n                            // todo If children need load crazy\n                            parent.push(node);\n                        }\n                    } else {\n                        parent.push(node);\n                    }\n                }\n            }\n        };\n\n        $scope.deleteScope = function (scope, node) {\n            var _hash = node.__hashKey__;\n            if ($scope.$globals[_hash] && $scope.$globals[_hash] === scope) {\n                delete $scope.$globals[_hash];\n            }\n        };\n\n        $scope.setScope = function (scope, node) {\n            var _hash = node.__hashKey__;\n            if ($scope.$globals[_hash] !== scope) {\n                $scope.$globals[_hash] = scope;\n            }\n        };\n\n        $scope.getScope = function (node) {\n            if (node) {\n                var _hash = node.__hashKey__;\n                //var _hash = typeof node === 'string' ? node : node.__hashKey__;\n                return $scope.$globals[_hash];\n            }\n            return $scope;\n        };\n\n        if ($attrs.enableDrag || $attrs.enableDrop) {\n            $scope.placeElm = null;\n            //                            $scope.dragBorder = 30;\n            $scope.dragEnabled = null;\n            $scope.dropEnabled = null;\n            $scope.horizontal  = null;\n\n            if ($attrs.enableDrag) {\n\n                $scope.dragDelay       = 0;\n                $scope.enabledMove     = true;\n                $scope.statusMove      = true;\n                $scope.enabledHotkey   = false;\n                $scope.enabledCollapse = null;\n                $scope.statusElm       = null;\n                $scope.dragging        = null;\n\n                angular.extend(\n                    $scope.$callbacks, {\n                        beforeDrag: function (scopeDrag) {\n                            return true;\n                        },\n                        dragStop:   function (info, passed) {\n                            if (!info || !info.changed && info.drag.enabledMove || !passed) {\n                                return null;\n                            }\n\n                            info.target.reload_data();\n\n                            if (info.target !== info.drag && info.drag.enabledMove) {\n                                info.drag.reload_data();\n                            }\n                        },\n                        dropped:    function (info, pass) {\n                            if (!info) {\n                                return null;\n                            }\n\n                            var _node         = info.node,\n                                _nodeAdd      = null,\n                                _move         = info.move,\n                                _parent       = null,\n                                _parentRemove = info.parent || info.drag.treeData,\n                                _parentAdd    = _move.parent || info.target.treeData,\n                                isMove        = info.drag.enabledMove;\n\n                            if (!info.changed && isMove) {\n                                return false;\n                            }\n\n                            if (info.target.$callbacks.accept(info, info.move, info.changed)) {\n                                if (isMove) {\n                                    _parent = _parentRemove;\n                                    if (angular.isDefined(_parent.__children__)) {\n                                        _parent = _parent.__children__;\n                                    }\n\n                                    _nodeAdd = info.drag.$callbacks.remove(\n                                        _node,\n                                        _parent,\n                                        info.drag.$callbacks,\n                                        true // delay reload\n                                    );\n                                } else {\n                                    _nodeAdd = info.drag.$callbacks.clone(_node, info.drag.$callbacks);\n                                }\n\n                                // if node dragging change index in sample node parent\n                                // and index node decrement\n                                if (isMove &&\n                                    info.drag === info.target &&\n                                    _parentRemove === _parentAdd &&\n                                    _move.pos >= info.node.__index__) {\n                                    _move.pos--;\n                                }\n\n                                _parent = _parentAdd;\n                                if (_parent.__children__) {\n                                    _parent = _parent.__children__;\n                                }\n\n                                info.target.$callbacks.add(\n                                    _nodeAdd,\n                                    _move.pos,\n                                    _parent,\n                                    info.drag.$callbacks\n                                );\n\n                                return true;\n                            }\n\n                            return false;\n                        },\n                        dragStart:  function (event) {\n                        },\n                        dragMove:   function (event) {\n                        }\n                    }\n                );\n\n                $scope.setDragging = function (dragInfo) {\n                    $scope.dragging = dragInfo;\n                };\n\n                $scope.enableMove = function (val) {\n                    if (typeof val === 'boolean') {\n                        $scope.enabledMove = val;\n                    } else {\n                        $scope.enabledMove = true;\n                    }\n                };\n\n                if ($attrs.enableStatus) {\n                    $scope.enabledStatus = false;\n\n                    $scope.hideStatus = function () {\n                        if ($scope.statusElm) {\n                            $scope.statusElm.addClass($scope.$class.hidden);\n                        }\n                    };\n\n                    $scope.refreshStatus = function () {\n                        if (!$scope.dragging) {\n                            return;\n                        }\n\n                        if ($scope.enabledStatus) {\n                            var statusElmOld = $scope.statusElm;\n                            if ($scope.enabledMove) {\n                                $scope.statusElm = angular.element($TreeDnDTemplate.getMove($scope));\n                            } else {\n                                $scope.statusElm = angular.element($TreeDnDTemplate.getCopy($scope));\n                            }\n\n                            if (statusElmOld !== $scope.statusElm) {\n                                if (statusElmOld) {\n                                    $scope.statusElm.attr('class', statusElmOld.attr('class'));\n                                    $scope.statusElm.attr('style', statusElmOld.attr('style'));\n                                    statusElmOld.remove();\n                                }\n                                $document.find('body').append($scope.statusElm);\n\n                            }\n\n                            $scope.statusElm.removeClass($scope.$class.hidden);\n                        }\n                    };\n\n                    $scope.setPositionStatus = function (e) {\n                        if ($scope.statusElm) {\n                            $scope.statusElm.css(\n                                {\n                                    'left':    e.pageX + 10 + 'px',\n                                    'top':     e.pageY + 15 + 'px',\n                                    'z-index': 9999\n                                }\n                            );\n                            $scope.statusElm.addClass($scope.$class.status);\n                        }\n                    };\n                }\n            }\n\n            $scope.targeting = false;\n\n            $scope.getPrevSibling = function (node) {\n                if (node && node.__index__ > 0) {\n                    var _parent, _index = node.__index__ - 1;\n\n                    if (angular.isDefined(node.__parent_real__)) {\n                        _parent = $scope.tree_nodes[node.__parent_real__];\n                        return _parent.__children__[_index];\n                    }\n                    return $scope.treeData[_index];\n\n                }\n                return null;\n            };\n\n            $scope.getNode = function (index) {\n                if (angular.isUndefinedOrNull(index)) {\n                    return null;\n                }\n                return $scope.tree_nodes[index];\n            };\n\n            $scope.initPlace = function (element, dragElm) {\n\n                if (!$scope.placeElm) {\n                    if ($scope.isTable) {\n                        $scope.placeElm = angular.element($window.document.createElement('tr'));\n                        var _len_down   = $scope.colDefinitions.length;\n                        $scope.placeElm.append(\n                            angular.element($window.document.createElement('td'))\n                                .addClass($scope.$class.empty)\n                                .addClass('indented')\n                                .addClass($scope.$class.place)\n                        );\n                        while (_len_down-- > 0) {\n                            $scope.placeElm.append(\n                                angular.element($window.document.createElement('td'))\n                                    .addClass($scope.$class.empty)\n                                    .addClass($scope.$class.place)\n                            );\n                        }\n                    } else {\n                        $scope.placeElm = angular.element($window.document.createElement('li'))\n                            .addClass($scope.$class.empty)\n                            .addClass($scope.$class.place);\n                    }\n\n                }\n\n                if (dragElm) {\n                    $scope.placeElm.css('height', $TreeDnDHelper.height(dragElm) + 'px');\n                }\n\n                if (element) {\n                    element[0].parentNode.insertBefore($scope.placeElm[0], element[0]);\n                } else {\n                    $scope.getElementChilds().append($scope.placeElm);\n                }\n\n                return $scope.placeElm;\n            };\n\n            $scope.hidePlace = function () {\n                if ($scope.placeElm) {\n                    $scope.placeElm.addClass($scope.$class.hidden);\n                }\n            };\n\n            $scope.showPlace = function () {\n                if ($scope.placeElm) {\n                    $scope.placeElm.removeClass($scope.$class.hidden);\n                }\n            };\n\n            $scope.getScopeTree = function () {\n                return $scope;\n            };\n\n        }\n\n        $scope.$safeApply = $safeApply;\n\n        var _fnInitFilter,\n            _fnInitOrderBy,\n            _fnGetControl,\n            _defaultFilterOption = {\n                showParent: true,\n                showChild:  false,\n                beginAnd:   true\n            },\n            tree,\n            _watches             = [\n                [\n                    'enableDrag', [\n                    ['boolean', 'enableStatus', null, 'enabledStatus'],\n                    ['boolean', 'enableMove', null, 'enabledMove'],\n                    ['number', 'dragDelay', 0, null, 0],\n                    ['boolean', 'enableCollapse', null, 'enabledCollapse'],\n                    [\n                        'boolean', 'enableHotkey', null, 'enabledHotkey', null, function (isHotkey) {\n                        if (isHotkey) {\n                            $scope.enabledMove = false;\n                        } else {\n                            $scope.enabledMove = $scope.statusMove;\n                        }\n                    }]\n                ]],\n                [\n                    ['enableDrag', 'enableStatus'], [\n                    [\n                        'string', 'templateCopy', $attrs.templateCopy, 'templateCopy', null,\n                        function (_url) {\n                            if (_url && $templateCache.get(_url)) {\n                                $TreeDnDTemplate.setCopy(_url, $scope);\n                            }\n                        }],\n                    [\n                        'string', 'templateMove', $attrs.templateMove, 'templateMove', null,\n                        function (_url) {\n                            if (_url && $templateCache.get(_url)) {\n                                $TreeDnDTemplate.setMove(_url, $scope);\n                            }\n                        }]\n                ]],\n                [\n                    [['enableDrag', 'enableDrop']], [\n                    ['number', 'dragBorder', 30, 'dragBorder', 30]]\n                ],\n                [\n                    '*', [\n                    ['boolean', 'treeTable', true, 'treeTable', null],\n                    ['boolean', 'horizontal'],\n                    [\n                        'callback', 'treeClass', function (val) {\n                        switch (typeof val) {\n                            case 'string':\n                                $scope.$tree_class = val;\n                                break;\n                            case 'object':\n                                angular.extend($scope.$class, val);\n                                $scope.$tree_class = $scope.$class.tree;\n                                break;\n                            default:\n                                $scope.$tree_class = $attrs.treeClass;\n                                break;\n                        }\n                    }, 'treeClass', function () {\n                        $scope.$tree_class = $scope.$class.tree + ' table';\n                    }, null, function () {\n                        if (/^(\\s+[\\w\\-]+){2,}$/g.test(' ' + $attrs.treeClass)) {\n                            $scope.$tree_class = $attrs.treeClass.trim();\n                            return true;\n                        }\n                    }],\n                    [\n                        ['object', 'string'], 'expandOn', getExpandOn, 'expandingProperty', getExpandOn,\n                        function (expandOn) {\n                            if (angular.isUndefinedOrNull(expandOn)) {\n                                $scope.expandingProperty = $attrs.expandOn;\n                            }\n                        }],\n                    [\n                        'object', 'treeControl', angular.isDefined($scope.tree) ? $scope.tree : {},\n                        'tree', null, function ($tree) {\n\n                        if (!angular.isFunction(_fnGetControl)) {\n                            _fnGetControl = $TreeDnDPlugin('$TreeDnDControl');\n                        }\n\n                        if (angular.isFunction(_fnGetControl)) {\n                            tree = angular.extend(\n                                $tree,\n                                _fnGetControl($scope)\n                            );\n                        }\n                    }],\n                    [\n                        ['array', 'object'], 'columnDefs', getColDefs, 'colDefinitions', getColDefs,\n                        function (colDefs) {\n                            if (angular.isUndefinedOrNull(colDefs) || !angular.isArray(colDefs)) {\n                                $scope.colDefinitions = getColDefs();\n                            }\n                        }],\n                    [['object', 'string', 'array', 'function'], 'orderBy', $attrs.orderBy],\n                    [\n                        ['object', 'array'], 'filter', null, 'filter', null, function (filters) {\n                        var _passed = false;\n                        if (angular.isDefined(filters) && !angular.isArray(filters)) {\n                            var _keysF = Object.keys(filters),\n                                _lenF  = _keysF.length, _iF;\n\n                            if (_lenF > 0) {\n                                for (_iF = 0; _iF < _lenF; _iF++) {\n\n                                    if (typeof filters[_keysF[_iF]] === 'string' &&\n                                        filters[_keysF[_iF]].length === 0) {\n                                        continue;\n                                    }\n                                    _passed = true;\n                                    break;\n                                }\n                            }\n                        }\n\n                        $scope.enabledFilter = _passed;\n                        reload_data();\n                    }],\n                    [\n                        'object', 'filterOptions', _defaultFilterOption, 'filterOptions',\n                        _defaultFilterOption, function (option) {\n                        if (typeof option === 'object') {\n                            $scope.filterOptions = angular.extend(_defaultFilterOption, option);\n                        }\n                    }],\n                    ['string', 'primaryKey', $attrs.primaryKey, 'primary_key', '__uid__'],\n                    ['string', 'indentUnit', $attrs.indentUnit, 'indent_unit'],\n                    ['number', 'indent', 30, null, 30],\n                    ['number', 'indentPlus', 20, null, 20],\n                    [\n                        'null', 'callbacks',\n                        function (optCallbacks) {\n                            angular.forEach(\n                                optCallbacks, function (value, key) {\n                                    if (typeof value === 'function') {\n                                        if ($scope.$callbacks[key]) {\n                                            $scope.$callbacks[key] = value;\n                                        }\n                                    }\n                                }\n                            );\n                            return $scope.$callbacks;\n                        },\n                        '$callbacks'\n                    ],\n                    [\n                        'number', 'expandLevel', 3, 'expandLevel', 3, function () {\n                        reload_data();\n                    }],\n                    ['number', 'treeLimit', 100, '$TreeLimit', 100],\n                    ['boolean', 'enableDrag', null, 'dragEnabled'],\n                    ['boolean', 'enableDrop', null, 'dropEnabled']\n                ]]\n            ],\n            w, lenW              = _watches.length,\n            i, len,\n            _curW,\n            _typeW, _nameW, _defaultW, _scopeW, _NotW, _AfterW, _BeforeW,\n\n            // debounce reload_Data;\n            timeReloadData, tmpTreeData;\n\n        for (w = 0; w < lenW; w++) {\n            // skip if not exist\n            if (!check_exist_attr($attrs, _watches[w][0], true)) {\n                continue;\n            }\n            _curW = _watches[w][1];\n            for (i = 0, len = _curW.length; i < len; i++) {\n                _typeW    = _curW[i][0];\n                _nameW    = _curW[i][1];\n                _defaultW = _curW[i][2];\n                _scopeW   = _curW[i][3];\n                _NotW     = _curW[i][4];\n                _AfterW   = _curW[i][5];\n                _BeforeW  = _curW[i][6];\n                generateWatch(_typeW, _nameW, _defaultW, _scopeW, _NotW, _AfterW, _BeforeW);\n            }\n        }\n\n        if ($attrs.treeData) {\n            $scope.$watch(\n                $attrs.treeData, function (val) {\n                    if (angular.equals(val, $scope.treeData)) {\n                        return;\n                    }\n\n                    tmpTreeData = val;\n                    if (angular.isUndefinedOrNull(timeReloadData)) {\n                        timeReloadData = $timeout(timeLoadData, 350);\n                    }\n                }, true\n            );\n        }\n\n        function timeLoadData() {\n            $scope.treeData = tmpTreeData;\n            reload_data();\n            timeReloadData  = null;\n        }\n\n        $scope.updateLimit = function updateLimit() {\n            //console.log('Call fn UpdateLimit');\n            $scope.$TreeLimit += 50;\n        };\n\n        $scope.reload_data = reload_data;\n\n        function check_exist_attr(attrs, existAttr, isAnd) {\n            if (angular.isUndefinedOrNull(existAttr)) {\n                return false;\n            }\n\n            if (existAttr === '*' || !angular.isUndefined(attrs[existAttr])) {\n                return true;\n            }\n\n            if (angular.isArray(existAttr)) {\n                return for_each_attrs(attrs, existAttr, isAnd);\n            }\n        }\n\n        function for_each_attrs(attrs, exist, isAnd) {\n            var i, len = exist.length, passed = false;\n\n            if (len === 0) {\n                return null;\n            }\n            for (i = 0; i < len; i++) {\n                if (check_exist_attr(attrs, exist[i], !isAnd)) {\n                    passed = true;\n                    if (!isAnd) {\n                        return true;\n                    }\n                } else {\n                    if (isAnd) {\n                        return false;\n                    }\n                }\n            }\n\n            return passed;\n        }\n\n        function generateWatch(type, nameAttr, valDefault, nameScope, fnNotExist, fnAfter,\n                               fnBefore\n        ) {\n            nameScope = nameScope || nameAttr;\n            if (typeof type === 'string' || angular.isArray(type)) {\n                if (angular.isFunction(fnBefore) && fnBefore()) {\n                    return;//jmp\n                }\n                if (typeof $attrs[nameAttr] === 'string') {\n                    $scope.$watch(\n                        $attrs[nameAttr], function (val) {\n                            if (typeof type === 'string' && typeof val === type ||\n                                angular.isArray(type) && type.indexOf(typeof val) > -1\n                            ) {\n                                $scope[nameScope] = val;\n                            } else {\n                                if (angular.isFunction(valDefault)) {\n                                    $scope[nameScope] = valDefault(val);\n                                } else {\n                                    $scope[nameScope] = valDefault;\n                                }\n                            }\n\n                            if (angular.isFunction(fnAfter)) {\n                                fnAfter($scope[nameScope], $scope);\n                            }\n                        }, true\n                    );\n                } else {\n\n                    if (angular.isFunction(fnNotExist)) {\n                        $scope[nameScope] = fnNotExist();\n                    } else if (!angular.isUndefined(fnNotExist)) {\n                        $scope[nameScope] = fnNotExist;\n                    }\n                }\n            }\n        }\n\n        function $safeApply(fn) {\n            var phase = this.$root.$$phase;\n            if (phase === '$apply' || phase === '$digest') {\n                if (fn && typeof fn === 'function') {\n                    fn();\n                }\n            } else {\n                this.$apply(fn);\n            }\n        }\n\n        function getExpandOn() {\n            if ($scope.treeData && $scope.treeData.length) {\n                var _firstNode = $scope.treeData[0], _keys = Object.keys(_firstNode),\n                    _regex     = new RegExp('^__([a-zA-Z0-9_\\-]*)__$'),\n                    _len,\n                    i;\n                // Auto get first field with type is string;\n                for (i = 0, _len = _keys.length; i < _len; i++) {\n                    if (typeof _firstNode[_keys[i]] === 'string' && !_regex.test(_keys[i])) {\n                        $scope.expandingProperty = _keys[i];\n                        return;\n                    }\n                }\n\n                // Auto get first\n                if (angular.isUndefinedOrNull($scope.expandingProperty)) {\n                    $scope.expandingProperty = _keys[0];\n                }\n\n            }\n        }\n\n        function getColDefs() {\n            // Auto get Defs except attribute __level__ ....\n            if ($scope.treeData.length) {\n                var _col_defs = [], _firstNode = $scope.treeData[0],\n                    _regex    = new RegExp('(^__([a-zA-Z0-9_\\-]*)__$|^' + $scope.expandingProperty + '$)'),\n                    _keys     = Object.keys(_firstNode),\n                    i, _len;\n                // Auto get first field with type is string;\n                for (i = 0, _len = _keys.length; i < _len; i++) {\n                    if (typeof _firstNode[_keys[i]] === 'string' && !_regex.test(_keys[i])) {\n                        _col_defs.push(\n                            {\n                                field: _keys[i]\n                            }\n                        );\n                    }\n                }\n                $scope.colDefinitions = _col_defs;\n            }\n        }\n\n        function do_f(root, node, parent, parent_real, level, visible, index) {\n            var _i, _len, _icon, _index_real, _dept, _hashKey;\n            if (!angular.isArray(node.__children__)) {\n                node.__children__ = [];\n            }\n\n            node.__parent_real__ = parent_real;\n            node.__parent__      = parent;\n            _len                 = node.__children__.length;\n\n            if (angular.isUndefinedOrNull(node.__expanded__) && _len > 0) {\n                node.__expanded__ = level < $scope.expandLevel;\n            }\n\n            if (_len === 0) {\n                _icon = -1;\n            } else {\n                if (node.__expanded__) {\n                    _icon = 1;\n                } else {\n                    _icon = 0;\n                }\n            }\n\n            // Insert item vertically\n            _index_real         = root.length;\n            node.__index__      = index;\n            node.__index_real__ = _index_real;\n            node.__level__      = level;\n            node.__icon__       = _icon;\n            node.__icon_class__ = $scope.$class.icon[_icon];\n            node.__visible__    = !!visible;\n\n            if (angular.isUndefinedOrNull(node.__uid__)) {\n                node.__uid__ = '' + Math.random();\n            }\n\n            _hashKey = $scope.getHash(node);\n\n            if (angular.isUndefinedOrNull(node.__hashKey__) || node.__hashKey__ !== _hashKey) {\n                node.__hashKey__ = _hashKey;\n            }\n\n            root.push(node);\n\n            // Check node children\n            _dept = 1;\n            if (_len > 0) {\n                for (_i = 0; _i < _len; _i++) {\n                    _dept += do_f(\n                        root,\n                        node.__children__[_i],\n                        node[$scope.primary_key],\n                        _index_real,\n                        level + 1,\n                        visible && node.__expanded__,\n                        _i\n                    );\n                }\n            }\n\n            node.__dept__ = _dept;\n\n            return _dept;\n        }\n\n        function reload_data(oData) {\n            console.time('Reload_Data');\n\n            var _data,\n                _len,\n                _tree_nodes = [];\n            if (angular.isDefined(oData)) {\n                if (!angular.isArray(oData) || oData.length === 0) {\n                    return [];\n                } else {\n                    _data = oData;\n                }\n            } else if (!angular.isArray($scope.treeData) || $scope.treeData.length === 0) {\n                return [];\n            } else {\n                _data = $scope.treeData;\n            }\n\n            if (!$attrs.expandOn) {\n                getExpandOn();\n            }\n\n            if (!$attrs.columnDefs) {\n                getColDefs();\n            }\n\n            if (angular.isDefined($scope.orderBy)) {\n                if (!angular.isFunction(_fnInitOrderBy)) {\n                    _fnInitOrderBy = $TreeDnDPlugin('$TreeDnDOrderBy');\n                }\n\n                if (angular.isFunction(_fnInitOrderBy)) {\n                    _data = _fnInitOrderBy(_data, $scope.orderBy);\n                }\n            }\n\n            if (angular.isDefined($scope.filter)) {\n                if (!angular.isFunction(_fnInitFilter)) {\n                    _fnInitFilter = $TreeDnDPlugin('$TreeDnDFilter');\n                }\n\n                if (angular.isFunction(_fnInitFilter)) {\n                    _data = _fnInitFilter(_data, $scope.filter, $scope.filterOptions);\n                }\n            }\n\n            _len = _data.length;\n            if (_len > 0) {\n                var _i,\n                    _deptTotal = 0;\n\n                for (_i = 0; _i < _len; _i++) {\n                    _deptTotal += do_f(_tree_nodes, _data[_i], null, null, 1, true, _i);\n                }\n\n            }\n\n            // clear memory\n            if (angular.isDefined($scope.tree_nodes)) {\n                delete $scope.tree_nodes;\n            }\n\n            $scope.tree_nodes = _tree_nodes;\n\n            console.timeEnd('Reload_Data');\n            return _tree_nodes;\n        }\n    }\n\n    function fnCompile(tElement) {\n\n        var $_Template = '',\n            _element   = tElement.html().trim();\n\n        if (_element.length > 0) {\n            $_Template = _element;\n            tElement.html('');\n        }\n\n        return function fnPost(scope, element, attrs) {\n\n            if (attrs.enableDrag) {\n                var _fnInitDrag = $TreeDnDPlugin('$TreeDnDDrag');\n                if (angular.isFunction(_fnInitDrag)) {\n                    _fnInitDrag(scope, element, $window, $document);\n                }\n            }\n\n            // kick out $digest\n            element.ready(function () {\n                // apply Template\n                function checkTreeTable(template, scope) {\n                    var elemNode = template[0].querySelector('[tree-dnd-node]'),\n                        attrInclude;\n\n                    scope.isTable = null;\n                    if (elemNode) {\n                        elemNode    = angular.element(elemNode);\n                        attrInclude = elemNode.attr('ng-include');\n                    } else {\n                        return;\n                    }\n\n                    if (attrInclude) {\n                        var treeInclude = $parse(attrInclude)(scope) || attrInclude;\n                        if (typeof treeInclude === 'string') {\n                            return $http.get(\n                                treeInclude,\n                                {cache: $templateCache}\n                            ).success(\n                                function (data) {\n                                    data = data.trim();\n                                    //scope.templateNode = data;\n                                    var tempDiv       = document.createElement('div');\n                                    tempDiv.innerHTML = data;\n                                    tempDiv           = angular.element(tempDiv);\n                                    scope.isTable     = !tempDiv[0].querySelector('[tree-dnd-nodes]');\n                                }\n                            );\n                        }\n                    } else {\n                        scope.isTable = !elemNode[0].querySelector('[tree-dnd-nodes]');\n                        //scope.templateNode = elemNode.html();\n                    }\n                    $TreeDnDViewport.setTemplate(scope, scope.templateNode);\n                    //elemNode.html('');\n                }\n\n                //scope.$watch(tableDataLoaded, transformTable);\n                /*\n                 function tableDataLoaded(elem) {\n                 // first cell in the tbody exists when data is loaded but doesn't have a width\n                 // until after the table is transformed\n                 var firstCell = elem.querySelector('tbody tr:first-child td:first-child');\n                 return firstCell && !firstCell.style.width;\n                 }\n\n                 function transformTable(elem, attrs) {\n                 // reset display styles so column widths are correct when measured below\n                 angular.element(elem.querySelectorAll('thead, tbody, tfoot')).css('display', '');\n\n                 // wrap in $timeout to give table a chance to finish rendering\n                 $timeout(function () {\n                 // set widths of columns\n                 angular.forEach(elem.querySelectorAll('tr:first-child th'), function (thElem, i) {\n\n                 var tdElems = elem.querySelector('tbody tr:first-child td:nth-child(' + (i + 1) + ')');\n                 var tfElems = elem.querySelector('tfoot tr:first-child td:nth-child(' + (i + 1) + ')');\n\n                 var columnWidth = tdElems ? tdElems.offsetWidth : thElem.offsetWidth;\n                 if (tdElems) {\n                 tdElems.style.width = columnWidth + 'px';\n                 }\n                 if (thElem) {\n                 thElem.style.width = columnWidth + 'px';\n                 }\n                 if (tfElems) {\n                 tfElems.style.width = columnWidth + 'px';\n                 }\n                 });\n\n                 // set css styles on thead and tbody\n                 angular.element(elem.querySelectorAll('thead, tfoot')).css('display', 'block');\n\n                 angular.element(elem.querySelectorAll('tbody')).css({\n                 'display':  'block',\n                 'height':   attrs.tableHeight || 'inherit',\n                 'overflow': 'auto'\n                 });\n\n                 // reduce width of last column by width of scrollbar\n                 var tbody          = elem.querySelector('tbody');\n                 var scrollBarWidth = tbody.offsetWidth - tbody.clientWidth;\n                 if (scrollBarWidth > 0) {\n                 // for some reason trimming the width by 2px lines everything up better\n                 scrollBarWidth -= 2;\n                 var lastColumn         = elem.querySelector('tbody tr:first-child td:last-child');\n                 lastColumn.style.width = lastColumn.offsetWidth - scrollBarWidth + 'px';\n                 }\n                 });\n                 }*/\n                var promiseCheck;\n                if ($_Template.length > 0) {\n                    promiseCheck = checkTreeTable(angular.element($_Template.trim()), scope);\n                    if (typeof promiseCheck === 'object') {\n                        promiseCheck.then(function () {\n                            element.append($compile($_Template)(scope));\n                        });\n                    } else {\n                        element.append($compile($_Template)(scope));\n                    }\n                } else {\n                    $http.get(\n                        attrs.templateUrl || $TreeDnDTemplate.getPath(),\n                        {cache: $templateCache}\n                    ).success(\n                        function (data) {\n                            data         = angular.element(data.trim());\n                            promiseCheck = checkTreeTable(data, scope);\n                            if (typeof promiseCheck === 'object') {\n                                promiseCheck.then(function () {\n                                    element.append($compile(data)(scope));\n                                });\n                            } else {\n                                element.append($compile(data)(scope));\n                            }\n                        }\n                    );\n                }\n            })\n        };\n    }\n}\n\n\nangular.module('ntt.TreeDnD')\n    .factory(\n    '$TreeDnDConvert', function () {\n        var _$initConvert = {\n            line2tree: function (data, primaryKey, parentKey) {\n                if (!data || data.length === 0 || !primaryKey || !parentKey) {\n                    return [];\n                }\n                var tree = [],\n                    rootIds = [],\n                    item = data[0],\n                    _primary = item[primaryKey],\n                    treeObjs = {},\n                    parentId, parent,\n                    len = data.length,\n                    i = 0;\n                while (i < len) {\n                    item = data[i++];\n                    _primary = item[primaryKey];\n                    treeObjs[_primary] = item;\n                    parentId = item[parentKey];\n                    if (parentId) {\n                        parent = treeObjs[parentId];\n                        if (parent.__children__) {\n                            parent.__children__.push(item);\n                        } else {\n                            parent.__children__ = [item];\n                        }\n                    } else {\n                        rootIds.push(_primary);\n                    }\n                }\n                len = rootIds.length;\n                for (i = 0; i < len; i++) {\n                    tree.push(treeObjs[rootIds[i]]);\n                }\n                return tree;\n            },\n            tree2tree: function access_child(data, containKey) {\n                var _tree = [],\n                    _i,\n                    _len = data ? data.length : 0,\n                    _copy, _child;\n                for (_i = 0; _i < _len; _i++) {\n                    _copy = angular.copy(data[_i]);\n                    if (angular.isArray(_copy[containKey]) && _copy[containKey].length > 0) {\n                        _child = access_child(_copy[containKey], containKey);\n                            delete _copy[containKey];\n                        _copy.__children__ = _child;\n                    }\n                    _tree.push(_copy);\n                }\n                return _tree;\n            }\n        };\n\n        return _$initConvert;\n    }\n);\n\nangular.module('ntt.TreeDnD')\n    .factory(\n    '$TreeDnDHelper', [\n        '$document', '$window', function ($document, $window) {\n            var _$helper = {\n                nodrag:          function (targetElm) {\n                    return typeof targetElm.attr('data-nodrag') !== 'undefined';\n                },\n                eventObj:        function (e) {\n                    var obj = e;\n                    if (e.targetTouches !== undefined) {\n                        obj = e.targetTouches.item(0);\n                    } else if (e.originalEvent !== undefined && e.originalEvent.targetTouches !== undefined) {\n                        obj = e.originalEvent.targetTouches.item(0);\n                    }\n                    return obj;\n                },\n                dragInfo:        function (scope) {\n                    var _node = scope.getData(),\n                        _tree = scope.getScopeTree(),\n                        _parent = scope.getNode(_node.__parent_real__);\n                    return {\n                        node:    _node,\n                        parent:  _parent,\n                        move:    {\n                            parent: _parent,\n                            pos:    _node.__index__\n                        },\n                        scope:   scope,\n                        target:  _tree,\n                        drag:    _tree,\n                        drop:    scope.getPrevSibling(_node),\n                        changed: false\n                    };\n                },\n                height:          function (element) {\n                    return element.prop('scrollHeight');\n                },\n                width:           function (element) {\n                    return element.prop('scrollWidth');\n                },\n                offset:          function (element) {\n                    var boundingClientRect = element[0].getBoundingClientRect();\n                    return {\n                        width:  element.prop('offsetWidth'),\n                        height: element.prop('offsetHeight'),\n                        top:    boundingClientRect.top + ($window.pageYOffset || $document[0].body.scrollTop || $document[0].documentElement.scrollTop),\n                        left:   boundingClientRect.left + ($window.pageXOffset || $document[0].body.scrollLeft || $document[0].documentElement.scrollLeft)\n                    };\n                },\n                positionStarted: function (e, target) {\n                    var pos = {};\n                    pos.offsetX = e.pageX - this.offset(target).left;\n                    pos.offsetY = e.pageY - this.offset(target).top;\n                    pos.startX = pos.lastX = e.pageX;\n                    pos.startY = pos.lastY = e.pageY;\n                    pos.nowX = pos.nowY = pos.distX = pos.distY = pos.dirAx = 0;\n                    pos.dirX = pos.dirY = pos.lastDirX = pos.lastDirY = pos.distAxX = pos.distAxY = 0;\n                    return pos;\n                },\n                positionMoved:   function (e, pos, firstMoving) {\n                    // mouse position last events\n                    pos.lastX = pos.nowX;\n                    pos.lastY = pos.nowY;\n                    // mouse position this events\n                    pos.nowX = e.pageX;\n                    pos.nowY = e.pageY;\n                    // distance mouse moved between events\n                    pos.distX = pos.nowX - pos.lastX;\n                    pos.distY = pos.nowY - pos.lastY;\n                    // direction mouse was moving\n                    pos.lastDirX = pos.dirX;\n                    pos.lastDirY = pos.dirY;\n                    // direction mouse is now moving (on both axis)\n                    pos.dirX = pos.distX === 0 ? 0 : pos.distX > 0 ? 1 : -1;\n                    pos.dirY = pos.distY === 0 ? 0 : pos.distY > 0 ? 1 : -1;\n                    // axis mouse is now moving on\n                    var newAx = Math.abs(pos.distX) > Math.abs(pos.distY) ? 1 : 0;\n                    // do nothing on first move\n                    if (firstMoving) {\n                        pos.dirAx = newAx;\n                        pos.moving = true;\n                        return;\n                    }\n                    // calc distance moved on this axis (and direction)\n                    if (pos.dirAx !== newAx) {\n                        pos.distAxX = 0;\n                        pos.distAxY = 0;\n                    } else {\n                        pos.distAxX += Math.abs(pos.distX);\n                        if (pos.dirX !== 0 && pos.dirX !== pos.lastDirX) {\n                            pos.distAxX = 0;\n                        }\n                        pos.distAxY += Math.abs(pos.distY);\n                        if (pos.dirY !== 0 && pos.dirY !== pos.lastDirY) {\n                            pos.distAxY = 0;\n                        }\n                    }\n                    pos.dirAx = newAx;\n                },\n                replaceIndent:   function (scope, element, indent, attr) {\n                    attr =  attr || 'left';\n                    angular.element(element.children()[0]).css(attr, scope.$callbacks.calsIndent(indent));\n                }\n            };\n            return _$helper;\n        }]\n);\n\nangular.module('ntt.TreeDnD')\n    .factory(\n    '$TreeDnDPlugin',['$injector', function ($injector) {\n        var _fnget = function (name) {\n                if (angular.isDefined($injector) && $injector.has(name)) {\n                    return $injector.get(name);\n                }\n                return null;\n            };\n        return _fnget;\n    }]\n);\n\nangular.module('ntt.TreeDnD')\n    .factory(\n    '$TreeDnDTemplate', [\n        '$templateCache', function ($templateCache) {\n            var templatePath = 'template/TreeDnD/TreeDnD.html',\n                copyPath = 'template/TreeDnD/TreeDnDStatusCopy.html',\n                movePath = 'template/TreeDnD/TreeDnDStatusMove.html',\n                scopes = {},\n                temp,\n                _$init = {\n                    setMove: function (path, scope) {\n                        if (!scopes[scope.$id]) {\n                            scopes[scope.$id] = {};\n                        }\n                        scopes[scope.$id].movePath = path;\n                    },\n                    setCopy: function (path, scope) {\n                        if (!scopes[scope.$id]) {\n                            scopes[scope.$id] = {};\n                        }\n                        scopes[scope.$id].copyPath = path;\n                    },\n                    getPath: function () {\n                        return templatePath;\n                    },\n                    getCopy: function (scope) {\n                        if (scopes[scope.$id] && scopes[scope.$id].copyPath) {\n                            temp = $templateCache.get(scopes[scope.$id].copyPath);\n                            if (temp) {\n                                return temp;\n                            }\n                        }\n                        return $templateCache.get(copyPath);\n                    },\n                    getMove: function (scope) {\n                        if (scopes[scope.$id] && scopes[scope.$id].movePath) {\n                            temp = $templateCache.get(scopes[scope.$id].movePath);\n                            if (temp) {\n                                return temp;\n                            }\n                        }\n                        return $templateCache.get(movePath);\n                    }\n                };\n\n            return _$init;\n        }]\n);\n\nangular.module('ntt.TreeDnD')\n    .factory('$TreeDnDViewport', fnInitTreeDnDViewport);\n\nfnInitTreeDnDViewport.$inject = ['$window', '$document', '$timeout', '$q', '$compile'];\n\nfunction fnInitTreeDnDViewport($window, $document, $timeout, $q, $compile) {\n\n    var viewport      = null,\n        isUpdating    = false,\n        isRender      = false,\n        updateAgain   = false,\n        viewportRect,\n        items         = [],\n        nodeTemplate,\n        updateTimeout,\n        renderTime,\n        $initViewport = {\n            setViewport:   setViewport,\n            getViewport:   getViewport,\n            add:           add,\n            setTemplate:   setTemplate,\n            getItems:      getItems,\n            updateDelayed: updateDelayed\n        },\n        eWindow       = angular.element($window);\n\n    eWindow.on('load resize scroll', updateDelayed);\n\n    return $initViewport;\n\n    function update() {\n\n        viewportRect = {\n            width:  eWindow.prop('offsetWidth') || document.documentElement.clientWidth,\n            height: eWindow.prop('offsetHeight') || document.documentElement.clientHeight,\n            top:    $document[0].body.scrollTop || $document[0].documentElement.scrollTop,\n            left:   $document[0].body.scrollLeft || $document[0].documentElement.scrollLeft\n        };\n\n        if (isUpdating || isRender) {\n            updateAgain = true;\n            return;\n        }\n        isUpdating = true;\n\n        recursivePromise();\n    }\n\n    function recursivePromise() {\n        if (isRender) {\n            return;\n        }\n\n        var number = number > 0 ? number : items.length, item;\n\n        if (number > 0) {\n            item = items[0];\n\n            isRender   = true;\n            renderTime = $timeout(function () {\n                //item.element.html(nodeTemplate);\n                //$compile(item.element.contents())(item.scope);\n\n                items.splice(0, 1);\n                isRender = false;\n                number--;\n                $timeout.cancel(renderTime);\n                recursivePromise();\n            }, 0);\n\n        } else {\n            isUpdating = false;\n            if (updateAgain) {\n                updateAgain = false;\n                update();\n            }\n        }\n\n    }\n\n    /**\n     * Check if a point is inside specified bounds\n     * @param x\n     * @param y\n     * @param bounds\n     * @returns {boolean}\n     */\n    function pointIsInsideBounds(x, y, bounds) {\n        return x >= bounds.left &&\n               y >= bounds.top &&\n               x <= bounds.left + bounds.width &&\n               y <= bounds.top + bounds.height;\n    }\n\n    /**\n     * @name setViewport\n     * @desciption Set the viewport element\n     * @param element\n     */\n    function setViewport(element) {\n        viewport = element;\n    }\n\n    /**\n     * Return the current viewport\n     * @returns {*}\n     */\n    function getViewport() {\n        return viewport;\n    }\n\n    /**\n     * trigger an update\n     */\n    function updateDelayed() {\n        $timeout.cancel(updateTimeout);\n        updateTimeout = $timeout(function () {\n            update();\n        }, 100);\n    }\n\n    /**\n     * Add listener for event\n     * @param element\n     * @param callback\n     */\n    function add(scope, element) {\n        //console.log('call add');\n        updateDelayed();\n        items.push({\n            element: element,\n            scope:   scope\n        });\n    }\n\n    function setTemplate(scope, template) {\n        nodeTemplate = template;\n    }\n\n    /**\n     * Get list of items\n     * @returns {Array}\n     */\n    function getItems() {\n        return items;\n    }\n}\n\nangular.module('ntt.TreeDnD')\n    .factory(\n    '$TreeDnDFilter', [\n        '$filter', function ($filter) {\n            return fnInitFilter;\n\n            function for_all_descendants(options, node, fieldChild, fnBefore, fnAfter, parentPassed) {\n                if (!angular.isFunction(fnBefore)) {\n                    return null;\n                }\n\n                var _i, _len, _nodes,\n                    _nodePassed  = fnBefore(options, node),\n                    _childPassed = false;\n\n                if (angular.isDefined(node[fieldChild])) {\n                    _nodes = node[fieldChild];\n                    _len   = _nodes.length;\n                    for (_i = 0; _i < _len; _i++) {\n                        _childPassed = for_all_descendants(\n                                options,\n                                _nodes[_i],\n                                fieldChild,\n                                fnBefore,\n                                fnAfter,\n                                       _nodePassed || parentPassed\n                            ) || _childPassed;\n                    }\n                }\n\n                if (angular.isFunction(fnAfter)) {\n                    fnAfter(options, node, _nodePassed === true, _childPassed === true, parentPassed === true);\n                }\n\n                return _nodePassed || _childPassed;\n            }\n\n            /**\n             * Check data with callback\n             * @param {string|object|function|regex} callback\n             * @param {*} data\n             * @returns {null|boolean}\n             * @private\n             */\n            function _fnCheck(callback, data) {\n                if (angular.isUndefinedOrNull(data) || angular.isArray(data)) {\n                    return null;\n                }\n\n                if (angular.isFunction(callback)) {\n                    return callback(data, $filter);\n                } else {\n                    if (typeof callback === 'boolean') {\n                        data = !!data;\n                        return data === callback;\n                    } else if (angular.isDefined(callback)) {\n                        try {\n                            var _regex = new RegExp(callback);\n                            return _regex.test(data);\n                        }\n                        catch (err) {\n                            if (typeof data === 'string') {\n                                return data.indexOf(callback) > -1;\n                            } else {\n                                return null;\n                            }\n                        }\n                    } else {\n                        return null;\n                    }\n                }\n            }\n\n            /**\n             * `fnProcess` to call `_fnCheck`. If `condition` is `array` then call `for_each_filter`\n             * else will call `_fnCheck`. Specical `condition.field` is `_$` then apply `condition.callback` for all field, if have `field` invaild then `return true`.\n             *\n             * @param node\n             * @param condition\n             * @param isAnd\n             * @returns {null|boolean}\n             * @private\n             */\n            function _fnProccess(node, condition, isAnd) {\n                if (angular.isArray(condition)) {\n                    return for_each_filter(node, condition, isAnd);\n                } else {\n                    var _key      = condition.field,\n                        _callback = condition.callback,\n                        _iO, _keysO, _lenO;\n\n                    if (_key === '_$') {\n                        _keysO = Object.keys(node);\n                        _lenO  = _keysO.length;\n                        for (_iO = 0; _iO < _lenO; _iO++) {\n                            if (_fnCheck(_callback, node[_keysO[_iO]])) {\n                                return true;\n                            }\n                        }\n                    } else if (angular.isDefined(node[_key])) {\n                        return _fnCheck(_callback, node[_key]);\n                    }\n                }\n                return null;\n            }\n\n            /**\n             *\n             * @param {object} node\n             * @param {array} conditions Array `conditions`\n             * @param {boolean} isAnd check with condition `And`, if `And` then `return false` when all `false`\n             * @returns {null|boolean}\n             */\n            function for_each_filter(node, conditions, isAnd) {\n                var i, len = conditions.length || 0, passed = false;\n                if (len === 0) {\n                    return null;\n                }\n\n                for (i = 0; i < len; i++) {\n                    if (_fnProccess(node, conditions[i], !isAnd)) {\n                        passed = true;\n                        // if condition `or` then return;\n                        if (!isAnd) {\n                            return true;\n                        }\n                    } else {\n\n                        // if condition `and` and result in fnProccess = false then return;\n                        if (isAnd) {\n                            return false;\n                        }\n                    }\n                }\n\n                return passed;\n            }\n\n            /**\n             * Will call _fnAfter to clear data no need\n             * @param {object} options\n             * @param {object} node\n             * @param {boolean} isNodePassed\n             * @param {boolean} isChildPassed\n             * @param {boolean} isParentPassed\n             * @private\n             */\n            function _fnAfter(options, node, isNodePassed, isChildPassed, isParentPassed) {\n                if (isNodePassed === true) {\n                    node.__filtered__         = true;\n                    node.__filtered_visible__ = true;\n                    return; //jmp\n                } else if (isChildPassed === true && options.showParent === true\n                           || isParentPassed === true && options.showChild === true) {\n                    node.__filtered__         = false;\n                    node.__filtered_visible__ = true;\n                    return; //jmp\n                }\n\n                // remove attr __filtered__\n                delete node.__filtered__;\n                delete node.__filtered_visible__;\n            }\n\n            /**\n             * `fnBefore` will called when `for_all_descendants` of `node` checking.\n             * If `filter` empty then return `true` else result of function `_fnProccess` {@see _fnProccess}\n             *\n             * @param {object} options\n             * @param {object} node\n             * @returns {null|boolean}\n             * @private\n             */\n            function _fnBefore(options, node) {\n                if (options.filter.length === 0) {\n                    return true;\n                } else {\n                    return _fnProccess(node, options.filter, options.beginAnd || false);\n                }\n            }\n\n            /**\n             * `_fnConvert` to convert `filter` `object` to `array` invaild.\n             *\n             * @param {object|array} filters\n             * @returns {array} Instead of `filter` or new array invaild *(converted from filter)*\n             * @private\n             */\n            function _fnConvert(filters) {\n                var _iF, _lenF, _keysF,\n                    _filter,\n                    _state;\n                // convert filter object to array filter\n                if (angular.isObject(filters) && !angular.isArray(filters)) {\n                    _keysF  = Object.keys(filters);\n                    _lenF   = _keysF.length;\n                    _filter = [];\n\n                    if (_lenF > 0) {\n                        for (_iF = 0; _iF < _lenF; _iF++) {\n\n                            if (typeof filters[_keysF[_iF]] === 'string' && filters[_keysF[_iF]].length === 0) {\n                                continue;\n                            } else if (angular.isArray(filters[_keysF[_iF]])) {\n                                _state = filters[_keysF[_iF]];\n                            } else if (angular.isObject(filters[_keysF[_iF]])) {\n                                _state = _fnConvert(filters[_keysF[_iF]]);\n                            } else {\n                                _state = {\n                                    field:    _keysF[_iF],\n                                    callback: filters[_keysF[_iF]]\n                                };\n                            }\n                            _filter.push(_state);\n                        }\n                    }\n                    _state = null;\n                    return _filter;\n                }\n                else {\n                    return filters;\n                }\n            }\n\n            /**\n             * `fnInitFilter` function is constructor of service `$TreeDnDFilter`.\n             * @constructor\n             * @param {object|array} treeData\n             * @param {object|array} filters\n             * @param {object} options\n             * @param {string} keyChild\n             * @returns {array} Return `treeData` or `treeData` with `filter`\n             * @private\n             */\n            function fnInitFilter(treeData, filters, options, keyChild) {\n                if (!angular.isArray(treeData)\n                    || treeData.length === 0\n                    || !(angular.isArray(filters) || angular.isObject(filters))\n                    || filters.length === 0) {\n                    return treeData;\n                }\n\n                var _i, _len,\n                    _filter;\n\n                _filter = _fnConvert(filters);\n                if (!(angular.isArray(_filter) || angular.isObject(_filter))\n                    || _filter.length === 0) {\n                    return treeData;\n                }\n                options.filter = _filter;\n                for (_i = 0, _len = treeData.length; _i < _len; _i++) {\n                    for_all_descendants(\n                        options,\n                        treeData[_i],\n                        keyChild || '__children__',\n                        _fnBefore, _fnAfter\n                    );\n                }\n\n                return treeData;\n            }\n\n        }]\n);\n\nangular.module('ntt.TreeDnD')\n    .factory(\n    '$TreeDnDOrderBy', [\n        '$filter', function ($filter) {\n            var _fnOrderBy = $filter('orderBy'),\n                for_all_descendants = function for_all_descendants(options, node, name, fnOrderBy) {\n                    var _i, _len, _nodes;\n\n                    if (angular.isDefined(node[name])) {\n                        _nodes = node[name];\n                        _len = _nodes.length;\n                        // OrderBy children\n                        for (_i = 0; _i < _len; _i++) {\n                            _nodes[_i] = for_all_descendants(options, _nodes[_i], name, fnOrderBy);\n                        }\n\n                        node[name] = fnOrderBy(node[name], options);\n                    }\n                    return node;\n                },\n                _fnOrder = function _fnOrder(list, orderBy) {\n                    return _fnOrderBy(list, orderBy);\n                },\n                _fnMain = function _fnMain(treeData, orderBy) {\n                    if (!angular.isArray(treeData)\n                        || treeData.length === 0\n                        || !(angular.isArray(orderBy) || angular.isObject(orderBy) || angular.isString(orderBy) || angular.isFunction(orderBy))\n                        || orderBy.length === 0 && !angular.isFunction(orderBy)) {\n                        return treeData;\n                    }\n\n                    var _i, _len;\n\n                    for (_i = 0, _len = treeData.length; _i < _len; _i++) {\n                        treeData[_i] = for_all_descendants(\n                            orderBy,\n                            treeData[_i],\n                            '__children__',\n                            _fnOrder\n                        );\n                    }\n\n                    return _fnOrder(treeData, orderBy);\n                };\n\n            return _fnMain;\n        }]\n);\n\nangular.module('ntt.TreeDnD')\n    .factory(\n    '$TreeDnDDrag', [\n        '$timeout', '$TreeDnDHelper',\n        function ($timeout, $TreeDnDHelper) {\n            function _fnPlaceHolder(e, $params) {\n                if ($params.placeElm) {\n                    var _offset = $TreeDnDHelper.offset($params.placeElm);\n                    if (_offset.top <= e.pageY && e.pageY <= _offset.top + _offset.height &&\n                        _offset.left <= e.pageX && e.pageX <= _offset.left + _offset.width\n                    ) {\n                        return true;\n                    }\n                }\n                return false;\n            }\n\n            function _fnDragStart(e, $params) {\n                if (!$params.hasTouch && (e.button === 2 || e.which === 3)) {\n                    // disable right click\n                    return;\n                }\n                if (e.uiTreeDragging || e.originalEvent && e.originalEvent.uiTreeDragging) { // event has already fired in other scope.\n                    return;\n                }\n                // the element which is clicked.\n                var eventElm   = angular.element(e.target),\n                    eventScope = eventElm.scope();\n                if (!eventScope || !eventScope.$type) {\n                    return;\n                }\n                // if (eventScope.$type !== 'TreeDnDNode') { // Check if it is a node or a handle\n                //     return;\n                // }\n\n                if (eventScope.$type !== 'TreeDnDNodeHandle') { // If the node has a handle, then it should be clicked by the handle\n                    return;\n                }\n\n                var eventElmTagName = eventElm.prop('tagName').toLowerCase(),\n                    dragScope,\n                    _$scope         = $params.$scope;\n                if (eventElmTagName === 'input'\n                    || eventElmTagName === 'textarea'\n                    || eventElmTagName === 'button'\n                    || eventElmTagName === 'select') { // if it's a input or button, ignore it\n                    return;\n                }\n                // check if it or it's parents has a 'data-nodrag' attribute\n                while (eventElm && eventElm[0] && eventElm[0] !== $params.element) {\n                    if ($TreeDnDHelper.nodrag(eventElm)) { // if the node mark as `nodrag`, DONOT drag it.\n                        return;\n                    }\n                    eventElm = eventElm.parent();\n                }\n\n                e.uiTreeDragging = true; // stop event bubbling\n                if (e.originalEvent) {\n                    e.originalEvent.uiTreeDragging = true;\n                }\n                e.preventDefault();\n\n                dragScope = eventScope.getScopeNode();\n\n                $params.dragInfo = $TreeDnDHelper.dragInfo(dragScope);\n\n                if (!_$scope.$callbacks.beforeDrag(dragScope, $params.dragInfo)) {\n                    return;\n                }\n\n                $params.firstMoving = true;\n                _$scope.setDragging($params.dragInfo);\n\n                var eventObj = $TreeDnDHelper.eventObj(e);\n                $params.pos  = $TreeDnDHelper.positionStarted(eventObj, dragScope.$element);\n\n                if (dragScope.isTable) {\n                    $params.dragElm = angular.element($params.$window.document.createElement('table'))\n                        .addClass(_$scope.$class.tree)\n                        .addClass(_$scope.$class.drag)\n                        .addClass(_$scope.$tree_class);\n                } else {\n                    $params.dragElm = angular.element($params.$window.document.createElement('ul'))\n                        .addClass(_$scope.$class.drag)\n                        .addClass('tree-dnd-nodes')\n                        .addClass(_$scope.$tree_class);\n                }\n\n                $params.dragElm.css(\n                    {\n                        'width':   $TreeDnDHelper.width(dragScope.$element) + 'px',\n                        'z-index': 9995\n                    }\n                );\n\n                $params.offsetEdge = 0;\n                var _width         = $TreeDnDHelper.width(dragScope.$element),\n                    _scope         = dragScope,\n                    _element       = _scope.$element,\n                    _clone,\n                    _needCollapse  = !!_$scope.enabledCollapse,\n                    _copied        = false,\n                    _tbody,\n                    _frag;\n\n                if (_scope.isTable) {\n                    $params.offsetEdge = $params.dragInfo.node.__level__ - 1;\n                    _tbody             = angular.element(document.createElement('tbody'));\n                    _frag              = angular.element(document.createDocumentFragment());\n\n                    _$scope.for_all_descendants(\n                        $params.dragInfo.node, function (_node, _parent) {\n                            _scope   = _$scope.getScope(_node);\n                            _element = _scope && _scope.$element;\n                            if (_scope && _element) {\n                                if (!_copied) {\n                                    _clone = _element.clone();\n\n                                    $TreeDnDHelper.replaceIndent(\n                                        _$scope,\n                                        _clone,\n                                        _node.__level__ - $params.offsetEdge,\n                                        'padding-left'\n                                    );\n\n                                    _frag.append(_clone);\n\n                                    // skip all, just clone parent\n                                    if (_needCollapse) {\n                                        _copied = true;\n                                    }\n\n                                    // hide if have status Move;\n                                    if (_$scope.enabledMove && _$scope.$class.hidden &&\n                                        (!_parent || _node.__visible__ || _parent.__visible__ && _parent.__expanded__)) {\n                                        _element.addClass(_$scope.$class.hidden);\n                                    }\n                                }\n                            }\n                            // skip children of node not expand.\n                            return _copied || _node.__visible__ === false || _node.__expanded__ === false;\n\n                        }, null, !_needCollapse\n                    );\n                    _tbody.append(_frag);\n                    $params.dragElm.append(_tbody);\n                } else {\n\n                    _clone = _element.clone();\n                    if (_needCollapse) {\n                        _clone[0].querySelector('[tree-dnd-nodes]').remove();\n                    }\n\n                    // hide if have status Move;\n                    $params.dragElm.append(_clone);\n                    if (_$scope.enabledMove && _$scope.$class.hidden) {\n                        _element.addClass(_$scope.$class.hidden);\n                    }\n                }\n\n                $params.dragElm.css(\n                    {\n                        'left': eventObj.pageX - $params.pos.offsetX + _$scope.$callbacks.calsIndent(\n                                $params.offsetEdge + 1,\n                                true,\n                                true\n                        ) + 'px',\n                        'top':  eventObj.pageY - $params.pos.offsetY + 'px'\n                    }\n                );\n                // moving item with descendant\n                $params.$document.find('body').append($params.dragElm);\n                if (_$scope.$callbacks.droppable()) {\n                    $params.placeElm = _$scope.initPlace(dragScope.$element, $params.dragElm);\n\n                    if (dragScope.isTable) {\n                        $TreeDnDHelper.replaceIndent(_$scope, $params.placeElm, $params.dragInfo.node.__level__);\n                    }\n\n                    $params.placeElm.css('width', _width);\n                }\n\n                _$scope.showPlace();\n                _$scope.targeting  = true;\n\n                if (_$scope.enabledStatus) {\n                    _$scope.refreshStatus();\n                    _$scope.setPositionStatus(e);\n                }\n\n                angular.element($params.$document).bind('touchend', $params.dragEndEvent);\n                angular.element($params.$document).bind('touchcancel', $params.dragEndEvent);\n                angular.element($params.$document).bind('touchmove', $params.dragMoveEvent);\n                angular.element($params.$document).bind('mouseup', $params.dragEndEvent);\n                angular.element($params.$document).bind('mousemove', $params.dragMoveEvent);\n                angular.element($params.$document).bind('mouseleave', $params.dragCancelEvent);\n\n                $params.document_height = Math.max(\n                    $params.body.scrollHeight,\n                    $params.body.offsetHeight,\n                    $params.html.clientHeight,\n                    $params.html.scrollHeight,\n                    $params.html.offsetHeight\n                );\n\n                $params.document_width = Math.max(\n                    $params.body.scrollWidth,\n                    $params.body.offsetWidth,\n                    $params.html.clientWidth,\n                    $params.html.scrollWidth,\n                    $params.html.offsetWidth\n                );\n            }\n\n            function _fnDragMove(e, $params) {\n                var _$scope = $params.$scope;\n                if (!$params.dragStarted) {\n                    if (!$params.dragDelaying) {\n                        $params.dragStarted = true;\n                        _$scope.$safeApply(\n                            function () {\n                                _$scope.$callbacks.dragStart($params.dragInfo);\n                            }\n                        );\n                    }\n                    return;\n                }\n\n                if ($params.dragElm) {\n                    e.preventDefault();\n                    if ($params.$window.getSelection) {\n                        $params.$window.getSelection().removeAllRanges();\n                    } else if ($params.$window.document.selection) {\n                        $params.$window.document.selection.empty();\n                    }\n\n                    var eventObj   = $TreeDnDHelper.eventObj(e),\n                        leftElmPos = eventObj.pageX - $params.pos.offsetX,\n                        topElmPos  = eventObj.pageY - $params.pos.offsetY;\n\n                    //dragElm can't leave the screen on the left\n                    if (leftElmPos < 0) {\n                        leftElmPos = 0;\n                    }\n\n                    //dragElm can't leave the screen on the top\n                    if (topElmPos < 0) {\n                        topElmPos = 0;\n                    }\n\n                    //dragElm can't leave the screen on the bottom\n                    if (topElmPos + 10 > $params.document_height) {\n                        topElmPos = $params.document_height - 10;\n                    }\n\n                    //dragElm can't leave the screen on the right\n                    if (leftElmPos + 10 > $params.document_width) {\n                        leftElmPos = $params.document_width - 10;\n                    }\n\n                    $params.dragElm.css(\n                        {\n                            'left': leftElmPos + _$scope.$callbacks.calsIndent(\n                                    $params.offsetEdge + 1,\n                                    true,\n                                    true\n                            ) + 'px',\n                            'top':  topElmPos + 'px'\n                        }\n                    );\n\n                    if (_$scope.enabledStatus) {\n                        _$scope.setPositionStatus(e);\n                    }\n\n                    var top_scroll    = window.pageYOffset || $params.$window.document.documentElement.scrollTop,\n                        bottom_scroll = top_scroll + (window.innerHeight || $params.$window.document.clientHeight || $params.$window.document.clientHeight);\n                    // to scroll down if cursor y-position is greater than the bottom position the vertical scroll\n                    if (bottom_scroll < eventObj.pageY && bottom_scroll <= $params.document_height) {\n                        window.scrollBy(0, 10);\n                    }\n                    // to scroll top if cursor y-position is less than the top position the vertical scroll\n                    if (top_scroll > eventObj.pageY) {\n                        window.scrollBy(0, -10);\n                    }\n\n                    $TreeDnDHelper.positionMoved(e, $params.pos, $params.firstMoving);\n\n                    if ($params.firstMoving) {\n                        $params.firstMoving = false;\n                        return;\n                    }\n                    // check if add it as a child node first\n\n                    var targetX    = eventObj.pageX - $params.$window.document.body.scrollLeft,\n                        targetY    = eventObj.pageY - (window.pageYOffset || $params.$window.document.documentElement.scrollTop),\n\n                        targetElm,\n                        targetScope,\n                        targetBefore,\n                        targetOffset,\n                        isChanged  = true,\n                        isVeritcal = true,\n                        isEmpty,\n                        isSwapped,\n                        _scope,\n                        _target,\n                        _parent,\n                        _info      = $params.dragInfo,\n                        _move      = _info.move,\n                        _drag      = _info.node,\n                        _drop      = _info.drop,\n                        treeScope  = _info.target,\n                        fnSwapTree,\n                        isHolder   = _fnPlaceHolder(e, $params);\n\n                    if (!isHolder) {\n                        /* when using elementFromPoint() inside an iframe, you have to call\n                         elementFromPoint() twice to make sure IE8 returns the correct value\n                         $params.$window.document.elementFromPoint(targetX, targetY);*/\n\n                        targetElm = angular.element(\n                            $params.$window.document.elementFromPoint(\n                                targetX,\n                                targetY\n                            )\n                        );\n\n                        targetScope = targetElm.scope();\n                        if (!targetScope || !targetScope.$callbacks || !targetScope.$callbacks.droppable()) {\n                            // Not allowed Drop Item\n                            return;\n                        }\n\n                        fnSwapTree = function () {\n                            treeScope = targetScope.getScopeTree();\n                            _target   = _info.target;\n\n                            if (_info.target !== treeScope) {\n                                // Replace by place-holder new\n                                _target.hidePlace();\n                                _target.targeting   = false;\n                                treeScope.targeting = true;\n\n                                _info.target     = treeScope;\n                                $params.placeElm = treeScope.initPlace(targetScope.$element, $params.dragElm);\n\n                                _target   = null;\n                                isSwapped = true;\n                            }\n                            return true;\n                        };\n\n                        if (angular.isFunction(targetScope.getScopeNode)) {\n                            targetScope = targetScope.getScopeNode();\n                            if (!fnSwapTree()) {\n                                return;\n                            }\n                        } else {\n                            if (targetScope.$type === 'TreeDnDNodes' || targetScope.$type === 'TreeDnD') {\n                                if (targetScope.tree_nodes) {\n                                    if (targetScope.tree_nodes.length === 0) {\n                                        if (!fnSwapTree()) {\n                                            return;\n                                        }\n                                        // Empty\n                                        isEmpty = true;\n                                    }\n                                } else {\n                                    return;\n                                }\n                            } else {\n                                return;\n                            }\n                        }\n                    }\n\n                    if ($params.pos.dirAx && !isSwapped || isHolder) {\n                        isVeritcal  = false;\n                        targetScope = _info.scope;\n                    }\n\n                    if (!targetScope.$element && !targetScope) {\n                        return;\n                    }\n\n                    if (isEmpty) {\n                        _move.parent = null;\n                        _move.pos    = 0;\n\n                        _drop = null;\n                    } else {\n                        // move vertical\n                        if (isVeritcal) {\n                            targetElm = targetScope.$element; // Get the element of tree-dnd-node\n                            if (angular.isUndefinedOrNull(targetElm)) {\n                                return;\n                            }\n                            targetOffset = $TreeDnDHelper.offset(targetElm);\n\n                            if (targetScope.horizontal && !targetScope.isTable) {\n                                targetBefore = eventObj.pageX < targetOffset.left + $TreeDnDHelper.width(targetElm) / 2;\n                            } else {\n                                if (targetScope.isTable) {\n                                    targetBefore = eventObj.pageY < targetOffset.top + $TreeDnDHelper.height(targetElm) / 2;\n                                } else {\n                                    var _height = $TreeDnDHelper.height(targetElm);\n\n                                    if (targetScope.getElementChilds()) {\n                                        _height -= -$TreeDnDHelper.height(targetScope.getElementChilds());\n                                    }\n\n                                    if (eventObj.pageY > targetOffset.top + _height) {\n                                        return;\n                                    }\n\n                                    targetBefore = eventObj.pageY < targetOffset.top + _height / 2;\n                                }\n                            }\n\n                            if (!angular.isFunction(targetScope.getData)) {\n                                return;\n                            }\n\n                            _target = targetScope.getData();\n                            _parent = targetScope.getNode(_target.__parent_real__);\n\n                            if (targetBefore) {\n                                var _prev = targetScope.getPrevSibling(_target);\n\n                                _move.parent = _parent;\n                                _move.pos    = angular.isDefined(_prev) ? _prev.__index__ + 1 : 0;\n\n                                _drop = _prev;\n                            } else {\n                                if (_target.__expanded__ && !(_target.__children__.length === 1 && _target.__index_real__ === _drag.__parent_real__)) {\n                                    _move.parent = _target;\n                                    _move.pos    = 0;\n\n                                    _drop = null;\n                                } else {\n                                    _move.parent = _parent;\n                                    _move.pos    = _target.__index__ + 1;\n\n                                    _drop = _target;\n                                }\n                            }\n                        } else {\n                            // move horizontal\n                            if ($params.pos.dirAx && $params.pos.distAxX >= treeScope.dragBorder) {\n                                $params.pos.distAxX = 0;\n                                // increase horizontal level if previous sibling exists and is not collapsed\n                                if ($params.pos.distX > 0) {\n                                    _parent = _drop;\n                                    if (!_parent) {\n                                        if (_move.pos - 1 >= 0) {\n                                            _parent = _move.parent.__children__[_move.pos - 1];\n                                        } else {\n                                            return;\n                                        }\n                                    }\n\n                                    if (_info.drag === _info.target && _parent === _drag && _$scope.enabledMove) {\n                                        _parent = treeScope.getPrevSibling(_parent);\n                                    }\n\n                                    if (_parent && _parent.__visible__) {\n                                        var _len = _parent.__children__.length;\n\n                                        _move.parent = _parent;\n                                        _move.pos    = _len;\n\n                                        if (_len > 0) {\n                                            _drop = _parent.__children__[_len - 1];\n                                        } else {\n                                            _drop = null;\n                                        }\n                                    } else {\n                                        // Not changed\n                                        return;\n                                    }\n                                } else if ($params.pos.distX < 0) {\n                                    _target = _move.parent;\n                                    if (_target &&\n                                        (_target.__children__.length === 0 ||\n                                         _target.__children__.length - 1 < _move.pos ||\n                                         _info.drag === _info.target &&\n                                         _target.__index_real__ === _drag.__parent_real__ &&\n                                         _target.__children__.length - 1 === _drag.__index__ && _$scope.enabledMove)\n                                    ) {\n                                        _parent = treeScope.getNode(_target.__parent_real__);\n\n                                        _move.parent = _parent;\n                                        _move.pos    = _target.__index__ + 1;\n\n                                        _drop = _target;\n                                    } else {\n                                        // Not changed\n                                        return;\n                                    }\n                                } else {\n                                    return;\n                                }\n                            } else {\n                                // limited\n                                return;\n                            }\n                        }\n                    }\n\n                    if (_info.drag === _info.target &&\n                        _move.parent &&\n                        _drag.__parent_real__ === _move.parent.__index_real__ &&\n                        _drag.__index__ === _move.pos\n                    ) {\n                        isChanged = false;\n                    }\n\n                    if (treeScope.$callbacks.accept(_info, _move, isChanged)) {\n                        _info.move    = _move;\n                        _info.drop    = _drop;\n                        _info.changed = isChanged;\n                        _info.scope   = targetScope;\n\n                        if (targetScope.isTable) {\n                            $TreeDnDHelper.replaceIndent(\n                                treeScope,\n                                $params.placeElm,\n                                angular.isUndefinedOrNull(_move.parent) ? 1 : _move.parent.__level__ + 1\n                            );\n\n                            if (_drop) {\n                                _parent = (_move.parent ? _move.parent.__children__ : null ) || _info.target.treeData;\n\n                                if (_drop.__index__ < _parent.length - 1) {\n                                    // Find fast\n                                    _drop  = _parent[_drop.__index__ + 1];\n                                    _scope = _info.target.getScope(_drop);\n                                    _scope.$element[0].parentNode.insertBefore(\n                                        $params.placeElm[0],\n                                        _scope.$element[0]\n                                    );\n                                } else {\n                                    _target = _info.target.getLastDescendant(_drop);\n                                    _scope  = _info.target.getScope(_target);\n                                    _scope.$element.after($params.placeElm);\n                                }\n                            } else {\n                                _scope = _info.target.getScope(_move.parent);\n                                if (_scope) {\n                                    if (_move.parent) {\n                                        _scope.$element.after($params.placeElm);\n\n                                    } else {\n                                        _scope.getElementChilds().prepend($params.placeElm);\n                                    }\n                                }\n                            }\n                        } else {\n                            _scope = _info.target.getScope(_drop || _move.parent);\n                            if (_drop) {\n                                _scope.$element.after($params.placeElm);\n                            } else {\n                                _scope.getElementChilds().prepend($params.placeElm);\n                            }\n                        }\n\n                        treeScope.showPlace();\n\n                        _$scope.$safeApply(\n                            function () {\n                                _$scope.$callbacks.dragMove(_info);\n                            }\n                        );\n                    }\n\n                }\n            }\n\n            function _fnDragEnd(e, $params) {\n                e.preventDefault();\n                if ($params.dragElm) {\n                    var _passed     = false,\n                        _$scope     = $params.$scope,\n                        _scope      = _$scope.getScope($params.dragInfo.node),\n                        _element    = _scope.$element;\n\n                    _$scope.$safeApply(\n                        function () {\n                            _passed = _$scope.$callbacks.beforeDrop($params.dragInfo);\n                        }\n                    );\n\n                    // rollback all\n                    if (_scope.isTable) {\n                        _$scope.for_all_descendants(\n                            $params.dragInfo.node, function (_node, _parent) {\n                                _scope   = _$scope.getScope(_node);\n                                _element = _scope && _scope.$element;\n                                if (_scope && _element && (!_parent && _node.__visible__ || _parent.__expanded__)) {\n                                    if (_$scope.$class.hidden) {\n                                        _element.removeClass(_$scope.$class.hidden);\n                                    }\n                                }\n                                return _node.__visible__ === false || _node.__expanded__ === false\n                            }, null, true\n                        );\n                    } else {\n                        if (_$scope.$class.hidden) {\n                            _element.removeClass(_$scope.$class.hidden);\n                        }\n                    }\n\n                    $params.dragElm.remove();\n                    $params.dragElm = null;\n\n                    if (_$scope.enabledStatus) {\n                        _$scope.hideStatus();\n                    }\n\n                    if (_$scope.$$apply) {\n                        _$scope.$safeApply(\n                            function () {\n                                var _status = _$scope.$callbacks.dropped(\n                                    $params.dragInfo,\n                                    _passed\n                                );\n\n                                _$scope.$callbacks.dragStop($params.dragInfo, _status);\n                                clearData();\n                            }\n                        );\n                    } else {\n                        _fnBindDrag($params);\n                        _$scope.$safeApply(\n                            function () {\n                                _$scope.$callbacks.dragStop($params.dragInfo, false);\n                                clearData();\n                            }\n                        );\n                    }\n\n                }\n\n                function clearData() {\n                    $params.dragInfo.target.hidePlace();\n                    $params.dragInfo.target.targeting = false;\n\n                    $params.dragInfo = null;\n                    _$scope.$$apply  = false;\n                    _$scope.setDragging(null);\n                }\n\n                angular.element($params.$document).unbind('touchend', $params.dragEndEvent); // Mobile\n                angular.element($params.$document).unbind('touchcancel', $params.dragEndEvent); // Mobile\n                angular.element($params.$document).unbind('touchmove', $params.dragMoveEvent); // Mobile\n                angular.element($params.$document).unbind('mouseup', $params.dragEndEvent);\n                angular.element($params.$document).unbind('mousemove', $params.dragMoveEvent);\n                angular.element($params.$window.document.body).unbind('mouseleave', $params.dragCancelEvent);\n            }\n\n            function _fnDragStartEvent(e, $params) {\n                if ($params.$scope.$callbacks.draggable()) {\n                    _fnDragStart(e, $params);\n                }\n            }\n\n            function _fnBindDrag($params) {\n                $params.element.bind(\n                    'touchstart mousedown', function (e) {\n                        $params.dragDelaying = true;\n                        $params.dragStarted  = false;\n                        _fnDragStartEvent(e, $params);\n                        $params.dragTimer    = $timeout(\n                            function () {\n                                $params.dragDelaying = false;\n                            }, $params.$scope.dragDelay\n                        );\n                    }\n                );\n\n                $params.element.bind(\n                    'touchend touchcancel mouseup', function () {\n                        $timeout.cancel($params.dragTimer);\n                    }\n                );\n            }\n\n            function _fnKeydownHandler(e, $params) {\n                var _$scope = $params.$scope;\n                if (e.keyCode === 27) {\n                    if (_$scope.enabledStatus) {\n                        _$scope.hideStatus();\n                    }\n\n                    _$scope.$$apply = false;\n                    _fnDragEnd(e, $params);\n                } else {\n                    if (_$scope.enabledHotkey && e.shiftKey) {\n                        _$scope.enableMove(true);\n                        if (_$scope.enabledStatus) {\n                            _$scope.refreshStatus();\n                        }\n\n                        if (!$params.dragInfo) {\n                            return;\n                        }\n\n                        var _scope   = _$scope.getScope($params.dragInfo.node),\n                            _element = _scope.$element;\n\n                        if (_scope.isTable) {\n                            _$scope.for_all_descendants(\n                                $params.dragInfo.node, function (_node, _parent) {\n                                    _scope   = _$scope.getScope(_node);\n                                    _element = _scope && _scope.$element;\n                                    if (_scope && _element && (!_parent && _node.__visible__ || _parent.__expanded__)) {\n                                        if (_$scope.$class.hidden) {\n                                            _element.addClass(_$scope.$class.hidden);\n                                        }\n                                    }\n                                    return _node.__visible__ === false || _node.__expanded__ === false\n\n                                }, null, true\n                            );\n                        } else {\n                            if (_$scope.$class.hidden) {\n                                _element.addClass(_$scope.$class.hidden);\n                            }\n                        }\n                    }\n                }\n            }\n\n            function _fnKeyupHandler(e, $params) {\n                var _$scope = $params.$scope;\n                if (_$scope.enabledHotkey && !e.shiftKey) {\n                    _$scope.enableMove(false);\n\n                    if (_$scope.enabledStatus) {\n                        _$scope.refreshStatus();\n                    }\n\n                    if (!$params.dragInfo) {\n                        return;\n                    }\n\n                    var _scope   = _$scope.getScope($params.dragInfo.node),\n                        _element = _scope.$element;\n\n                    if (_scope.isTable) {\n                        _$scope.for_all_descendants(\n                            $params.dragInfo.node, function (_node, _parent) {\n                                _scope   = _$scope.getScope(_node);\n                                _element = _scope && _scope.$element;\n                                if (_scope && _element && (!_parent && _node.__visible__ || _parent.__expanded__)) {\n                                    if (_$scope.$class.hidden) {\n                                        _element.removeClass(_$scope.$class.hidden);\n                                    }\n                                }\n                                return _node.__visible__ === false || _node.__expanded__ === false\n                            }, null, true\n                        );\n                    } else {\n                        if (_$scope.$class.hidden) {\n                            _element.removeClass(_$scope.$class.hidden);\n                        }\n                    }\n                }\n            }\n\n            function _$init(scope, element, $window, $document) {\n                var $params        = {\n                        hasTouch:        'ontouchstart' in window,\n                        firstMoving:     null,\n                        dragInfo:        null,\n                        pos:             null,\n                        placeElm:        null,\n                        dragElm:         null,\n                        dragDelaying:    true,\n                        dragStarted:     false,\n                        dragTimer:       null,\n                        body:            document.body,\n                        html:            document.documentElement,\n                        document_height: null,\n                        document_width:  null,\n                        offsetEdge:      null,\n                        $scope:          scope,\n                        $window:         $window,\n                        $document:       $document,\n                        element:         element,\n                        bindDrag:        function () {\n                            _fnBindDrag($params);\n                        },\n                        dragEnd:         function (e) {\n                            _fnDragEnd(e, $params);\n                        },\n                        dragMoveEvent:   function (e) {\n                            _fnDragMove(e, $params);\n                        },\n                        dragEndEvent:    function (e) {\n                            scope.$$apply = true;\n                            _fnDragEnd(e, $params);\n                        },\n                        dragCancelEvent: function (e) {\n                            _fnDragEnd(e, $params);\n                        }\n                    },\n                    keydownHandler = function (e) {\n                        return _fnKeydownHandler(e, $params);\n                    },\n                    keyupHandler   = function (e) {\n                        return _fnKeyupHandler(e, $params);\n                    };\n\n                scope.dragEnd = function (e) {\n                    $params.dragEnd(e);\n                };\n\n                $params.bindDrag();\n\n                angular.element($window.document.body).bind('keydown', keydownHandler);\n                angular.element($window.document.body).bind('keyup', keyupHandler);\n                //unbind handler that retains scope\n                scope.$on(\n                    '$destroy', function () {\n                        angular.element($window.document.body).unbind('keydown', keydownHandler);\n                        angular.element($window.document.body).unbind('keyup', keyupHandler);\n                        if (scope.statusElm) {\n                            scope.statusElm.remove();\n                        }\n\n                        if (scope.placeElm) {\n                            scope.placeElm.remove();\n                        }\n                    }\n                );\n            }\n\n            return _$init;\n        }\n    ]\n);\n\nangular.module('ntt.TreeDnD')\n    .factory(\n    '$TreeDnDControl', function () {\n        var _target, _parent,\n            i, len;\n\n        function fnSetCollapse(node) {\n            node.__expanded__ = false;\n        }\n\n        function fnSetExpand(node) {\n            node.__expanded__ = true;\n        }\n\n        function _$init(scope) {\n            var n, tree = {\n                selected_node:       null,\n                for_all_descendants: scope.for_all_descendants,\n                select_node:         function (node) {\n                    if (!node) {\n                        if (tree.selected_node) {\n                            delete tree.selected_node.__selected__;\n                        }\n                        tree.selected_node = null;\n                        return null;\n                    }\n\n                    if (node !== tree.selected_node) {\n                        if (tree.selected_node) {\n                            delete tree.selected_node.__selected__;\n                        }\n                        node.__selected__  = true;\n                        tree.selected_node = node;\n                        tree.expand_all_parents(node);\n                        if (angular.isFunction(tree.on_select)) {\n                            tree.on_select(node);\n                        }\n                    }\n                    return node;\n                },\n                deselect_node:       function () {\n                    _target = null;\n                    if (tree.selected_node) {\n                        delete tree.selected_node.__selected__;\n                        _target            = tree.selected_node;\n                        tree.selected_node = null;\n                    }\n                    return _target;\n                },\n                get_parent:          function (node) {\n                    if (node && node.__parent_real__ !== null) {\n                        return scope.tree_nodes[node.__parent_real__];\n                    }\n                    return null;\n                },\n                for_all_ancestors:   function (child, fn) {\n                    _parent = tree.get_parent(child);\n                    if (_parent) {\n                        if (fn(_parent)) {\n                            return false;\n                        }\n\n                        return tree.for_all_ancestors(_parent, fn);\n                    }\n                    return true;\n                },\n                expand_all_parents:  function (child) {\n                    child = child || tree.selected_node;\n                    if (typeof child === 'object') {\n                        tree.for_all_ancestors(\n                            child, fnSetExpand\n                        )\n                    }\n                },\n                collapse_all_parents:               function (child) {\n                    child = child || tree.selected_node;\n                    if (typeof child === 'object') {\n                        tree.for_all_ancestors(\n                            child, fnSetCollapse\n                        )\n                    }\n                },\n\n                reload_data:                       function () {\n                    return scope.reload_data();\n                },\n                add_node:                          function (parent, new_node, index) {\n                    if (typeof index !== 'number') {\n                        if (parent) {\n                            parent.__children__.push(new_node);\n                            parent.__expanded__ = true;\n                        } else {\n                            scope.treeData.push(new_node);\n                        }\n                    } else {\n                        if (parent) {\n                            parent.__children__.splice(index, 0, new_node);\n                            parent.__expanded__ = true;\n                        } else {\n                            scope.treeData.splice(index, 0, new_node);\n                        }\n                    }\n                    return new_node;\n                },\n                add_node_root:                     function (new_node) {\n                    tree.add_node(null, new_node);\n                    return new_node;\n                },\n                expand_all:                        function () {\n                    len = scope.treeData.length;\n                    for (i = 0; i < len; i++) {\n                        tree.for_all_descendants(\n                            scope.treeData[i], fnSetExpand\n                        );\n                    }\n                },\n                collapse_all:                      function () {\n                    len = scope.treeData.length;\n                    for (i = 0; i < len; i++) {\n                        tree.for_all_descendants(\n                            scope.treeData[i], fnSetCollapse\n                        );\n                    }\n                },\n                remove_node:                       function (node) {\n                    /*node = node || tree.selected_node;\n                    if (typeof node === 'object') {\n                        if (node.__parent_real__ !== null) {\n                            _parent = tree.get_parent(node).__children__;\n                        } else {\n                            _parent = scope.treeData;\n                        }\n\n                        _parent.splice(node.__index__, 1);\n\n                        tree.reload_data();\n\n                        if (tree.selected_node === node) {\n                            tree.selected_node = null;\n                        }\n                    }*/\n                    var lastElement = false;\n                    node = node || tree.selected_node;\n                    if (node) {\n                        if (node.__parent_real__ !== null) { //!=null\n                            _parent = tree.get_parent(node).__children__;\n                        } else {\n                            _parent = scope.treeData;\n                            if(scope.treeData.length === 1) {\n                                lastElement = true;\n                            }\n                        }\n\n                        _parent.splice(node.__index__, 1);\n                        if(lastElement) {\n                            //delete(scope.tree_nodes);\n                            scope.tree_nodes = [];\n                        }\n\n                        if (tree.selected_node === node) {\n                            tree.selected_node = null;\n                        }\n                    }\n                },\n                expand_node:                       function (node) {\n                    node = node || tree.selected_node;\n                    if (typeof node === 'object' && node.__expanded__) {\n                        node.__expanded__ = true;\n                        return node;\n                    }\n                },\n                collapse_node:                     function (node) {\n                    node = node || tree.selected_node;\n                    if (typeof node === 'object') {\n                        node.__expanded__ = false;\n                        return node;\n                    }\n                },\n                get_selected_node:                 function () {\n                    return tree.selected_node;\n                },\n                get_first_node:                    function () {\n                    len = scope.treeData.length;\n                    if (len > 0) {\n                        return scope.treeData[0];\n                    }\n                    return null;\n                },\n                get_children:                      function (node) {\n                    return node.__children__;\n                },\n                get_siblings:                      function (node) {\n                    node = node || tree.selected_node;\n                    if (typeof node === 'object') {\n                        _parent = tree.get_parent(node);\n                        if (_parent) {\n                            _target = _parent.__children__;\n                        } else {\n                            _target = scope.treeData;\n                        }\n                        return _target;\n                    }\n                },\n                get_next_sibling:                  function (node) {\n                    node = node || tree.selected_node;\n                    if (typeof node === 'object') {\n                        _target = tree.get_siblings(node);\n                        n       = _target.length;\n                        if (node.__index__ < n) {\n                            return _target[node.__index__ + 1];\n                        }\n                    }\n                },\n                get_prev_sibling:                  function (node) {\n                    node    = node || tree.selected_node;\n                    _target = tree.get_siblings(node);\n                    if (node.__index__ > 0) {\n                        return _target[node.__index__ - 1];\n                    }\n                },\n                get_first_child:                   function (node) {\n                    node = node || tree.selected_node;\n                    if (typeof node === 'object') {\n                        _target = node.__children__;\n                        if (_target && _target.length > 0) {\n                            return node.__children__[0];\n                        }\n                    }\n                    return null;\n                },\n                get_closest_ancestor_next_sibling: function (node) {\n                    node    = node || tree.selected_node;\n                    _target = tree.get_next_sibling(node);\n                    if (_target) {\n                        return _target;\n                    }\n\n                    _parent = tree.get_parent(node);\n                    return tree.get_closest_ancestor_next_sibling(_parent);\n                },\n                get_next_node:                     function (node) {\n                    node = node || tree.selected_node;\n\n                    if (typeof node === 'object') {\n                        _target = tree.get_first_child(node);\n                        if (_target) {\n                            return _target;\n                        } else {\n                            return tree.get_closest_ancestor_next_sibling(node);\n                        }\n                    }\n                },\n                get_prev_node:                     function (node) {\n                    node = node || tree.selected_node;\n\n                    if (typeof node === 'object') {\n                        _target = tree.get_prev_sibling(node);\n                        if (_target) {\n                            return tree.get_last_descendant(_target);\n                        }\n\n                        _parent = tree.get_parent(node);\n                        return _parent;\n                    }\n                },\n                get_last_descendant:               scope.getLastDescendant,\n                select_parent_node:                function (node) {\n                    node = node || tree.selected_node;\n\n                    if (typeof node === 'object') {\n                        _parent = tree.get_parent(node);\n                        if (_parent) {\n                            return tree.select_node(_parent);\n                        }\n                    }\n                },\n                select_first_node:                 function () {\n                    var firstNode = tree.get_first_node();\n                    return tree.select_node(firstNode);\n                },\n                select_next_sibling:               function (node) {\n                    node = node || tree.selected_node;\n\n                    if (typeof node === 'object') {\n                        _target = tree.get_next_sibling(node);\n                        if (_target) {\n                            return tree.select_node(_target);\n                        }\n                    }\n                },\n                select_prev_sibling:               function (node) {\n                    node = node || tree.selected_node;\n\n                    if (typeof node === 'object') {\n                        _target = tree.get_prev_sibling(node);\n                        if (_target) {\n                            return tree.select_node(_target);\n                        }\n                    }\n                },\n                select_next_node:                  function (node) {\n                    node = node || tree.selected_node;\n\n                    if (typeof node === 'object') {\n                        _target = tree.get_next_node(node);\n                        if (_target) {\n                            return tree.select_node(_target);\n                        }\n                    }\n                },\n                select_prev_node:                  function (node) {\n                    node = node || tree.selected_node;\n\n                    if (typeof node === 'object') {\n                        _target = tree.get_prev_node(node);\n                        if (_target) {\n                            return tree.select_node(_target);\n                        }\n                    }\n                }\n            };\n            angular.extend(scope.tree, tree);\n            return scope.tree;\n        }\n\n        return _$init;\n    }\n);\n\nangular.module('template/TreeDnD/TreeDnD.html', []).run(\n    [\n        '$templateCache', function ($templateCache) {\n        $templateCache.put(\n            'template/TreeDnD/TreeDnD.html',\n            ['<table ng-class=\"$tree_class\">',\n             '    <thead>',\n             '  <tr>',\n             '     <th ng-class=\"expandingProperty.titleClass\" ng-style=\"expandingProperty.titleStyle\">',\n             '         {{expandingProperty.displayName || expandingProperty.field || expandingProperty}}',\n             '        <\\/th>',\n             '        <th ng-repeat=\"col in colDefinitions\" ng-class=\"col.titleClass\" ng-style=\"col.titleStyle\">',\n             '         {{col.displayName || col.field}}',\n             '     </th>',\n             '    </tr>',\n             '    </thead>',\n             ' <tbody tree-dnd-nodes>',\n             '  <tr tree-dnd-node=\"node\" ng-repeat=\"node in tree_nodes track by node.__hashKey__\" ',\n             '       ng-if=\"(node.__inited__ || node.__visible__)\"',\n             '       ng-click=\"onSelect(node)\" ',\n             '       ng-class=\"(node.__selected__ ? \\' active\\':\\'\\')\">',\n             '        <td tree-dnd-node-handle',\n             '          ng-style=\"expandingProperty.cellStyle ? expandingProperty.cellStyle : {\\'padding-left\\': $callbacks.calsIndent(node.__level__)}\"',\n             '          ng-class=\"expandingProperty.cellClass\"',\n             '          compile=\"expandingProperty.cellTemplate\">',\n             '              <a data-nodrag>',\n             '                  <i ng-class=\"node.__icon_class__\" ng-click=\"toggleExpand(node)\"',\n             '                     class=\"tree-icon\"></i>',\n             '              </a>',\n             '             {{node[expandingProperty.field] || node[expandingProperty]}}',\n             '        </td>',\n             '        <td ng-repeat=\"col in colDefinitions\" ng-class=\"col.cellClass\" ng-style=\"col.cellStyle\"',\n             '            compile=\"col.cellTemplate\">',\n             '            {{node[col.field]}}',\n             '        </td>',\n             '    </tr>',\n             '    </tbody>',\n             '</table>'].join('\\n')\n        );\n\n        $templateCache.put(\n            'template/TreeDnD/TreeDnDStatusCopy.html',\n            '<label><i class=\"fa fa-copy\"></i>&nbsp;<b>Copying</b></label>'\n        );\n\n        $templateCache.put(\n            'template/TreeDnD/TreeDnDStatusMove.html',\n            '<label><i class=\"fa fa-file-text\"></i>&nbsp;<b>Moving</b></label>'\n        );\n    }]\n);\n\n    function isUndefinedOrNull(val) {\n        return angular.isUndefined(val) || val === null;\n    }\n\n    function isDefined(val) {\n        return !(angular.isUndefined(val) || val === null);\n    }\n})();"],"sourceRoot":"/source/"}