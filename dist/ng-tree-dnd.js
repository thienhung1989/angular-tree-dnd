/*! For license information please see ng-tree-dnd.js.LICENSE.txt */
angular.isUndefinedOrNull=function(e){return angular.isUndefined(e)||null===e},angular.isDefined=function(e){return!(angular.isUndefined(e)||null===e)},angular.module("ntt.TreeDnD",["template/TreeDnD/TreeDnD.html"]).constant("$TreeDnDClass",{tree:"tree-dnd",empty:"tree-dnd-empty",hidden:"tree-dnd-hidden",node:"tree-dnd-node",nodes:"tree-dnd-nodes",handle:"tree-dnd-handle",place:"tree-dnd-placeholder",drag:"tree-dnd-drag",status:"tree-dnd-status",icon:{1:"glyphicon glyphicon-minus",0:"glyphicon glyphicon-plus","-1":"glyphicon glyphicon-file"}}),angular.module("template/TreeDnD/TreeDnD.html",[]).run(["$templateCache",function(e){e.put("template/TreeDnD/TreeDnD.html",'<table ng-class="$tree_class">   <thead>       <tr>           <th ng-class="expandingProperty.titleClass" ng-style="expandingProperty.titleStyle">               {{expandingProperty.displayName || expandingProperty.field || expandingProperty}}           </th>           <th ng-repeat="col in colDefinitions" ng-class="col.titleClass" ng-style="col.titleStyle">               {{col.displayName || col.field}}           </th>       </tr>   </thead>   <tbody tree-dnd-nodes>       <tr tree-dnd-node="node" ng-repeat="node in tree_nodes track by node.__hashKey__"            ng-if="(node.__inited__ || node.__visible__)"           ng-click="onSelect(node)"            ng-class="(node.__selected__ ? \' active\':\'\')">           <td tree-dnd-node-handle               ng-style="expandingProperty.cellStyle ? expandingProperty.cellStyle : {\'padding-left\': $callbacks.calsIndent(node.__level__)}"               ng-class="expandingProperty.cellClass"               compile="expandingProperty.cellTemplate">               <a data-nodrag>                  <i ng-class="node.__icon_class__" ng-click="toggleExpand(node)" class="tree-icon"></i>               </a>               {{node[expandingProperty.field] || node[expandingProperty]}}           </td>           <td ng-repeat="col in colDefinitions" ng-class="col.cellClass" ng-style="col.cellStyle" compile="col.cellTemplate">               {{node[col.field]}}           </td>       </tr>   </tbody></table>'),e.put("template/TreeDnD/TreeDnDStatusCopy.html",'<label><i class="fa fa-copy"></i>&nbsp;<b>Copying</b></label>'),e.put("template/TreeDnD/TreeDnDStatusMove.html",'<label><i class="fa fa-file-text"></i>&nbsp;<b>Moving</b></label>')}]),angular.module("ntt.TreeDnD").controller("treeDndNodeController",["$scope",function(e){this.scope=e}]),angular.module("ntt.TreeDnD").controller("treeDndNodeHandleController",["$scope",function(e){this.scope=e}]),angular.module("ntt.TreeDnD").controller("treeDndNodesController",["$scope",function(e){this.scope=e}]),angular.module("ntt.TreeDnD").factory("$TreeDnDHelper",["$document","$window",function(e,n){var t={nodrag:function(e){return void 0!==e.attr("data-nodrag")},eventObj:function(e){var n=e;return void 0!==e.targetTouches?n=e.targetTouches.item(0):void 0!==e.originalEvent&&void 0!==e.originalEvent.targetTouches&&(n=e.originalEvent.targetTouches.item(0)),n},dragInfo:function(e){var n=e.getData(),t=e.getScopeTree(),r=e.getNode(n.__parent_real__);return{node:n,parent:r,move:{parent:r,pos:n.__index__},scope:e,target:t,drag:t,drop:e.getPrevSibling(n),changed:!1}},height:function(e){return e.prop("scrollHeight")},width:function(e){return e.prop("scrollWidth")},offset:function(t){var r=t[0].getBoundingClientRect();return{width:t.prop("offsetWidth"),height:t.prop("offsetHeight"),top:r.top+(n.pageYOffset||e[0].body.scrollTop||e[0].documentElement.scrollTop),left:r.left+(n.pageXOffset||e[0].body.scrollLeft||e[0].documentElement.scrollLeft)}},positionStarted:function(e,n){return{offsetX:e.pageX-this.offset(n).left,offsetY:e.pageY-this.offset(n).top,startX:e.pageX,lastX:e.pageX,startY:e.pageY,lastY:e.pageY,nowX:0,nowY:0,distX:0,distY:0,dirAx:0,dirX:0,dirY:0,lastDirX:0,lastDirY:0,distAxX:0,distAxY:0}},positionMoved:function(e,n,t){n.lastX=n.nowX,n.lastY=n.nowY,n.nowX=e.pageX,n.nowY=e.pageY,n.distX=n.nowX-n.lastX,n.distY=n.nowY-n.lastY,n.lastDirX=n.dirX,n.lastDirY=n.dirY,n.dirX=0===n.distX?0:n.distX>0?1:-1,n.dirY=0===n.distY?0:n.distY>0?1:-1;var r=Math.abs(n.distX)>Math.abs(n.distY)?1:0;return t?(n.dirAx=r,void(n.moving=!0)):(n.dirAx!==r?(n.distAxX=0,n.distAxY=0):(n.distAxX+=Math.abs(n.distX),0!==n.dirX&&n.dirX!==n.lastDirX&&(n.distAxX=0),n.distAxY+=Math.abs(n.distY),0!==n.dirY&&n.dirY!==n.lastDirY&&(n.distAxY=0)),n.dirAx=r,n)},replaceIndent:function(e,n,t,r){r=r||"left",angular.element(n.children()[0]).css(r,e.$callbacks.calsIndent(t))},isTreeDndNode:function(e){if(e){var n=angular.element(e);return n&&n.length&&void 0!==n.attr("tree-dnd-node")}return!1},isTreeDndNodes:function(e){if(e){var n=angular.element(e);return n&&n.length&&void 0!==n.attr("tree-dnd-nodes")}return!1},isTreeDndNodeHandle:function(e){if(e){var n=angular.element(e);return n&&n.length&&void 0!==n.attr("tree-dnd-node-handle")}return!1},isTreeDndDroppable:function(e){return t.isTreeDndNode(e)||t.isTreeDndNodes(e)||t.isTreeDndNodeHandle(e)},closestByAttr:function e(n,t){if(n&&t){var r=angular.element(n).parent();if(r)return("function"==typeof t?t(r):void 0!==r.attr(t))?r:e(r,t)}}};return t}]),angular.module("ntt.TreeDnD").factory("$TreeDnDConvert",(function(){return{line2tree:function(e,n,t,r){if(r="function"==typeof r?r:function(){},!e||0===e.length||!n||!t)return[];for(var a,l,o=[],i=[],d=e[0],s=d[n],c={},_=e.length,u=0;u<_;)r(d=e[u++]),c[s=d[n]]=d;for(u=0;u<_;)r(d=e[u++]),c[s=d[n]]=d,(a=d[t])?(l=c[a])&&(l.__children__?angular.isArray(l.__children__)?l.__children__.push(d):(console.error("Type of `parent.__children__` isn't array"),console.log(l.__children__)):l.__children__=[d]):i.push(s);for(_=i.length,u=0;u<_;u++)o.push(c[i[u]]);return o},tree2tree:function e(n,t,r){r="function"==typeof r?r:function(){};var a,l,o,i=[],d=n?n.length:0;for(a=0;a<d;a++)r(l=angular.copy(n[a])),angular.isArray(l[t])&&l[t].length>0&&(o=e(l[t],t,r),delete l[t],l.__children__=o),i.push(l);return i}}})),angular.module("ntt.TreeDnD").factory("$TreeDnDPlugin",["$injector",function(e){return function(n){if(angular.isDefined(e)&&e.has(n))return e.get(n)}}]),angular.module("ntt.TreeDnD").factory("$TreeDnDTemplate",["$templateCache",function(e){var n={};return{setMove:function(e,t){n[t.$id]||(n[t.$id]={}),n[t.$id].movePath=e},setCopy:function(e,t){n[t.$id]||(n[t.$id]={}),n[t.$id].copyPath=e},getPath:function(){return"template/TreeDnD/TreeDnD.html"},getCopy:function(t){if(n[t.$id]&&n[t.$id].copyPath){var r=e.get(n[t.$id].copyPath);if(r)return r}return e.get("template/TreeDnD/TreeDnDStatusCopy.html")},getMove:function(t){if(n[t.$id]&&n[t.$id].movePath){var r=e.get(n[t.$id].movePath);if(r)return r}return e.get("template/TreeDnD/TreeDnDStatusMove.html")}}}]),function(){function e(e,n,t,r,a){var l,o,i,d=!1,s=!1,c=!1,_=[],u={setViewport:function(e){l=e},getViewport:function(){return l},add:function(e,n){h(),_.push({element:n,scope:e})},setTemplate:function(e,n){},getItems:function(){return _},updateDelayed:h},f=angular.element(e);return f.on("load resize scroll",h),u;function g(){f.prop("offsetWidth")||document.documentElement.clientWidth,f.prop("offsetHeight")||document.documentElement.clientHeight,n[0].body.scrollTop||n[0].documentElement.scrollTop,n[0].body.scrollLeft||n[0].documentElement.scrollLeft,d||s?c=!0:(d=!0,p())}function p(){if(!s){var e=e>0?e:_.length;e>0?(_[0],s=!0,i=t((function(){_.splice(0,1),s=!1,e--,t.cancel(i),p()}),0)):(d=!1,c&&(c=!1,g()))}}function h(){t.cancel(o),o=t((function(){g()}),0)}}angular.module("ntt.TreeDnD").factory("$TreeDnDViewport",e),e.$inject=["$window","$document","$timeout","$q","$compile"]}(),angular.module("ntt.TreeDnD").factory("$TreeDnDFilter",["$filter",function(e){return function(e,t,r,d){if(!angular.isArray(e)||0===e.length)return e;var s,c,_;if(_=i(t),!angular.isArray(_)&&"object"!=typeof _||0===_.length){for(s=0,c=e.length;s<c;s++)n(r,e[s],d||"__children__",o,a);return e}for(r.filter=_,r.filter_index=0,s=0,c=e.length;s<c;s++)n(r,e[s],d||"__children__",l,a);return e};function n(e,t,r,a,l,o){if(angular.isFunction(a)){var i,d,s,c=a(e,t),_=!1,u=e.filter_index;if(angular.isDefined(t[r])){for(d=(s=t[r]).length,e.filter_index=0,i=0;i<d;i++)_=n(e,s[i],r,a,l,c||o)||_;e.filter_index=u}return angular.isFunction(l)&&l(e,t,!0===c,!0===_,!0===o),c||_}}function t(n,t){if(!angular.isUndefinedOrNull(t)&&!angular.isArray(t)){if(angular.isFunction(n))return n(t,e);if("boolean"==typeof n)return(t=!!t)===n;if(angular.isDefined(n))try{return new RegExp(n).test(t)}catch(e){if("string"==typeof t)return t.indexOf(n)>-1}}}function r(e,n,a){if(angular.isArray(n))return function(e,n,t){var a,l=n.length||0,o=!1;if(0!==l){for(a=0;a<l;a++)if(r(e,n[a],!t)){if(o=!0,!t)return!0}else if(t)return!1;return o}}(e,n,a);var l,o,i,d=n.field,s=n.callback;if("_$"===d){for(i=(o=Object.keys(e)).length,l=0;l<i;l++)if(t(s,e[o[l]]))return!0}else if(angular.isDefined(e[d]))return t(s,e[d])}function a(e,n,t,r,a){return!0===t?(n.__filtered__=!0,n.__filtered_visible__=!0,void(n.__filtered_index__=e.filter_index++)):!0===r&&!0===e.showParent||!0===a&&!0===e.showChild?(n.__filtered__=!1,n.__filtered_visible__=!0,void(n.__filtered_index__=e.filter_index++)):(delete n.__filtered__,delete n.__filtered_visible__,void delete n.__filtered_index__)}function l(e,n){return 0===e.filter.length||r(n,e.filter,e.beginAnd||!1)}function o(e,n){return!1}function i(e){var n,t,r,a,l;if("object"!=typeof e||angular.isArray(e))return e;if(a=[],(t=(r=Object.keys(e)).length)>0)for(n=0;n<t;n++)"string"==typeof e[r[n]]&&0===e[r[n]].length||(l=angular.isArray(e[r[n]])?e[r[n]]:"object"==typeof e[r[n]]?i(e[r[n]]):{field:r[n],callback:e[r[n]]},a.push(l));return a}}]),angular.module("ntt.TreeDnD").factory("$TreeDnDOrderBy",["$filter",function(e){var n=e("orderBy"),t=function e(n,t,r,a){var l,o,i;if(angular.isDefined(t[r])){for(o=(i=t[r]).length,l=0;l<o;l++)i[l]=e(n,i[l],r,a);t[r]=a(t[r],n)}return t},r=function(e,t){return n(e,t)};return function(e,n){if(!angular.isArray(e)||0===e.length||!(angular.isArray(n)||"object"==typeof n||angular.isString(n)||angular.isFunction(n))||0===n.length&&!angular.isFunction(n))return e;var a,l;for(a=0,l=e.length;a<l;a++)e[a]=t(n,e[a],"__children__",r);return r(e,n)}}]),angular.module("ntt.TreeDnD").directive("compile",["$compile",function(e){return{restrict:"A",link:function(n,t,r){n.$watch(r.compile,(function(r){r&&(angular.isFunction(t.empty)?t.empty():t.html(""),t.append(e(r)(n)))}))}}}]).directive("compileReplace",["$compile",function(e){return{restrict:"A",link:function(n,t,r){n.$watch(r.compileReplace,(function(r){r&&t.replaceWith(e(r)(n))}))}}}]),angular.module("ntt.TreeDnD").directive("treeDndNode",["$TreeDnDViewport",function(e){return{restrict:"A",replace:!0,controller:"treeDndNodeController",link:function(n,t,r){n.$node_class="",n.$class.node&&(t.addClass(n.$class.node),n.$node_class=n.$class.node);var a,l="boolean"==typeof n.dragEnabled||"boolean"==typeof n.dropEnabled,o=r.treeDndNode;e.add(n,t),l&&(n.$type="TreeDnDNode",n.getData=function(){return n[o]}),n.$element=t,n[o].__inited__=!0,n.getElementChilds=function(){return angular.element(t[0].querySelector("[tree-dnd-nodes]"))},n.setScope(n,n[o]),n.getScopeNode=function(){return n};var i,d,s=[],c=Object.keys(n[o]),_=c.length,u=n[o].__hashKey__,f=["__visible__","__children__","__level__","__index__","__index_real__","__parent__","__parent_real__","__dept__","__icon__","__icon_class__"],g=["__expanded__"],p=g.length;for(d=0;d<_+p;d++)d<_?-1===f.indexOf(c[d])&&s.push(o+"."+c[d]):-1===c.indexOf(g[d-_])&&s.push(o+"."+g[d-_]);i="["+s.join(",")+"]",n.$watch(i,(function(e,n,t){var r=t[o];if("object"==typeof r){r.__inited__||(r.__inited__=!0),r.__hashKey__!==u&&(t.deleteScope(t,r),t.setScope(t,r),u=r.__hashKey__);var l,i,d=r.__children__,s=d.length;for(i=0===s?-1:r.__expanded__?1:0,r.__icon__=i,r.__icon_class__=t.$class.icon[i],t.isTable||(a||(a=t.getElementChilds()),r.__expanded__?a.removeClass(t.$class.hidden):a.addClass(t.$class.hidden)),l=0;l<s;l++)t.for_all_descendants(d[l],t.hiddenChild,r,!0)}}),!0),n.$on("$destroy",(function(){n.deleteScope(n,n[o])}))}}}]),angular.module("ntt.TreeDnD").directive("treeDndNodeHandle",(function(){return{restrict:"A",scope:!0,controller:"treeDndNodeHandleController",link:function(e,n){e.$type="TreeDnDNodeHandle",e.$class.handle&&n.addClass(e.$class.handle)}}})),angular.module("ntt.TreeDnD").directive("treeDndNodes",(function(){return{restrict:"A",replace:!0,controller:"treeDndNodesController",link:function(e,n){e.$type="TreeDnDNodes",e.$class.nodes?(n.addClass(e.$class.nodes),e.$nodes_class=e.$class.nodes):e.$nodes_class=""}}})),function(){function e(e,n,t,r,a,l,o,i,d,s,c,_){return{restrict:"E",scope:!0,replace:!0,controller:["$scope","$element","$attrs",function(n,t,r){n.indent=20,n.indent_plus=15,n.indent_unit="px",n.$tree_class="table",n.primary_key="__uid__",n.$type="TreeDnD",n.colDefinitions=[],n.$globals={},n.$class=angular.copy(d),angular.extend(n.$class.icon,{1:r.iconExpand||"glyphicon glyphicon-minus",0:r.iconCollapse||"glyphicon glyphicon-plus","-1":r.iconLeaf||"glyphicon glyphicon-file"}),n.treeData=[],n.tree_nodes=[],n.for_all_descendants=function(e,t,r,a){if(angular.isFunction(t)){var l,o,i;if(t(e,r))return!1;if("object"!=typeof e)return!1;for(o=(i=e.__children__)?i.length:0,l=0;l<o;l++)if(!n.for_all_descendants(i[l],t,e)&&!a)return!1}return!0},n.getLastDescendant=function(e){var t,r;if(e||"object"!=typeof n.tree||(e=n.tree.selected_node),"object"==typeof e&&angular.isArray(e.__children__))return 0===(r=e.__children__.length)?e:(t=e.__children__[r-1],n.getLastDescendant(t))},n.getElementChilds=function(){return angular.element(t[0].querySelector("[tree-dnd-nodes]"))},n.onClick=function(e){angular.isDefined(n.tree)&&angular.isFunction(n.tree.on_click)&&setTimeout((function(){n.tree.on_click(e)}),0)},n.onSelect=function(e){angular.isDefined(n.tree)&&(e!==n.tree.selected_node&&n.tree.select_node(e),angular.isFunction(n.tree.on_select)&&setTimeout((function(){n.tree.on_select(e)}),0))},n.toggleExpand=function(e,t){var r;"object"==typeof e&&(angular.isFunction(t)?r=!!t(e):"object"==typeof n.$callbacks&&angular.isFunction(n.$callbacks.expand)&&(r=!!n.$callbacks.expand(e)),e.__children__.length>0&&(e.__expanded__=void 0!==r?r:!e.__expanded__))};var _=function(e){return"#"+e.__parent__+"#"+e[n.primary_key]};n.getHash=_,n.$callbacks={getHash:_,setHash:function(e){var n=_(e);return(angular.isUndefinedOrNull(e.__hashKey__)||e.__hashKey__!==n)&&(e.__hashKey__=n),e},for_all_descendants:n.for_all_descendants,accept:function(){return!0===n.dropEnabled},calsIndent:function(e,t,r){var a=0,l=r?0:n.indent_plus;return t||(a=n.indent_unit?n.indent_unit:"px"),e-1<1?l+a:n.indent*(e-1)+l+a},droppable:function(){return!0===n.dropEnabled},draggable:function(){return!0===n.dragEnabled},beforeDrop:function(){return!0},changeKey:function(e){var t=e.__uid__;e.__uid__=Math.random(),e.__selected__&&delete e.__selected__,"__uid__"!==n.primary_key&&(t=(t=""+e[n.primary_key]).replace(/_#.+$/g,"")+"_#"+e.__uid__,e[n.primary_key]=t)},clone:function(e){var n=angular.copy(e);return this.for_all_descendants(n,this.changeKey),n},remove:function(e,t,r,a){var l=t.splice(e.__index__,1)[0];return a||n.reload_data(),l},clearInfo:function(e){delete e.__inited__,delete e.__visible__},add:function(e,n,t){this.for_all_descendants(e,this.clearInfo),t&&(t.length>-1&&n>-1?t.splice(n,0,e):t.push(e))}},n.deleteScope=function(e,t){var r=t.__hashKey__;n.$globals[r]&&n.$globals[r]===e&&delete n.$globals[r]},n.setScope=function(e,t){var r=t.__hashKey__;n.$globals[r]!==e&&(n.$globals[r]=e)},n.getScope=function(e){if(e){var t=e.__hashKey__;return n.$globals[t]}return n},(r.enableDrag||r.enableDrop)&&(n.placeElm=void 0,n.dragEnabled=void 0,n.dropEnabled=void 0,n.horizontal=void 0,r.enableDrag&&(n.dragDelay=0,n.enabledMove=!0,n.statusMove=!0,n.enabledHotkey=!1,n.enabledCollapse=void 0,n.statusElm=void 0,n.dragging=void 0,angular.extend(n.$callbacks,{beforeDrag:function(){return!0},dragStop:function(e,n){e&&(e.changed||!e.drag.enabledMove)&&n&&(e.target.reload_data(),e.target!==e.drag&&e.drag.enabledMove&&e.drag.reload_data())},dropped:function(e){if(e){var n,t,r=e.node,a=e.move,l=e.parent||e.drag.treeData,o=a.parent||e.target.treeData,i=e.drag.enabledMove;return!(!e.changed&&i||!e.target.$callbacks.accept(e,e.move,e.changed)||(i?(t=l,angular.isDefined(t.__children__)&&(t=t.__children__),n=e.drag.$callbacks.remove(r,t,e.drag.$callbacks,!0)):n=e.drag.$callbacks.clone(r,e.drag.$callbacks),i&&e.drag===e.target&&l===o&&a.pos>=e.node.__index__&&a.pos--,(t=o).__children__&&(t=t.__children__),e.target.$callbacks.add(n,a.pos,t,e.drag.$callbacks),0))}},dragStart:function(e){},dragMove:function(e){}}),n.setDragging=function(e){n.dragging=e},n.enableMove=function(e){n.enabledMove="boolean"!=typeof e||e},r.enableStatus&&(n.enabledStatus=!1,n.hideStatus=function(){n.statusElm&&n.statusElm.addClass(n.$class.hidden)},n.refreshStatus=function(){if(n.dragging&&n.enabledStatus){var e=n.statusElm;n.enabledMove?n.statusElm=angular.element(i.getMove(n)):n.statusElm=angular.element(i.getCopy(n)),e!==n.statusElm&&(e&&(n.statusElm.attr("class",e.attr("class")),n.statusElm.attr("style",e.attr("style")),e.remove()),l.find("body").append(n.statusElm)),n.statusElm.removeClass(n.$class.hidden)}},n.setPositionStatus=function(e){n.statusElm&&(n.statusElm.css({left:e.pageX+10+"px",top:e.pageY+15+"px","z-index":9999}),n.statusElm.addClass(n.$class.status))})),n.targeting=!1,n.getPrevSibling=function(e){if(e&&e.__index__>0){var t=e.__index__-1;return angular.isDefined(e.__parent_real__)?n.tree_nodes[e.__parent_real__].__children__[t]:n.treeData[t]}},n.getNode=function(e){if(!angular.isUndefinedOrNull(e))return n.tree_nodes[e]},n.initPlace=function(e,t){if(!n.placeElm)if(n.isTable){n.placeElm=angular.element(a.document.createElement("tr"));var r=n.colDefinitions.length;for(n.placeElm.append(angular.element(a.document.createElement("td")).addClass(n.$class.empty).addClass("indented").addClass(n.$class.place));r-- >0;)n.placeElm.append(angular.element(a.document.createElement("td")).addClass(n.$class.empty).addClass(n.$class.place))}else n.placeElm=angular.element(a.document.createElement("li")).addClass(n.$class.empty).addClass(n.$class.place);return t&&n.placeElm.css("height",s.height(t)+"px"),e?e[0].parentNode.insertBefore(n.placeElm[0],e[0]):n.getElementChilds().append(n.placeElm),n.placeElm},n.hidePlace=function(){n.placeElm&&n.placeElm.addClass(n.$class.hidden)},n.showPlace=function(){n.placeElm&&n.placeElm.removeClass(n.$class.hidden)},n.getScopeTree=function(){return n}),n.$safeApply=function(e){var n=this.$root.$$phase;"$apply"===n||"$digest"===n?e&&"function"==typeof e&&e():this.$apply(e)},n.hiddenChild=function(e,t){var r=n.getScope(e);return r?t&&t.__expanded__&&t.__visible__?(r.$element.removeClass(n.$class.hidden),e.__visible__=!0):(r.$element.addClass(n.$class.hidden),e.__visible__=!1):e.__visible__=!!(t&&t.__expanded__&&t.__visible__),!1===e.__expanded__};var u,f,g,p,h,m,v,b,y,$={showParent:!0,showChild:!1,beginAnd:!0},D=[["enableDrag",[["boolean","enableStatus",void 0,"enabledStatus"],["boolean","enableMove",void 0,"enabledMove"],["number","dragDelay",0,void 0,0],["boolean","enableCollapse",void 0,"enabledCollapse"],["boolean","enableHotkey",void 0,"enabledHotkey",void 0,function(e){n.enabledMove=!e&&n.statusMove}]]],[["enableDrag","enableStatus"],[["string","templateCopy",r.templateCopy,"templateCopy",void 0,function(e){e&&o.get(e)&&i.setCopy(e,n)}],["string","templateMove",r.templateMove,"templateMove",void 0,function(e){e&&o.get(e)&&i.setMove(e,n)}]]],[[["enableDrag","enableDrop"]],[["number","dragBorder",30,"dragBorder",30]]],["*",[["boolean","treeTable",!0,"treeTable",void 0],["boolean","horizontal"],["callback","treeClass",function(e){switch(typeof e){case"string":n.$tree_class=e;break;case"object":angular.extend(n.$class,e),n.$tree_class=n.$class.tree;break;default:n.$tree_class=r.treeClass}},"treeClass",function(){n.$tree_class=n.$class.tree+" table"},void 0,function(){if(/^(\s+[\w\-]+){2,}$/g.test(" "+r.treeClass))return n.$tree_class=r.treeClass.trim(),!0}],[["object","string"],"expandOn",C,"expandingProperty",C,function(e){angular.isUndefinedOrNull(e)&&(n.expandingProperty=r.expandOn)}],["object","treeControl",angular.isDefined(n.tree)?n.tree:{},"tree",void 0,function(e){angular.isFunction(g)||(g=c("$TreeDnDControl")),angular.isFunction(g)&&angular.extend(n.tree,g(n),e)}],[["array","object"],"columnDefs",S,"colDefinitions",S,function(e){!angular.isUndefinedOrNull(e)&&angular.isArray(e)||(n.colDefinitions=S())}],[["object","string","array","function"],"orderBy",r.orderBy],[["object","array"],"filter",void 0,"filter",void 0,function(e){var t=!1;if(angular.isDefined(e)&&!angular.isArray(e)){var r,a=Object.keys(e),l=a.length;if(l>0)for(r=0;r<l;r++)if("string"!=typeof e[a[r]]||0!==e[a[r]].length){t=!0;break}}n.enabledFilter=t,N()}],["object","filterOptions",$,"filterOptions",$,function(e){"object"==typeof e&&(n.filterOptions=angular.extend($,e))}],["string","primaryKey",r.primaryKey,"primary_key","__uid__"],["string","indentUnit",r.indentUnit,"indent_unit"],["number","indent",30,"indent",30],["number","indentPlus",20,"indent_plus",20],["object","callbacks",function(e){return angular.forEach(e,(function(e,t){"function"==typeof e&&n.$callbacks[t]&&(n.$callbacks[t]=e)})),n.$callbacks},"$callbacks"],["number","expandLevel",3,"expandLevel",3,function(){N()}],["number","treeLimit",100,"$TreeLimit",100],["boolean","enableDrag",void 0,"dragEnabled"],["boolean","enableDrop",void 0,"dropEnabled"]]]],x=D.length;for(p=0;p<x;p++)if(T(r,D[p][0],!0))for(h=0,m=(v=D[p][1]).length;h<m;h++)w(v[h][0],v[h][1],v[h][2],v[h][3],v[h][4],v[h][5],v[h][6]);function E(){n.treeData=y,N(),b=void 0}function T(e,n,t){return!angular.isUndefinedOrNull(n)&&("*"===n||!angular.isUndefined(e[n])||(angular.isArray(n)?function(e,n,t){var r,a=n.length,l=!1;if(0!==a){for(r=0;r<a;r++)if(T(e,n[r],!t)){if(l=!0,!t)return!0}else if(t)return!1;return l}}(e,n,t):void 0))}function w(e,t,a,l,o,i,d){if(l=l||t,"string"==typeof e||angular.isArray(e)){if(angular.isFunction(d)&&d())return;"string"==typeof r[t]?n.$watch(r[t],(function(t){"string"==typeof e&&typeof t===e||angular.isArray(e)&&e.indexOf(typeof t)>-1?n[l]=t:angular.isFunction(a)?n[l]=a(t):n[l]=a,angular.isFunction(i)&&i(n[l],n)}),!0):angular.isFunction(o)?n[l]=o():angular.isUndefined(o)||(n[l]=o)}}function C(){if(n.treeData&&n.treeData.length){var e,t,r=n.treeData[0],a=Object.keys(r),l=new RegExp("^__([a-zA-Z0-9_-]*)__$");for(t=0,e=a.length;t<e;t++)if("string"==typeof r[a[t]]&&!l.test(a[t]))return void(n.expandingProperty=a[t]);angular.isUndefinedOrNull(n.expandingProperty)&&(n.expandingProperty=a[0])}}function S(){if(n.treeData.length){var e,t,r=[],a=n.treeData[0],l=new RegExp("(^__([a-zA-Z0-9_-]*)__$|^"+n.expandingProperty+"$)"),o=Object.keys(a);for(e=0,t=o.length;e<t;e++)"string"!=typeof a[o[e]]||l.test(o[e])||r.push({field:o[e]});n.colDefinitions=r}}function k(e,t,r,a,l,o,i){if("object"!=typeof t)return 0;var d,s,c,_,u,f;if(angular.isArray(t.__children__)||(t.__children__=[]),t.__parent_real__=a,t.__parent__=r,s=t.__children__.length,angular.isUndefinedOrNull(t.__expanded__)&&s>0&&(t.__expanded__=l<n.expandLevel),c=0===s?-1:t.__expanded__?1:0,_=e.length,t.__index__=i,t.__index_real__=_,t.__level__=l,t.__icon__=c,t.__icon_class__=n.$class.icon[c],t.__visible__=!!o,angular.isUndefinedOrNull(t.__uid__)&&(t.__uid__=""+Math.random()),f=n.getHash(t),(angular.isUndefinedOrNull(t.__hashKey__)||t.__hashKey__!==f)&&(t.__hashKey__=f),e.push(t),u=1,s>0)for(d=0;d<s;d++)u+=k(e,t.__children__[d],t[n.primary_key],_,l+1,o&&t.__expanded__,d);return t.__dept__=u,u}function j(e){return angular.isDefined(n.tree_nodes)&&delete n.tree_nodes,n.tree_nodes=e,e}function N(e){var t,a,l,o=[];if(angular.isDefined(e)){if(!angular.isArray(e)||0===e.length)return j([]);t=e}else{if(!angular.isArray(n.treeData)||0===n.treeData.length)return j([]);t=n.treeData}if(r.expandOn||C(),r.columnDefs||S(),angular.isDefined(n.orderBy)&&(angular.isFunction(f)||(f=c("$TreeDnDOrderBy")),angular.isFunction(f)&&(t=f(t,n.orderBy))),angular.isDefined(n.filter)&&(angular.isFunction(u)||(u=c("$TreeDnDFilter")),angular.isFunction(u)&&(t=u(t,n.filter,n.filterOptions))),(a=t.length)>0)for(l=0;l<a;l++)k(o,t[l],void 0,void 0,1,!0,l);return j(o),o}r.treeData&&n.$watch(r.treeData,(function(t){angular.equals(t,n.treeData)||(y=t,angular.isUndefinedOrNull(b)&&(b=e(E,350)))}),!0),n.updateLimit=function(){n.$TreeLimit+=50},n.reload_data=N}],compile:function(e){var d="",s=e.html().trim();return s.length>0&&(d=s,e.html("")),function(e,s,u){if("object"==typeof u&&u.enableDrag){var f=c("$TreeDnDDrag");angular.isFunction(f)&&f(e,s,a,l)}s.ready((function(){function a(e,t){var a,l=e[0].querySelector("[tree-dnd-node]");if(t.isTable=void 0,l){if(a=(l=angular.element(l)).attr("ng-include")){var i=r(a)(t)||a;if("string"==typeof i)return n.get(i,{cache:o}).then((function(e){var n=e.data||"";n=n.trim();var r=document.createElement("div");r.innerHTML=n,r=angular.element(r),t.isTable=!r[0].querySelector("[tree-dnd-nodes]")}))}else t.isTable=!l[0].querySelector("[tree-dnd-nodes]");_.setTemplate(t,t.templateNode)}}var l;d.length>0?"object"==typeof(l=a(angular.element(d.trim()),e))?l.then((function(){s.append(t(d)(e))})):s.append(t(d)(e)):n.get(u.templateUrl||i.getPath(),{cache:o}).then((function(n){var r=n.data||"";r=angular.element(r.trim()),"object"==typeof(l=a(r,e))?l.then((function(){s.append(t(r)(e))})):s.append(t(r)(e))}))}))}}}}angular.module("ntt.TreeDnD").directive("treeDnd",e),e.$inject=["$timeout","$http","$compile","$parse","$window","$document","$templateCache","$TreeDnDTemplate","$TreeDnDClass","$TreeDnDHelper","$TreeDnDPlugin","$TreeDnDViewport"]}(),angular.module("ntt.TreeDnD").factory("$TreeDnDControl",(function(){function e(e){e.__expanded__=!1}function n(e){e.__expanded__=!0}return function(t){return{selected_node:void 0,on_select:void 0,for_all_descendants:t.for_all_descendants,select_node:function(e){var n=t.tree,r=n.deselect_node();return"object"==typeof e&&e!==r&&(e.__selected__=!0,n.selected_node=e,n.expand_all_parents(e),"function"==typeof n.on_select&&n.on_select(e)),e},deselect_node:function(){var e,n=t.tree;return"object"==typeof n.selected_node&&(n.selected_node.__selected__=void 0,delete n.selected_node.__selected__,e=n.selected_node,n.selected_node=void 0),e},get_parent:function(e){var n=t.tree;if((e=e||n.selected_node)&&void 0!==e.__parent_real__)return t.tree_nodes[e.__parent_real__]},for_all_ancestors:function(e,n){var r=t.tree,a=r.get_parent(e);return!a||!n(a)&&r.for_all_ancestors(a,n)},expand_all_parents:function(e){var r=t.tree;"object"==typeof(e=e||r.selected_node)&&r.for_all_ancestors(e,n)},collapse_all_parents:function(n){var r=t.tree;"object"==typeof(n=n||r.selected_node)&&r.for_all_ancestors(n,e)},reload_data:function(){return t.reload_data()},add_node:function(e,n,r,a){return"object"==typeof e?("object"!=typeof e.__children__&&(e.__children__=[]),r>=0?e.__children__.splice(r,0,n):e.__children__.push(n),a&&(e.__expanded__=!0)):r>=0?t.treeData.splice(r,0,n):t.treeData.push(n),n},add_node_root:function(e){return"object"==typeof e&&t.tree.add_node(void 0,e),e},expand_all:function(){for(var e=t.tree,r=t.treeData.length,a=0;a<r;a++)e.for_all_descendants(t.treeData[a],n)},collapse_all:function(){for(var n=t.tree,r=t.treeData.length,a=0;a<r;a++)n.for_all_descendants(t.treeData[a],e)},remove_node:function(e){var n=t.tree;"object"==typeof(e=e||n.selected_node)&&((void 0!==e.__parent_real__?n.get_parent(e).__children__:t.treeData).splice(e.__index__,1),n.reload_data(),n.selected_node===e&&(n.selected_node=void 0))},expand_node:function(e){var n=t.tree;if("object"==typeof(e=e||n.selected_node))return e.__expanded__=!0,e},collapse_node:function(e){var n=t.tree;if("object"==typeof(e=e||n.selected_node))return e.__expanded__=!1,e},get_selected_node:function(){return t.tree.selected_node},get_first_node:function(){var e=t.tree.selected_node;if(void 0===e&&(e=t.treeData),"object"==typeof e&&e.length>0)return e[0]},get_children:function(e){var n=t.tree;return void 0===e&&void 0===n.selected_node?n.treeData:"object"==typeof(e=e||n.selected_node)&&void 0!==e.__children__?e.__children__:void 0},get_siblings:function(e){var n=t.tree;if("object"==typeof(e=e||n.selected_node)){var r=n.get_parent(e);return r?r.__children__:t.treeData}},get_next_sibling:function(e){var n=t.tree;if("object"==typeof(e=e||n.selected_node)){var r=n.get_siblings(e),a=r.length;if(e.__index__<a)return r[e.__index__+1]}},get_prev_sibling:function(e){var n=t.tree;e=e||n.selected_node;var r=n.get_siblings(e);if(e.__index__>0)return r[e.__index__-1]},get_first_child:function(e){var n=t.tree;if("object"==typeof(e=e||n.selected_node)){var r=e.__children__;if(r&&r.length>0)return e.__children__[0]}},get_closest_ancestor_next_sibling:function(e){var n=t.tree;e=e||n.selected_node;var r=n.get_next_sibling(e);if(r)return r;var a=n.get_parent(e);return a?n.get_closest_ancestor_next_sibling(a):void 0},get_next_node:function(e){var n=t.tree;if("object"==typeof(e=e||n.selected_node))return n.get_first_child(e)||n.get_closest_ancestor_next_sibling(e)},get_prev_node:function(e){var n=t.tree;if("object"==typeof(e=e||n.selected_node)){var r=n.get_prev_sibling(e);return r?n.get_last_descendant(r):n.get_parent(e)}},get_last_descendant:t.getLastDescendant,select_parent_node:function(e){var n=t.tree;if("object"==typeof(e=e||n.selected_node)){var r=n.get_parent(e);if(r)return n.select_node(r)}},select_first_node:function(){var e=t.tree,n=e.get_first_node();return e.select_node(n)},select_next_sibling:function(e){var n=t.tree;if("object"==typeof(e=e||n.selected_node)){var r=n.get_next_sibling(e);if(r)return n.select_node(r)}},select_prev_sibling:function(e){var n=t.tree;if("object"==typeof(e=e||n.selected_node)){var r=n.get_prev_sibling(e);if(r)return n.select_node(r)}},select_next_node:function(e){var n=t.tree;if("object"==typeof(e=e||n.selected_node)){var r=n.get_next_node(e);if(r)return n.select_node(r)}},select_prev_node:function(e){var n=t.tree;if("object"==typeof(e=e||n.selected_node)){var r=n.get_prev_node(e);if(r)return n.select_node(r)}}}}})),angular.module("ntt.TreeDnD").factory("$TreeDnDDrag",["$timeout","$TreeDnDHelper",function(e,n){function t(e,n){if(e.preventDefault(),n.dragElm){var t=!1,a=n.$scope,l=a.getScope(n.dragInfo.node),o=l.$element;a.$safeApply((function(){t=a.$callbacks.beforeDrop(n.dragInfo)})),l.isTable?a.for_all_descendants(n.dragInfo.node,(function(e,n){return l=a.getScope(e),o=l&&l.$element,l&&o&&(!n&&e.__visible__||n.__expanded__)&&a.$class.hidden&&o.removeClass(a.$class.hidden),!1===e.__visible__||!1===e.__expanded__}),void 0,!0):a.$class.hidden&&o.removeClass(a.$class.hidden),n.dragElm.remove(),n.dragElm=void 0,a.enabledStatus&&a.hideStatus(),a.$$apply?a.$safeApply((function(){var e=a.$callbacks.dropped(n.dragInfo,t);a.$callbacks.dragStop(n.dragInfo,e),i()})):(r(n),a.$safeApply((function(){a.$callbacks.dragStop(n.dragInfo,!1),i()})))}function i(){n.dragInfo.target.hidePlace(),n.dragInfo.target.targeting=!1,n.dragInfo=void 0,a.$$apply=!1,a.setDragging(void 0)}angular.element(n.$document).unbind("touchend",n.dragEndEvent),angular.element(n.$document).unbind("touchcancel",n.dragEndEvent),angular.element(n.$document).unbind("touchmove",n.dragMoveEvent),angular.element(n.$document).unbind("mouseup",n.dragEndEvent),angular.element(n.$document).unbind("mousemove",n.dragMoveEvent),angular.element(n.$window.document.body).unbind("mouseleave",n.dragCancelEvent)}function r(t){t.element.bind("touchstart mousedown",(function(r){t.dragDelaying=!0,t.dragStarted=!1,function(e,t){t.$scope.$callbacks.draggable()&&function(e,t){if((t.hasTouch||2!==e.button&&3!==e.which)&&!(e.uiTreeDragging||e.originalEvent&&e.originalEvent.uiTreeDragging)){var r,a=angular.element(e.target);if((n.isTreeDndNodeHandle(a)||(a=n.closestByAttr(a,n.isTreeDndNodeHandle)))&&(r=a.controller("treeDndNodeHandle").scope),r&&r.$type&&"TreeDnDNodeHandle"===r.$type){var l,o=a.prop("tagName").toLowerCase(),i=t.$scope;if("input"!==o&&"textarea"!==o&&"button"!==o&&"select"!==o){for(;a&&a[0]&&a[0]!==t.element;){if(n.nodrag(a))return;a=a.parent()}if(e.uiTreeDragging=!0,e.originalEvent&&(e.originalEvent.uiTreeDragging=!0),e.preventDefault(),l=r.getScopeNode(),t.dragInfo=n.dragInfo(l),i.$callbacks.beforeDrag(l,t.dragInfo)){t.firstMoving=!0,i.setDragging(t.dragInfo);var d=n.eventObj(e);t.pos=n.positionStarted(d,l.$element),l.isTable?t.dragElm=angular.element(t.$window.document.createElement("table")).addClass(i.$class.tree).addClass(i.$class.drag).addClass(i.$tree_class):t.dragElm=angular.element(t.$window.document.createElement("ul")).addClass(i.$class.drag).addClass("tree-dnd-nodes").addClass(i.$tree_class),t.dragElm.css({width:n.width(l.$element)+"px","z-index":9995}),t.offsetEdge=0;var s,c,_,u=n.width(l.$element),f=l,g=f.$element,p=!!i.enabledCollapse,h=!1;f.isTable?(t.offsetEdge=t.dragInfo.node.__level__-1,c=angular.element(document.createElement("tbody")),_=angular.element(document.createDocumentFragment()),i.for_all_descendants(t.dragInfo.node,(function(e,r){return f=i.getScope(e),g=f&&f.$element,f&&g&&(h||(s=g.clone(),n.replaceIndent(i,s,e.__level__-t.offsetEdge,"padding-left"),_.append(s),p&&(h=!0),i.enabledMove&&i.$class.hidden&&(!r||e.__visible__||r.__visible__&&r.__expanded__)&&g.addClass(i.$class.hidden))),h||!1===e.__visible__||!1===e.__expanded__}),void 0,!p),c.append(_),t.dragElm.append(c)):(s=g.clone(),p&&s[0].querySelector("[tree-dnd-nodes]").remove(),t.dragElm.append(s),i.enabledMove&&i.$class.hidden&&g.addClass(i.$class.hidden)),t.dragElm.css({left:d.pageX-t.pos.offsetX+i.$callbacks.calsIndent(t.offsetEdge+1,!0,!0)+"px",top:d.pageY-t.pos.offsetY+"px"}),t.$document.find("body").append(t.dragElm),i.$callbacks.droppable()&&(t.placeElm=i.initPlace(l.$element,t.dragElm),l.isTable&&n.replaceIndent(i,t.placeElm,t.dragInfo.node.__level__),t.placeElm.css("width",u)),i.showPlace(),i.targeting=!0,i.enabledStatus&&(i.refreshStatus(),i.setPositionStatus(e)),angular.element(t.$document).bind("touchend",t.dragEndEvent),angular.element(t.$document).bind("touchcancel",t.dragEndEvent),angular.element(t.$document).bind("touchmove",t.dragMoveEvent),angular.element(t.$document).bind("mouseup",t.dragEndEvent),angular.element(t.$document).bind("mousemove",t.dragMoveEvent),angular.element(t.$document).bind("mouseleave",t.dragCancelEvent),t.document_height=Math.max(t.body.scrollHeight,t.body.offsetHeight,t.html.clientHeight,t.html.scrollHeight,t.html.offsetHeight),t.document_width=Math.max(t.body.scrollWidth,t.body.offsetWidth,t.html.clientWidth,t.html.scrollWidth,t.html.offsetWidth)}}}}}(e,t)}(r,t),t.dragTimer=e((function(){t.dragDelaying=!1}),t.$scope.dragDelay)})),t.element.bind("touchend touchcancel mouseup",(function(){e.cancel(t.dragTimer)}))}return function(e,a,l,o){var i={hasTouch:"ontouchstart"in window,firstMoving:void 0,dragInfo:void 0,pos:void 0,placeElm:void 0,dragElm:void 0,dragDelaying:!0,dragStarted:!1,dragTimer:void 0,body:document.body,html:document.documentElement,document_height:void 0,document_width:void 0,offsetEdge:void 0,$scope:e,$window:l,$document:o,element:a,bindDrag:function(){r(i)},dragEnd:function(e){t(e,i)},dragMoveEvent:function(e){!function(e,t){var r=t.$scope;if(t.dragStarted){if(t.dragElm){e.preventDefault(),t.$window.getSelection?t.$window.getSelection().removeAllRanges():t.$window.document.selection&&t.$window.document.selection.empty();var a=n.eventObj(e),l=a.pageX-t.pos.offsetX,o=a.pageY-t.pos.offsetY;l<0&&(l=0),o<0&&(o=0),o+10>t.document_height&&(o=t.document_height-10),l+10>t.document_width&&(l=t.document_width-10),t.dragElm.css({left:l+r.$callbacks.calsIndent(t.offsetEdge+1,!0,!0)+"px",top:o+"px"}),r.enabledStatus&&r.setPositionStatus(e);var i=window.pageYOffset||t.$window.document.documentElement.scrollTop,d=i+(window.innerHeight||t.$window.document.clientHeight||t.$window.document.clientHeight);if(d<a.pageY&&d<=t.document_height&&window.scrollBy(0,10),i>a.pageY&&window.scrollBy(0,-10),n.positionMoved(e,t.pos,t.firstMoving),t.firstMoving)return void(t.firstMoving=!1);var s,c,_,u,f,g,p,h,m,v,b=a.pageX-t.$window.document.body.scrollLeft,y=a.pageY-(window.pageYOffset||t.$window.document.documentElement.scrollTop),$=!0,D=!0,x=t.dragInfo,E=x.move,T=x.node,w=x.drop,C=x.target,S=function(e,t){if(t.placeElm){var r=n.offset(t.placeElm);if(r.top<=e.pageY&&e.pageY<=r.top+r.height&&r.left<=e.pageX&&e.pageX<=r.left+r.width)return!0}return!1}(e,t);if(!S){if(t.$window.document.elementFromPoint(b,y),s=angular.element(t.$window.document.elementFromPoint(b,y)),n.isTreeDndDroppable(s)||(s=n.closestByAttr(s,n.isTreeDndDroppable)),n.isTreeDndNode(s)?c=s.controller("treeDndNode").scope:n.isTreeDndNodes(s)?c=s.controller("treeDndNodes").scope:n.isTreeDndNodeHandle(s)&&(c=s.controller("treeDndNodeHandle").scope),!c||!c.$callbacks||!c.$callbacks.droppable())return;if(v=function(){return C=c.getScopeTree(),h=x.target,x.target!==C&&(h.hidePlace(),h.targeting=!1,C.targeting=!0,x.target=C,t.placeElm=C.initPlace(c.$element,t.dragElm),h=void 0,g=!0),!0},angular.isFunction(c.getScopeNode)){if(c=c.getScopeNode(),!v())return}else{if("TreeDnDNodes"!==c.$type&&"TreeDnD"!==c.$type)return;if(!c.tree_nodes)return;if(0===c.tree_nodes.length){if(!v())return;f=!0}}}if((t.pos.dirAx&&!g||S)&&(D=!1,c=x.scope),!c.$element&&!c)return;if(f)E.parent=void 0,E.pos=0,w=void 0;else if(D){if(s=c.$element,angular.isUndefinedOrNull(s))return;if(u=n.offset(s),c.horizontal&&!c.isTable)_=a.pageX<u.left+n.width(s)/2;else if(c.isTable)_=a.pageY<u.top+n.height(s)/2;else{var k=n.height(s);if(c.getElementChilds()&&(k-=-n.height(c.getElementChilds())),a.pageY>u.top+k)return;_=a.pageY<u.top+k/2}if(!angular.isFunction(c.getData))return;if(h=c.getData(),m=c.getNode(h.__parent_real__),_){var j=c.getPrevSibling(h);E.parent=m,E.pos=angular.isDefined(j)?j.__index__+1:0,w=j}else!h.__expanded__||1===h.__children__.length&&h.__index_real__===T.__parent_real__?(E.parent=m,E.pos=h.__index__+1,w=h):(E.parent=h,E.pos=0,w=void 0)}else{if(!(t.pos.dirAx&&t.pos.distAxX>=C.dragBorder))return;if(t.pos.distAxX=0,t.pos.distX>0){if(!(m=w)){if(!(E.pos-1>=0))return;m=E.parent.__children__[E.pos-1]}if(x.drag===x.target&&m===T&&r.enabledMove&&(m=C.getPrevSibling(m)),!m||!m.__visible__)return;var N=m.__children__.length;E.parent=m,E.pos=N,w=N>0?m.__children__[N-1]:void 0}else{if(!(t.pos.distX<0))return;if(!(h=E.parent)||!(0===h.__children__.length||h.__children__.length-1<E.pos||x.drag===x.target&&h.__index_real__===T.__parent_real__&&h.__children__.length-1===T.__index__&&r.enabledMove))return;m=C.getNode(h.__parent_real__),E.parent=m,E.pos=h.__index__+1,w=h}}x.drag===x.target&&E.parent&&T.__parent_real__===E.parent.__index_real__&&T.__index__===E.pos&&($=!1),C.$callbacks.accept(x,E,$)&&(x.move=E,x.drop=w,x.changed=$,x.scope=c,c.isTable?(n.replaceIndent(C,t.placeElm,angular.isUndefinedOrNull(E.parent)?1:E.parent.__level__+1),w?(m=(E.parent?E.parent.__children__:void 0)||x.target.treeData,w.__index__<m.length-1?(w=m[w.__index__+1],(p=x.target.getScope(w)).$element[0].parentNode.insertBefore(t.placeElm[0],p.$element[0])):(h=x.target.getLastDescendant(w),(p=x.target.getScope(h)).$element.after(t.placeElm))):(p=x.target.getScope(E.parent))&&(E.parent?p.$element.after(t.placeElm):p.getElementChilds().prepend(t.placeElm))):(p=x.target.getScope(w||E.parent),w?p.$element.after(t.placeElm):p.getElementChilds().prepend(t.placeElm)),C.showPlace(),r.$safeApply((function(){r.$callbacks.dragMove(x)})))}}else t.dragDelaying||(t.dragStarted=!0,r.$safeApply((function(){r.$callbacks.dragStart(t.dragInfo)})))}(e,i)},dragEndEvent:function(n){e.$$apply=!0,t(n,i)},dragCancelEvent:function(e){t(e,i)}},d=function(e){return function(e,n){var r=n.$scope;if(27===e.keyCode)r.enabledStatus&&r.hideStatus(),r.$$apply=!1,t(e,n);else if(r.enabledHotkey&&e.shiftKey){if(r.enableMove(!0),r.enabledStatus&&r.refreshStatus(),!n.dragInfo)return;var a=r.getScope(n.dragInfo.node),l=a.$element;a.isTable?r.for_all_descendants(n.dragInfo.node,(function(e,n){return a=r.getScope(e),l=a&&a.$element,a&&l&&(!n&&e.__visible__||n.__expanded__)&&r.$class.hidden&&l.addClass(r.$class.hidden),!1===e.__visible__||!1===e.__expanded__}),void 0,!0):r.$class.hidden&&l.addClass(r.$class.hidden)}}(e,i)},s=function(e){return function(e,n){var t=n.$scope;if(t.enabledHotkey&&!e.shiftKey){if(t.enableMove(!1),t.enabledStatus&&t.refreshStatus(),!n.dragInfo)return;var r=t.getScope(n.dragInfo.node),a=r.$element;r.isTable?t.for_all_descendants(n.dragInfo.node,(function(e,n){return r=t.getScope(e),a=r&&r.$element,r&&a&&(!n&&e.__visible__||n.__expanded__)&&t.$class.hidden&&a.removeClass(t.$class.hidden),!1===e.__visible__||!1===e.__expanded__}),void 0,!0):t.$class.hidden&&a.removeClass(t.$class.hidden)}}(e,i)};e.dragEnd=function(e){i.dragEnd(e)},i.bindDrag(),angular.element(l.document.body).bind("keydown",d),angular.element(l.document.body).bind("keyup",s),e.$on("$destroy",(function(){angular.element(l.document.body).unbind("keydown",d),angular.element(l.document.body).unbind("keyup",s),e.statusElm&&e.statusElm.remove(),e.placeElm&&e.placeElm.remove()}))}}]);